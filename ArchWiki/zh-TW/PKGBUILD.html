<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>PKGBUILD (正體中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-PKGBUILD_正體中文 rootpage-PKGBUILD_正體中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">PKGBUILD (正體中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>相關文章</p>
<ul>
<li><a href="../en/Arch_package_guidelines.html" class="mw-redirect" title="Arch packaging standards">Arch packaging standards</a></li>
<li><a href="../zh-TW/Arch_Build_System.html" title="Arch Build System (正體中文)">Arch 組建系統</a></li>
<li><a href="../en/Creating_packages.html" title="Creating packages">Creating packages</a></li>
<li><a href="../en/Category:Package_development.html" title="Category:Package development">軟體包開發分類</a></li>
<li><a href="../en/Pacman/Tips_and_tricks.html#Custom_local_repository" class="mw-redirect" title="Custom local repository">Custom local repository</a></li>
<li><a href="../en/Pacman/Tips_and_tricks.html" class="mw-redirect" title="Pacman tips">pacman tips</a></li>
<li><a href="../zh-TW/Arch_User_Repository.html" title="Arch User Repository (正體中文)">Arch 使用者倉庫</a></li>
<li><a href="../en/Makepkg.html" title="Makepkg">makepkg</a></li>
<li><a href="../zh-TW/Pacman.html" title="Pacman (正體中文)">pacman</a></li>
</ul>
</div>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a><b>This article or section is out of date.</b><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> <span style="color:red;">please use the first argument of the template to provide a brief explanation.</span> (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:PKGBUILD_(%E6%AD%A3%E9%AB%94%E4%B8%AD%E6%96%87)">Talk:PKGBUILD (正體中文)#</a>)</div>
</div>
<p>因為有 ABS，Arch 用戶可輕易將源代碼編譯為一個 .pkg.tar.gz <b>安裝包</b>. 
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%E4%BB%80%E9%BA%BC%E6%98%AF%E5%AE%89%E8%A3%9D%E5%8C%85%E6%96%87%E4%BB%B6%EF%BC%9F"><span class="tocnumber">1</span> <span class="toctext">什麼是安裝包文件？</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#%E4%BB%80%E9%BA%BC%E6%98%AF_PKGBUILD_%E6%96%87%E4%BB%B6%EF%BC%8C%E5%85%B6%E5%85%A7%E5%AE%B9%E6%98%AF%E4%BB%80%E9%BA%BC%EF%BC%9F"><span class="tocnumber">2</span> <span class="toctext">什麼是 PKGBUILD 文件，其內容是什麼？</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#%E6%A7%8B%E5%BB%BA%E5%87%BD%E6%95%B8%E4%B9%8B%E8%A7%A3%E9%87%8B"><span class="tocnumber">2.1</span> <span class="toctext">構建函數之解釋</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#%E6%9B%B4%E5%A4%9A_ABS_%E7%9B%B8%E9%97%9C%E8%B3%87%E8%A8%8A"><span class="tocnumber">2.2</span> <span class="toctext">更多 ABS 相關資訊</span></a></li>
</ul>
</li>
</ul>
</div>

<h1>
<span id=".E4.BB.80.E9.BA.BC.E6.98.AF.E5.AE.89.E8.A3.9D.E5.8C.85.E6.96.87.E4.BB.B6.EF.BC.9F"></span><span class="mw-headline" id="什麼是安裝包文件？">什麼是安裝包文件？</span>
</h1>
<p>記住，ABS自動為你要編譯的那個軟體下載源代碼。然後解包，編譯，然後將編譯好的文件壓入一個安裝包中。<br>
一般來說，得到的這個安裝包文件就是一個以 .pkg.tar.gz 結尾的文件，例如：<i>foo</i>.pkg.tar.gz. 
</p>
<p>事實上，它不僅僅是一個 gzip 壓縮過的 tar 檔案文件（'tarball'），它含有： 
</p>
<ul><li>將要安裝的文件</li></ul>
<ul><li>.PKGINFO: 包含 pacman 要處理的安裝包，依賴性文件等所有的元數據。</li></ul>
<ul><li>.FILELIST: 該文件記錄了檔案中所有文件的列表。它被用於反安裝軟體，或檢查衝突文件。</li></ul>
<ul><li>.INSTALL: 該文件用在安裝/升級/刪除的階段之後執行命令(僅當 PKGBUILD 中創造出指定時，該文件才會存在)</li></ul>
<p>因為 pacman 能管理 tar.gz 安裝包， 于是，用 ABS 創建的 ***.pkg.tar.gz 就能輕易被安裝或刪除了。
</p>
<h1>
<span id=".E4.BB.80.E9.BA.BC.E6.98.AF_PKGBUILD_.E6.96.87.E4.BB.B6.EF.BC.8C.E5.85.B6.E5.85.A7.E5.AE.B9.E6.98.AF.E4.BB.80.E9.BA.BC.EF.BC.9F"></span><span class="mw-headline" id="什麼是_PKGBUILD_文件，其內容是什麼？">什麼是 PKGBUILD 文件，其內容是什麼？</span>
</h1>
<p>前面解釋過了 PKGBUILD 文件，它記錄了一個安裝包的元數據。它是一個文本文件。這裡是一個例子：
</p>
<pre># $Id: PKGBUILD,v 1.12 2003/11/06 08:26:13 dorphell Exp $
# Maintainer: judd &lt;jvinet@zeroflux.org&gt;
# Contributor: Judd Vinet &lt;jvinet@zeroflux.org&gt;
pkgname=foo
pkgver=0.99 # note: if the pkgver had been '0.99-10' then use an underscore, i.e. '0.99_10'
pkgrel=1
pkgdesc="short description of foo"
arch=(i686 x86_64)
url="http://www.foo.org"
license=('GPL')
groups=
provides=
depends=('qt' 'python')
makedepends=('guile')
conflicts=('yafoo')
replaces=('mffoo')
backup=('etc/foo/foo.conf')
install=('foo.install')
source=(http://www.foo.org/download/$pkgname-$pkgver.tar.gz)
md5sums=('2c0cca3ef6330a187c6ef4fe41ecaa4d35175bee593a7cc7d6205584a94d8625')

build() {
  cd $startdir/src/$pkgname-$pkgver
  ./configure --prefix=/usr
  make || return 1
  make prefix=$startdir/pkg/usr install
}
</pre>
<p>現在讓我們來逐條解釋一下：
</p>
<ul>
<li>
<b># abc ...</b> : 這是註釋文字</li>
<li>
<b># $Id: PKGBUILD,v ...</b>: 該安裝包的 cvs 標籤 (從 archlinux-cvs 系統創建)</li>
<li>
<b># Maintainer</b>: 在官方軟體庫中負責此安裝包的維護人</li>
<li>
<b># Contributor</b>: 寫出此安裝包 PKGBUILD 文件的第一人</li>
<li>
<b>pkgname</b>:  安裝包名稱</li>
<li>
<b>pkgver</b>: 安裝包的版本號</li>
<li>
<b>pkgrel</b>: 此 Arch 安裝包的釋出號。它不同於版本號。當PKGBUILD 文件有改動時，釋出號就改變了。這種情況有多種原因，例如你為某個包開啟了編譯時間支援。</li>
<li>
<b>pkgdesc</b>: 安裝包的簡明描述。這也是你瀏覽<a rel="nofollow" class="external text" href="https://archlinux.org/packages/">package database</a>時會見到的。</li>
<li>
<b>arch</b>: 表明它在哪種架構下構建和工作的，軟體移植的細節可參閱<a href="../en/Frequently_asked_questions.html#64-bit" class="mw-redirect" title="Arch64 FAQ">Arch64 FAQ</a>。</li>
<li>
<b>url</b>: 軟體的主頁 (當你在安裝包數據庫中點擊它時候，就能出現了)</li>
<li>
<b>license</b>: 基於哪種軟體發佈許可</li>
<li>
<b>groups</b>: 這一倏用於為軟體分組；例如當你要安裝 KDE 時，它就會安裝屬於 KDE 軟體組的所有安裝包。</li>
<li>
<b>provides</b>: 如果一個安裝包也提供了其它包的安裝，那就使用它。例如，kernel-scsi 也提供了 kernel 的安裝包。</li>
<li>
<b>depends</b>: 它列出了安裝包運行時的依賴軟體 (必須有這些軟體才能正常工作)</li>
<li>
<b>makedepends</b>: 在構建安裝包時需要的依賴性軟體，不過一旦已經構建好的，就不再需要了。</li>
<li>
<b>conflicts</b>: 這些包不能被同時安裝。這裡 <i>foo</i> 跟 <i>yafoo (另外一個 foo)</i> 有衝突。它們不能共存。</li>
<li>
<b>replaces</b>: 新安裝包代替了舊的。這裡， <i>mffoo (第一個 foo)</i>  不再受到支持了，被 <i>foo</i> 所代替。</li>
<li>
<b>backup</b>: 當刪除安裝包時，用哪個文件作為備份文件(如 file.pacsave) 。</li>
<li>
<b>install</b>: 指定一個特別安裝腳本，它將被包含在安裝包中(必須跟 PKGBUILD 在同一個目錄下)</li>
<li>
<b>source</b>: 它指定了從何處下載該安裝包的源代碼包。它可以在本地電腦上，也可以是從 "http" 或 "ftp" 上取得的。它用 <i>pkgver</i> 來命名，以免每次源碼包變動時，源碼的名稱也要跟著變化。</li>
<li>
<b>md5sums</b>: 計算源代碼包的 md5 值，以查驗完整性。</li>
</ul>
<p>現在來解釋一下函數：
</p>
<ul><li>build: 構建一個安裝包時所需要的所有動作(稍候本文將作更詳細的說明)</li></ul>
<p>好，你看到了 PKGBUILD 文件含有包管理器可能需要的所有資訊，它是 pacman 和 abs 的核心。
</p>
<p>還會有些安裝文件。這個 PKGBUILD 指定了 'foo.install' 作為安裝包的安裝文件。這是例子：
</p>
<pre>post_install() {
/bin/true
}

post_upgrade() {
/bin/true
}

pre_remove() {
/bin/true
}

op=$1
shift

$op "$@"
</pre>
<p>其中的函數說明如下：
</p>
<ul>
<li>post_install: 文件一裝完，此腳本就運行。它跟了一行命令：
<ul><li>對本安裝包版本操作</li></ul>
</li>
<li>post_upgrade: 文件一升級完，此腳本就運行。它跟了兩行命令：
<ul>
<li>對新安裝包版本操作</li>
<li>對舊安裝包版本操作</li>
</ul>
</li>
<li>pre_remove: 此腳本運行於文件刪除前（例如停止了一個守護進程）。它跟了一行命令：
<ul><li>對本安裝包版本操作</li></ul>
</li>
</ul>
<p>底下的那三行是每一個安裝文件都需要的，以便安裝文件正常運行。
</p>
<h2>
<span id=".E6.A7.8B.E5.BB.BA.E5.87.BD.E6.95.B8.E4.B9.8B.E8.A7.A3.E9.87.8B"></span><span class="mw-headline" id="構建函數之解釋">構建函數之解釋</span>
</h2>
<p>那麼來看看上面例子中用到的 ABS 的構建函數。注意 build 一節：
</p>
<pre>build() {
  cd $startdir/src/$pkgname-$pkgver
  ./configure --prefix=/usr
  make || return 1
  make prefix=$startdir/pkg/usr install
}
</pre>
<p>發生了什麼：
</p>
<ul><li>進入源代碼包的解壓目錄：</li></ul>
  <pre>cd $startdir/src/$pkgname-$pkgver</pre>
<ul><li>配置安裝包，並告訴它安裝到 <code>/usr</code> 這個目錄下：</li></ul>
  <pre>  ./configure --prefix=/usr</pre>
<ul><li>編譯</li></ul>
  <pre>  make || return 1</pre>
<ul><li>軟體不直接安裝到 <code>/usr</code> 下，而是裝到 <code>$startdir/pkg/usr</code> 下，以便 pacman 能控制這些文件。</li></ul>
  <pre>  make prefix=$startdir/pkg/usr install</pre>
<p>我們想要做的是構建這個安裝包，而不是去安裝它。所以我們告訴 <code>make</code> 將所有的文件放到指定目錄下面 <code>$startdir/pkg/usr</code> ，而不是安裝到標準的位置 <code>/usr</code> 。<br>
這樣一來， makepkg 就能查看到這個安裝包要安裝哪些個文件了，並將其壓縮成 Arch 安裝包。
</p>
<p><b>注意</b>: 有時候，<code>Makefile</code> 中並未使用 <code>prefix</code> ；經常是用了 <code>DESTDIR</code> 。如果此安裝包是用 autoconf/automake 來構建的，就用 <code>DESTDIR</code> 。這是在手冊中 <a rel="nofollow" class="external text" href="http://sources.redhat.com/automake/automake.html#Install">詳細說明了的</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-08-04 ⓘ]</sup>。檢查一下產生的 <code>filelist</code> 是否比平常小很多，如果是這樣的話，嘗試用 <code>make DESTDIR=$startdir/pkg install</code> 來構建。如果不能正常工作，那就要深入研究一下安裝命令了，它們位於 "<code>make &lt;...&gt; install=</code>" 中。
</p>
<p><br>
</p>
<h2>
<span id=".E6.9B.B4.E5.A4.9A_ABS_.E7.9B.B8.E9.97.9C.E8.B3.87.E8.A8.8A"></span><span class="mw-headline" id="更多_ABS_相關資訊">更多 ABS 相關資訊</span>
</h2>
<ul>
<li>
<a href="../en/Arch_Build_System.html" class="mw-redirect" title="ABS">ABS</a> The Arch Build System</li>
<li><a href="../en/Creating_packages.html" title="Creating packages">Creating packages</a></li>
<li><a href="../en/Makepkg.html" title="Makepkg">Makepkg</a></li>
<li><a href="../en/Makepkg.html" class="mw-redirect" title="Safe Cflags">Safe Cflags</a></li>
<li><a href="../en/Kernel/Arch_Build_System.html" class="mw-redirect" title="Kernel Compilation with ABS">Kernel Compilation with ABS</a></li>
<li><a href="../en/Arch_User_Repository.html" title="Arch User Repository">Arch User Repository</a></li>
<li><a href="../en/Pacman/Tips_and_tricks.html#Custom_local_repository" class="mw-redirect" title="Custom local repository with ABS and gensync">Custom local repository with ABS and gensync</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:7d876dcc0aeb99723c8082d6986c7db5.html" title="Category:正體中文">正體中文</a></li>
<li><a href="../zh-TW/Category:Package_development.html" title="Category:Package development (正體中文)">Package development (正體中文)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=PKGBUILD_(%E6%AD%A3%E9%AB%94%E4%B8%AD%E6%96%87)&amp;oldid=629824">https://wiki.archlinux.org/index.php?title=PKGBUILD_(正體中文)&amp;oldid=629824</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 5 August 2020, at 18:42.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
