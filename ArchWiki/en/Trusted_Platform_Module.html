<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Trusted Platform Module - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Trusted_Platform_Module rootpage-Trusted_Platform_Module skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Trusted Platform Module</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../en/Rng-tools.html" title="Rng-tools">Rng-tools</a></li>
<li><a href="../en/Self-encrypting_drives.html" class="mw-redirect" title="Self-Encrypting Drives">Self-Encrypting Drives</a></li>
<li><a href="../en/Smartcards.html" title="Smartcards">Smartcards</a></li>
</ul>
</div>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Needs clarification about usage difference between TPM 1.2 and 2.0, Evil Maid attack defense and Trusted boot. PCR registers sealing and using in combination with LUKS. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Trusted_Platform_Module">Talk:Trusted Platform Module#</a>)</div>
</div>
<p><a href="https://en.wikipedia.org/wiki/Trusted_Platform_Module" class="extiw" title="wikipedia:Trusted Platform Module">Trusted Platform Module</a> (TPM) is an international standard for a secure cryptoprocessor, which is a dedicated microprocessor designed to secure hardware by integrating cryptographic keys into devices.
</p>
<p>In practice a TPM can be used for various different security applications such as <a href="../en/Unified_Extensible_Firmware_Interface/Secure_Boot.html" class="mw-redirect" title="Secure Boot">secure boot</a>, key storage and <a href="../en/Rng-tools.html" title="Rng-tools">random number generation</a>.
</p>
<p>TPM is naturally supported only on devices that have TPM hardware support. If your hardware has TPM support but it is not showing up, it might need to be enabled in the BIOS settings.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Versions"><span class="tocnumber">1</span> <span class="toctext">Versions</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#Using_TPM_1.2"><span class="tocnumber">2</span> <span class="toctext">Using TPM 1.2</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Drivers"><span class="tocnumber">2.1</span> <span class="toctext">Drivers</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Usage"><span class="tocnumber">2.2</span> <span class="toctext">Usage</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Basics"><span class="tocnumber">2.3</span> <span class="toctext">Basics</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Securing_SSH_Keys"><span class="tocnumber">2.4</span> <span class="toctext">Securing SSH Keys</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Accessing_PCR_registers"><span class="tocnumber">2.5</span> <span class="toctext">Accessing PCR registers</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8">
<a href="#Using_TPM_2.0"><span class="tocnumber">3</span> <span class="toctext">Using TPM 2.0</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#Checking_support"><span class="tocnumber">3.1</span> <span class="toctext">Checking support</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Usage_2"><span class="tocnumber">3.2</span> <span class="toctext">Usage</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11">
<a href="#Troubleshooting"><span class="tocnumber">4</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#tcsd.service_failed_to_start"><span class="tocnumber">4.1</span> <span class="toctext">tcsd.service failed to start</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="#See_also"><span class="tocnumber">5</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Versions">Versions</span></h2>
<p>There are two very different TPM specifications: 1.2 and 2.0, which also use different software stacks.
</p>
<ul>
<li>TPM 1.2 uses the "TrouSerS" TSS (TCG software stack) by IBM, which is packaged as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/trousers/">trousers</a></span><sup><small>AUR</small></sup> (<i>tcsd</i>) and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/tpm-tools/">tpm-tools</a></span><sup><small>AUR</small></sup> (userspace). All software access the TPM through the <i>tcsd</i> daemon.</li>
<li>TPM 2.0 allows direct access via <code>/dev/tpm0</code> (one client at a time), managed access through the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tpm2-abrmd">tpm2-abrmd</a></span> resource manager daemon, or kernel-managed access via <code>/dev/tpmrm0</code>. There are two choices of userspace tools, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tpm2-tools">tpm2-tools</a></span> by Intel and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ibm-tss/">ibm-tss</a></span><sup><small>AUR</small></sup> by IBM.</li>
</ul>
<p>TPM 2.0 requires <a href="../en/Unified_Extensible_Firmware_Interface.html" class="mw-redirect" title="UEFI">UEFI</a> boot; BIOS or Legacy boot systems can only use TPM 1.2.
</p>
<p>Some TPM chips can be switched between 1.2 and 2.0 through a firmware upgrade (which can be done only a limited number of times).
</p>
<h2><span class="mw-headline" id="Using_TPM_1.2">Using TPM 1.2</span></h2>
<h3><span class="mw-headline" id="Drivers">Drivers</span></h3>
<p>TPM drivers are natively supported in modern kernels, but might need to be loaded:
</p>
<pre># modprobe tpm
</pre>
<p>Depending on your chipset, you might also need to load one of the following:
</p>
<pre># modprobe -a tpm_{atmel,infineon,nsc,tis,crb}
</pre>
<h3><span class="mw-headline" id="Usage">Usage</span></h3>
<p>TPM 1.2 is managed by <code>tcsd</code>, a userspace daemon that manages Trusted Computing resources and should be (according to the TSS spec) the only portal to the TPM device driver. <code>tcsd</code> is part of the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/trousers/">trousers</a></span><sup><small>AUR</small></sup> AUR package, which was created and released by IBM, and can be configured via <code>/etc/tcsd.conf</code>.
</p>
<p>To start tcsd and watch the output, run:
</p>
<pre># tcsd -f
</pre>
<p>or simply start and enable <code>tcsd.service</code>.
</p>
<p>Once <code>tcsd</code> is running you might also want to install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/tpm-tools/">tpm-tools</a></span><sup><small>AUR</small></sup> which provides many of the command line tools for managing the TPM.
</p>
<p>Some other tools of interest:
</p>
<ul><li>
<b>tpmmanager</b> — A Qt front-end to tpm-tools</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="http://sourceforge.net/projects/tpmmanager">http://sourceforge.net/projects/tpmmanager</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-04-03 ⓘ]</sup> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/tpmmanager/">tpmmanager</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>opencryptoki</b> — A PKCS#11 implementation for Linux. It includes drivers and libraries to enable IBM cryptographic hardware as well as a software token for testing.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://sourceforge.net/projects/opencryptoki">https://sourceforge.net/projects/opencryptoki</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/opencryptoki/">opencryptoki</a></span><sup><small>AUR</small></sup>
</dd></dl>
<h3><span class="mw-headline" id="Basics">Basics</span></h3>
<p>Start off by getting basic version info:
</p>
<pre>$ tpm_version
</pre>
<p>and running a selftest:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ tpm_selftest -l info</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">TPM Test Results: 00000000 ...
tpm_selftest succeeded
</pre>
<h3><span class="mw-headline" id="Securing_SSH_Keys">Securing SSH Keys</span></h3>
<p>There are several methods to use TPM to secure keys, but here we show a simple method based on <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/simple-tpm-pk11-git/">simple-tpm-pk11-git</a></span><sup><small>AUR</small></sup>.
</p>
<p>First, create a new directory and generate the key:
</p>
<pre>$ mkdir ~/.simple-tpm-pk11
$ stpm-keygen -o ~/.simple-tpm-pk11/my.key
</pre>
<p>Point the config to the key:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.simple-tpm-pk11/config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">key my.key
</pre>
<p>Now configure SSH to use the right PKCS11 provider:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.ssh/config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Host *
    PKCS11Provider /usr/lib/libsimple-tpm-pk11.so
</pre>
<p>It is now possible to generate keys with the PKCS11 provider:
</p>
<pre>$ ssh-keygen -D /usr/lib/libsimple-tpm-pk11.so
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This method currently does not allow for multiple keys to be generated and used.</div>
<h3><span class="mw-headline" id="Accessing_PCR_registers">Accessing PCR registers</span></h3>
<p>Platform Configuration Registers (PCR) contain hashes that can be read at any time but can only be written via the extend operation, which depends on the previous hash value, thus making a sort of blockchain. They are intended to be used for platform hardware and software integrity checking between boots (e.g. protection against <a href="https://en.wikipedia.org/wiki/en:Evil_Maid_attack" class="extiw" title="wikipedia:en:Evil Maid attack">Evil Maid attack</a>).  They can be used to unlock encryption keys and proving that the correct OS was booted.
</p>
<table class="wikitable">

<tbody>
<tr>
<th scope="col">PCR
</th>
<th scope="col">Use
</th>
<th scope="col">Notes
</th>
</tr>
<tr>
<td>PCR0
</td>
<td>Core System Firmware executable code (aka Firmware)
</td>
<td>May change if you upgrade your UEFI
</td>
</tr>
<tr>
<td>PCR1
</td>
<td>Core System Firmware data (aka UEFI settings)
</td>
<td>
</td>
</tr>
<tr>
<td>PCR2
</td>
<td>Extended or pluggable executable code
</td>
<td>
</td>
</tr>
<tr>
<td>PCR3
</td>
<td>Extended or pluggable firmware data
</td>
<td>Set during Boot Device Select UEFI boot phase
</td>
</tr>
<tr>
<td>PCR4
</td>
<td>Boot Manager
</td>
<td>
</td>
</tr>
<tr>
<td>PCR5
</td>
<td>GPT / Partition Table
</td>
<td>
</td>
</tr>
<tr>
<td>PCR6
</td>
<td>Resume from S4 and S5 Power State Events
</td>
<td>
</td>
</tr>
<tr>
<td>PCR7
</td>
<td>Secure Boot State
</td>
<td>
</td>
</tr>
<tr>
<td>PCR 8 to 10
</td>
<td>Reserved for Future Use
</td>
<td>
</td>
</tr>
<tr>
<td>PCR11
</td>
<td>BitLocker Access Control
</td>
<td>
</td>
</tr>
<tr>
<td>PCR12
</td>
<td>Data events and highly volatile events
</td>
<td>
</td>
</tr>
<tr>
<td>PCR13
</td>
<td>Boot Module Details
</td>
<td>
</td>
</tr>
<tr>
<td>PCR14
</td>
<td>Boot Authorities
</td>
<td>
</td>
</tr>
<tr>
<td>PCR 15 to 23
</td>
<td>Reserved for Future Use
</td>
<td>
</td>
</tr>
</tbody>
</table>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/tpm2-totp-git/">tpm2-totp-git</a></span><sup><small>AUR</small></sup> facilitates this check with an human observer and dedicated trusted devise.
</p>
<pre># cat /sys/kernel/security/tpm0/ascii_bios_measurements
</pre>
<h2><span class="mw-headline" id="Using_TPM_2.0">Using TPM 2.0</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> This section is a stub. You can help by expanding it with information on how to set up and use a TPM 2.0 device. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Trusted_Platform_Module">Talk:Trusted Platform Module#</a>)</div>
</div>
<p>Many informative resources to learn how to configure and make use of TPM 2.0 services in daily applications are available from the <a rel="nofollow" class="external text" href="https://tpm2-software.github.io/">tpm2-software community</a>.
</p>
<h3><span class="mw-headline" id="Checking_support">Checking support</span></h3>
<p>A TPM 2.0 chip has been a requirement for computers certified to run Windows 10 since 2016-07-28.<a rel="nofollow" class="external autonumber" href="https://www.computerworld.com/article/3101427/microsoft-mandates-windows-10-hardware-change-for-pc-security.html">[1]</a> Linux has had support for TPM 2.0 since version 3.20<a rel="nofollow" class="external autonumber" href="https://www.phoronix.com/scan.php?page=news_item&amp;px=Linux-3.20-TPM-2.0-Security">[2]</a> and should not require any other steps to be enabled on a default Arch install.
</p>
<p>Two ways to verify whether TPM 2.0 is setup without specific software:
</p>
<ul>
<li>checking the logs with e.g. <code>dmesg | grep -i tpm</code>
</li>
<li>read the value of <code>/sys/class/tpm/tpm0/device/description</code><a rel="nofollow" class="external autonumber" href="https://github.com/tpm2-software/tpm2-tools/issues/604#issuecomment-342784674">[3]</a> or <code>/sys/class/tpm/tpm0/tpm_version_major</code>
</li>
</ul>
<h3><span class="mw-headline" id="Usage_2">Usage</span></h3>
<p>Good examples of TPM 2.0 usage include:
</p>
<ul>
<li>SSH: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tpm2-pkcs11">tpm2-pkcs11</a></span>'s <a rel="nofollow" class="external text" href="https://github.com/tpm2-software/tpm2-pkcs11/blob/master/docs/SSH.md">SSH configuration</a> and <a rel="nofollow" class="external text" href="https://incenp.org/notes/2020/tpm-based-ssh-key.html">Using a TPM for SSH authentication</a> (2020-01)</li>
<li>
<a rel="nofollow" class="external text" href="https://threat.tevora.com/secure-boot-tpm-2/">Configuring Secure Boot + TPM 2</a> (2018-06, Debian)</li>
<li>
<a rel="nofollow" class="external text" href="https://www.youtube.com/watch?v=XwaSyHJIos8">Using the TPM - It's Not Rocket Science (Anymore)</a> - Johannes Holland &amp; Peter Huewe (2020-11, Youtube): examples for OpenSSL with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tpm2-tss-engine">tpm2-tss-engine</a></span>
</li>
</ul>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="tcsd.service_failed_to_start">tcsd.service failed to start</span></h3>
<p>After installing <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/trousers/">trousers</a></span><sup><small>AUR</small></sup>, the <code>tcsd.service</code> service may not start correctly due to permission issues.<a rel="nofollow" class="external autonumber" href="https://bugs.launchpad.net/ubuntu/+source/trousers/+bug/963587/comments/3">[4]</a> It is possible to fix this either by rebooting or by triggering the <a href="../en/Udev.html" title="Udev">udev</a> rule that is included in the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/trousers/">trousers</a></span><sup><small>AUR</small></sup> package:
</p>
<pre># udevadm control --reload-rules
# udevadm trigger
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="http://lwn.net/Articles/674751/">Protecting systems with the TPM</a></li>
<li><a rel="nofollow" class="external text" href="http://www.thinkwiki.org/wiki/Embedded_Security_Subsystem">Embedded Security Subsystem on Thinkwiki</a></li>
<li><a rel="nofollow" class="external text" href="http://www.cs.unh.edu/~it666/reading_list/Hardware/tpm_fundamentals.pdf">TPM Fundamentals (PDF)</a></li>
<li><a rel="nofollow" class="external text" href="https://www.lorier.net/docs/tpm">Using a TPM</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Security.html" title="Category:Security">Security</a></li>
<li><a href="../en/Category:Hardware.html" title="Category:Hardware">Hardware</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Trusted_Platform_Module&amp;oldid=643194">https://wiki.archlinux.org/index.php?title=Trusted_Platform_Module&amp;oldid=643194</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 3 December 2020, at 22:40.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
