<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>TrueCrypt - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-TrueCrypt rootpage-TrueCrypt skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">TrueCrypt</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-go-next.png" class="image"><img alt="Tango-go-next.png" src="../File:Tango-go-next.png" decoding="async" width="48" height="48"></a><b>This article or section is a candidate for moving to <a href="/index.php?title=VeraCrypt&amp;action=edit&amp;redlink=1" class="new" title="VeraCrypt (page does not exist)">VeraCrypt</a>.</b><a href="../File:Tango-go-next.png" class="image"><img alt="Tango-go-next.png" src="../File:Tango-go-next.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Notes:</b> VeraCrypt is the maintained fork. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:TrueCrypt#VeraCrypt_article">Talk:TrueCrypt#VeraCrypt article</a>)</div>
</div>
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../en/Data-at-rest_encryption.html" title="Data-at-rest encryption">Data-at-rest encryption</a></li>
<li><a href="../en/Tcplay.html" title="Tcplay">Tcplay</a></li>
<li><a href="../en/Tomb.html" title="Tomb">Tomb</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Development of TrueCrypt was discontinued on May 2014, i.e. it <a rel="nofollow" class="external text" href="http://truecrypt.sourceforge.net/">will no longer receive updates and fixes</a>. The final release repository with information about TrueCrypt code audit is found at <a rel="nofollow" class="external autonumber" href="https://www.grc.com/misc/truecrypt/truecrypt.htm">[1]</a>.
<p>Consider using <a rel="nofollow" class="external text" href="https://veracrypt.fr/">VeraCrypt</a>, a TrueCrypt fork in active development installable with the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=veracrypt">veracrypt</a></span> package; VeraCrypt storage format is compatible with TrueCrypt storage format since version 1.0f.
</p>
</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> On 2015/09/26 two critical vulnerabilities were published for the <b>Windows</b> version of TrueCrypt: CVE-2015-7358 and CVE-2015-7359. Take this into account if you're planning to use this software to share encrypted volumes between Windows and Arch Linux. More information: <a rel="nofollow" class="external autonumber" href="http://www.theregister.co.uk/2015/09/29/google_flaks_find_admin_elevation_holes_that_gave_truecrypt_audit_the_slip/">[2]</a>,<a rel="nofollow" class="external autonumber" href="https://veracrypt.codeplex.com/SourceControl/changeset/cf4794372e5dea753b6310f1ca6912c6bfa86d45">[3]</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2018-07-15]</sup>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=truecrypt">truecrypt</a></span> 1:7.1a-3 and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=veracrypt">veracrypt</a></span> 1.16-5 cannot mount volumes since the <a rel="nofollow" class="external text" href="https://archlinux.org/news/c-abi-change/">C++ ABI change</a> on 2015-12-10, see <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/47325">FS#47325</a> and the <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=206047">forum thread</a>. <a href="../en/Downgrading_packages.html" class="mw-redirect" title="Downgrading">Downgrading</a> to <i>truecrypt</i> 1:7.1a-2 works around the problem. Furthermore, the problem appears to be fixed in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=truecrypt">truecrypt</a></span> 1:7.1a-4.</div>
<p><a href="https://en.wikipedia.org/wiki/Truecrypt" class="extiw" title="wikipedia:Truecrypt">TrueCrypt</a> is a free open source on-the-fly encryption (OTFE) program. Some of its features are:
</p>
<ul>
<li>Virtual encrypted disks within files that can be mounted as real disks.</li>
<li>Encryption of an entire hard disk partition or a storage device/medium.</li>
<li>All encryption algorithms use the LRW mode of operation, which is more secure than CBC mode with predictable initialization vectors for storage encryption.</li>
<li>"Hidden volumes" within a normal "outer" encrypted volume. A hidden volume can not be distinguished from random data without access to a passphrase and/or keyfile.</li>
</ul>
<p>For more details on how TrueCrypt compares to other disk encryption solution, see <a href="../en/Data-at-rest_encryption.html#Comparison_table" title="Data-at-rest encryption">Data-at-rest encryption#Comparison table</a>.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Installation"><span class="tocnumber">1</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#Accessing_a_TrueCrypt_or_VeraCrypt_container_using_cryptsetup"><span class="tocnumber">2</span> <span class="toctext">Accessing a TrueCrypt or VeraCrypt container using cryptsetup</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Automounting_using_/etc/crypttab"><span class="tocnumber">2.1</span> <span class="toctext">Automounting using /etc/crypttab</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#Encrypting_a_file_as_a_virtual_volume"><span class="tocnumber">3</span> <span class="toctext">Encrypting a file as a virtual volume</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Encrypting_a_physical_volume"><span class="tocnumber">4</span> <span class="toctext">Encrypting a physical volume</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Creating_a_hidden_volume"><span class="tocnumber">5</span> <span class="toctext">Creating a hidden volume</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Mount_a_special_filesystem"><span class="tocnumber">6</span> <span class="toctext">Mount a special filesystem</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Mount_volumes_via_fstab"><span class="tocnumber">7</span> <span class="toctext">Mount volumes via fstab</span></a></li>
<li class="toclevel-1 tocsection-9">
<a href="#Mount_volumes_as_a_normal_user"><span class="tocnumber">8</span> <span class="toctext">Mount volumes as a normal user</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#Method_1:_add_a_truecrypt_group"><span class="tocnumber">8.1</span> <span class="toctext">Method 1: add a truecrypt group</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Method_2:_sudo_simplified"><span class="tocnumber">8.2</span> <span class="toctext">Method 2: sudo simplified</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Automatic_mount_on_login"><span class="tocnumber">8.3</span> <span class="toctext">Automatic mount on login</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="#Safely_unmount_and_unmap_volumes_(on_shutdown)"><span class="tocnumber">9</span> <span class="toctext">Safely unmount and unmap volumes (on shutdown)</span></a></li>
<li class="toclevel-1 tocsection-14">
<a href="#Errors"><span class="tocnumber">10</span> <span class="toctext">Errors</span></a>
<ul>
<li class="toclevel-2 tocsection-15"><a href="#TrueCrypt_is_already_running"><span class="tocnumber">10.1</span> <span class="toctext">TrueCrypt is already running</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Deleted_stale_lockfile"><span class="tocnumber">10.2</span> <span class="toctext">Deleted stale lockfile</span></a></li>
<li class="toclevel-2 tocsection-17">
<a href="#Issues_with_Unicode_file/folder_names"><span class="tocnumber">10.3</span> <span class="toctext">Issues with Unicode file/folder names</span></a>
<ul>
<li class="toclevel-3 tocsection-18"><a href="#NTFS"><span class="tocnumber">10.3.1</span> <span class="toctext">NTFS</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="#FAT"><span class="tocnumber">10.3.2</span> <span class="toctext">FAT</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-20"><a href="#Unmount_error_(device_mapper)"><span class="tocnumber">10.4</span> <span class="toctext">Unmount error (device mapper)</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#Mount_error_(device_mapper,_truecrypt_partition)"><span class="tocnumber">10.5</span> <span class="toctext">Mount error (device mapper, truecrypt partition)</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#Failed_to_set_up_a_loop_device"><span class="tocnumber">10.6</span> <span class="toctext">Failed to set up a loop device</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="#System_partition_passwords_need_en_US_keymap"><span class="tocnumber">10.7</span> <span class="toctext">System partition passwords need en_US keymap</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="#Permission_denied_on_NTFS_volume"><span class="tocnumber">10.8</span> <span class="toctext">Permission denied on NTFS volume</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#Corrupted_standard_volume_file_system"><span class="tocnumber">10.9</span> <span class="toctext">Corrupted standard volume file system</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-26"><a href="#See_also"><span class="tocnumber">11</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> For opening and accessing an existing TrueCrypt container <a href="#Accessing_a_TrueCrypt_or_VeraCrypt_container_using_cryptsetup">cryptsetup</a> is the preferred way, since it is well integrated with the rest of the system. Creating a new TrueCrypt container can be done using <code>truecrypt</code>, after which it can be opened using <code>cryptsetup</code>.</div>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=truecrypt">truecrypt</a></span> from the <a href="../en/Official_repositories.html" title="Official repositories">official repositories</a>.
If you use any kernel other than <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> install the corresponding kernel module.
</p>
<p>If you are using truecrypt to encrypt a virtual filesystem (e.g. a file), the module will be automatically loaded whenever you run the <i>truecrypt</i> command.
</p>
<p>If you are using truecrypt to encrypt a physical device (e.g. a hard disk or usb drive), you will likely want to load the module during the boot sequence:
</p>
<p>Add the module to <code>/etc/modules-load.d/</code>:
</p>
<pre># tee /etc/modules-load.d/truecrypt.conf &lt;&lt;&lt; "truecrypt"
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul><li>This didn't work for me (module truecrypt seems to be non-existent now), but adding "loop" module worked</li></ul>
<pre># tee /etc/modules-load.d/truecrypt.conf &lt;&lt;&lt; "loop"
# modprobe loop
</pre>
<ul><li>It does not appear that loading a module applies with TrueCrypt 7.1a, the current version in Arch as of 4/19/2013. The above advice may be outdated with respect to the module, however it is still important to enable <b>FUSE</b>, <b>loop</b> and your encryption algorithm (e.g. <b>AES</b>, <b>XTS</b>, <b>SHA512</b>) in custom kernels.</li></ul>
<p>If you only want to open and access an existing truecrypt container, this can also be done with <code>cryptsetup</code> i.e. without installing Truecrypt.
</p>
</div>
<h2><span class="mw-headline" id="Accessing_a_TrueCrypt_or_VeraCrypt_container_using_cryptsetup">Accessing a TrueCrypt or VeraCrypt container using cryptsetup</span></h2>
<p>Since version 1.6.7, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cryptsetup">cryptsetup</a></span> supports opening TrueCrypt and VeraCrypt containers natively, without the need of the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=truecrypt">truecrypt</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=veracrypt">veracrypt</a></span> package. Use the following command as a guideline.
</p>
<pre>$ cryptsetup --type tcrypt open container-to-mount container-name
</pre>
<p>To mount a VeraCrypt cointainer, you must use the <code>--veracrypt</code> option alongside <code>--type tcrypt</code>. If using a custom Personal Iteration Multiplier (PIM), use the <code>--veracrypt-query-pim</code> option to be promoted for the PIM.
</p>
<p>Replace <code>container-to-mount</code> with the device file under <code>/dev</code> or the path to the file you wish to open. Upon successful opening, the plaintext device will appear as <code>/dev/mapper/container-name</code>, which you can <code>mount</code> like any normal device.
</p>
<p>If you are using key files, supply them using the <code>--key-file</code> option, to open a hidden volume, supply the <code>--tcrypt-hidden</code> option and for a partition or whole drive that is encrypted in system mode use the <code>--tcrypt-system</code> option.
</p>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 8 cryptsetup"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cryptsetup.8">cryptsetup(8)</a></span> for more details and all supported options.
</p>
<h3>
<span id="Automounting_using_.2Fetc.2Fcrypttab"></span><span class="mw-headline" id="Automounting_using_/etc/crypttab">Automounting using /etc/crypttab</span>
</h3>
<p>Since version 206, <a href="../en/Systemd.html" title="Systemd">systemd</a> supports (auto)mounting TrueCrypt containers at boot or runtime using <code>/etc/crypttab</code>.
</p>
<p>The following example setup will mount <code>/dev/sda2</code> in system encryption mode as soon as <code>/mnt/truecrypt-volume</code> is accessed using systemd's automounting logic. The passphrase to open the volume is given in <code>/etc/volume.password</code>. Note that the device file given in <code>/etc/fstab</code> needs to be the one from <code>/dev/mapper/</code> and not, for example, from <code>/dev/disk/by-uuid/</code> for automounting logic to kick in. Other than that you can still reliably identify the encrypted volume itself inside of <code>/etc/crypttab</code> using device file names from <code>/dev/disk/</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">truecrypt-volume    /dev/sda2    /etc/volume.password    tcrypt-system,noauto
</pre>
<p>For a standard truecrypt volume, use <i>tcrypt</i> instead of <i>tcrypt-system</i>. And for a hidden one, use <i>tcrypt-hidden</i>. For a veracrypt volume, use <i>tcrypt-veracrypt</i> alongside <i>tcrypt</i>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/dev/mapper/truecrypt-volume    /mnt/truecrypt-volume    auto    noauto,x-systemd.automount    0    0
</pre>
<p>Instead of <i>auto</i>, you can put directly your filesystem, and put usual mount options. It is useful with NTFS for mounting as a normal user.
</p>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 5 crypttab"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/crypttab.5">crypttab(5)</a></span> for more details and options supported.
</p>
<h2><span class="mw-headline" id="Encrypting_a_file_as_a_virtual_volume">Encrypting a file as a virtual volume</span></h2>
<p>The following instructions will create a file that will act as a virtual filesystem, allowing you to mount it and store files within the encrypted file. This is a convenient way to store sensitive information, such as financial data or passwords, in a single file that can be accessed from Linux, Windows, or Macs.
</p>
<p>To create a new truecrypt file interactively, type the following in a terminal:
</p>
<pre>$ truecrypt -t -c
</pre>
<p>Follow the instructions, choosing the default values unless you know what you are doing:
</p>
<pre>Volume type:
 1) Normal
 2) Hidden
Select [1]: 1
</pre>
<pre>Enter file or device path for new volume: /home/user/<i>EncryptedFile</i>.tc
</pre>
<pre>Enter volume size (bytes - size/sizeK/sizeM/sizeG): 32M
</pre>
<pre>Encryption algorithm:
 1) AES
 2) Blowfish
 3) CAST5
 4) Serpent
 5) Triple DES
 6) Twofish
 7) AES-Twofish
 8) AES-Twofish-Serpent
 9) Serpent-AES
10) Serpent-Twofish-AES
11) Twofish-Serpent
Select [1]: 1
</pre>
<pre>Hash algorithm:
 1) RIPEMD-160
 2) SHA-1
 3) Whirlpool
Select [1]: 1  
</pre>
<p>Filesystem:
</p>
<pre>1) None
2) FAT
3) Linux Ext2
4) Linux Ext3
5) Linux Ext4
</pre>
<p>Select [2]: 
</p>
<pre>Enter password for new volume '/home/user/<i>EncryptedFile</i>.tc': *****************************
Re-enter password: *****************************
</pre>
<pre>Enter keyfile path [none]: 
</pre>
<pre>Please type at least 320 randomly chosen characters and then press Enter:
</pre>
<pre>Done: 32.00 MB  Speed: 10.76 MB/s  Left: 0:00:00  
Volume created.
</pre>
<p>You can now mount the new encrypted file to a previously-created directory:
</p>
<pre>$ truecrypt -t /home/user/<i>EncryptedFile</i>.tc /home/user/<i>EncryptedFileFolder</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Truecrypt requires root privileges and as such, running the above command as a user will attempt to use <b>sudo</b> for authentication.  To work with files as a regular user, please see<a href="#Mount_volumes_as_a_normal_user">Mount volumes as a normal user</a>.</div>
<p>Once mounted, you can copy or create new files within the encrypted directory as if it was any normal directory. When you are you ready to re-encrypt the contents and unmount the directory, run:
</p>
<pre>$ truecrypt -t -d
</pre>
<p>Again, this will require administrator privileges through the use of <b>sudo</b>. After running it check if the files that are to be encrypted are indeed no longer in the directory. (might want to try unimportant data first) If they are still there, note that <i>rm</i> doesn't make the data unrecoverable.
</p>
<p>For more information about truecrypt in general, run:
</p>
<pre>$ man truecrypt
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> As of 1:7.1a-1 dont see a man or info page.</div>
<p>Several options can be passed at the command line, making automated access and creation a simple task.  The man page is highly recommended reading.
</p>
<h2><span class="mw-headline" id="Encrypting_a_physical_volume">Encrypting a physical volume</span></h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you are having problems with the graphical interface, you can run in CLI mode with the -t flag.</div>
<p>If you want to use a keyfile, create one with this command:
</p>
<pre>truecrypt --create-keyfile /etc/disk.key
</pre>
<p>By default both passphrase and key will be needed to unlock the volume.
</p>
<p>Create a new volume in the device <code>/dev/sda1</code>:
</p>
<pre># truecrypt --volume-type=normal -c /dev/sda1
</pre>
<p>Map the volume to <code>/dev/mapper/truecrypt1</code>:
</p>
<pre># truecrypt -N 1 /dev/sda1
</pre>
<p>If this command does not for you try this to map the volume:
</p>
<pre># truecrypt --filesystem=none --slot=1 /dev/sda1
</pre>
<p>Simply format the disk like you normally would choosing your favourite <a href="../en/File_systems.html" class="mw-redirect" title="File system">file system</a>, except use the path <code>/dev/mapper/truecrypt1</code>. E.g. for ext4 use:
</p>
<pre># mkfs.ext4 /dev/mapper/truecrypt1
</pre>
<p>Mount the volume:
</p>
<pre># mount /dev/mapper/truecrypt1 /media/disk
</pre>
<p>Map and mount a volume:
</p>
<pre># truecrypt /dev/sda1 /media/disk
</pre>
<p>Unmount and unmap a volume:
</p>
<pre># truecrypt -d /dev/sda1
</pre>
<h2><span class="mw-headline" id="Creating_a_hidden_volume">Creating a hidden volume</span></h2>
<p>First, create a normal outer volume as described in <a href="#Encrypting_a_physical_volume">#Encrypting a physical volume</a>.
</p>
<p>Map the outer volume to <code>/dev/mapper/truecrypt1</code>:
</p>
<pre># truecrypt -N 1 /dev/sda1
</pre>
<p>Create a hidden truecrypt volume in the free space of the outer volume:
</p>
<pre> # truecrypt --type hidden -c /dev/sda1
</pre>
<p>You need to use another passphrase and/or keyfile here than the one you used for the outer volume.
</p>
<p>Unmap the outer truecrypt volume and map the hidden one:
</p>
<pre># truecrypt -d /dev/sda1
# truecrypt -N 1 /dev/sda1
</pre>
<p>Just use the passphrase  you chose for the hidden volume and TrueCrypt will automatically choose it before the outer.
</p>
<p>Create a file system on it (if you have not already) and mount it:
</p>
<pre># mkfs.ext4 /dev/mapper/truecrypt1
# mount /dev/mapper/truecrypt1 /media/disk
</pre>
<p>Map and mount the outer volume with the hidden write-protected:
</p>
<pre>truecrypt -P /dev/sda1 /media/disk
</pre>
<h2><span class="mw-headline" id="Mount_a_special_filesystem">Mount a special filesystem</span></h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Current Versions of truecrypt seem to support NTFS write support by default so the <code>--filesystem</code> flag no longer seems to be necessary.</div>
<p>In the following example I want to mount a ntfs-volume, but TrueCrypt does not use <i>ntfs-3g by</i> default (so there is no write access; checked in version 6.1).
The following command works for me:
</p>
<pre>truecrypt --filesystem=ntfs-3g --mount /file/you/want/to/mount
</pre>
<p>You may also want to mount ntfs volume without execute flag on all files
</p>
<pre>truecrypt --filesystem=ntfs-3g --fs-options=users,uid=$(id -u),gid=$(id -g),fmask=0113,dmask=0002
</pre>
<h2><span class="mw-headline" id="Mount_volumes_via_fstab">Mount volumes via fstab</span></h2>
<p>First of all, we need to write a script which will handle the way mounting via fstab is done. Place the following in <code>/usr/bin/mount.truecrypt</code>:
</p>
<pre>#!/bin/sh
DEV="$1"
MNTPT="$2"
OPTIONS=""
TCOPTIONS=""

shift 3
IFS=','
for arg in $*; do
    case "$arg" in
        system)                   TCOPTIONS=(${TCOPTIONS[*]} --m=system);;
        fs*)                      TCOPTIONS=(${TCOPTIONS[*]} --filesystem=${arg#*=});;
        keyfiles*)                TCOPTIONS=(${TCOPTIONS[*]} --keyfiles=${arg#*=});;
        password*)                TCOPTIONS=(${TCOPTIONS[*]} --password=${arg#*=}) &amp;&amp; echo "password triggered" ;;
        protect-hidden*)          TCOPTIONS=(${TCOPTIONS[*]} --protect-hidden=${arg#*=});;
        *)                        OPTIONS="${OPTIONS}${arg},";;

    esac
done

/bin/truecrypt --text --non-interactive ${DEV} ${MNTPT} ${TCOPTIONS[*]} --fs-options="${OPTIONS%,*}"
</pre>
<p>Also do not forget to make the file executable:
</p>
<pre># chmod +x /usr/bin/mount.truecrypt
</pre>
<p>Finally, add the device to fstab somewhat like this:
</p>
<pre>/dev/sdb3 /mnt truecrypt fs=vfat,defaults 0 0
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> This script is also provided by the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/truecrypt-mount/">truecrypt-mount</a></span><sup><small>AUR</small></sup> package.</div>
<h2><span class="mw-headline" id="Mount_volumes_as_a_normal_user">Mount volumes as a normal user</span></h2>
<p>TrueCrypt needs root privileges to work: this procedure will allow normal users to use it, also giving writing permissions to mounted volumes.
</p>
<p>Both methods below require <a href="../en/Sudo.html" title="Sudo">Sudo</a>.  Make sure it is configured before proceeding.
</p>
<h3><span class="mw-headline" id="Method_1:_add_a_truecrypt_group">Method 1: add a truecrypt group</span></h3>
<p>Create a new group called truecrypt and give it the necessary permissions. Any users that belongs to that group, will be able to use TrueCrypt.
</p>
<pre># groupadd truecrypt
</pre>
<p>Edit the sudo configuration:
</p>
<pre># visudo
</pre>
<p>Append the following lines at the bottom of the sudo configuration file:
</p>
<pre># Users in the truecrypt group are allowed to run TrueCrypt as root.
%truecrypt ALL=(root) NOPASSWD:/usr/bin/truecrypt
</pre>
<p>You can now add your users to the truecrypt group:
</p>
<pre># gpasswd -M first_user,second_user,etc truecrypt
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> In order to make these changes active, any user that has been added to the truecrypt group have to logout.</div>
<p>After that, you can mount your device by
</p>
<pre># truecrypt --mount <i>/path/to/device</i> <i>/path/to/mountpoint</i>
</pre>
<p>Default mountpoint is <code>/media/truecrypt1</code>. Normally, it is not necessary to explicitly specify the filesystem of your device using the <code>--filesystem</code> flag.
</p>
<p>It is definitely reasonable to give truecrypt some permission masks. Otherwise, every file on your mounted device will be executable. So instead of the above, you can use
</p>
<pre># truecrypt --fs-options=users,uid=$(id -u),gid=$(id -g),fmask=0113,dmask=0002 --mount /PATH/TO/DEVICE /PATH/TO/MOUNTPOINT
</pre>
<p>and add this line to your bash configuration file, <code>~/.bashrc</code> as an alias:
</p>
<pre>alias tc1='truecrypt --fs-options=users,uid=$(id -u),gid=$(id -g),fmask=0113,dmask=0002 --mount <i>/path/to/device"" </i>/path/to/mountpoint'
</pre>
<p>To mount this specific device, use
</p>
<pre># tc1
</pre>
<p>as a normal user.
</p>
<h3><span class="mw-headline" id="Method_2:_sudo_simplified">Method 2: sudo simplified</span></h3>
<p>Simply enable desired user to run truecrypt without a password:
</p>
<pre># visudo
</pre>
<p>Append the following:
</p>
<pre>USERNAME ALL = (root) NOPASSWD:/usr/bin/truecrypt
</pre>
<p>alternatively, if you make use of the wheel group:
</p>
<pre>%wheel ALL = (root) NOPASSWD:/usr/bin/truecrypt
</pre>
<p>If you have any difficulties with permissions as a normal user, just add the <code>-u</code> flag to the truecrypt mount command, for example:
</p>
<pre>$ truecrypt -u /home/user/<i>EncryptedFile</i>.tc /home/user/<i>EncryptedFileFolder</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  If you are using VeraCrypt, from <code>veracrypt-1.2.4-hotfix1</code>, the <code>NOPASSWD: /usr/bin/veracrypt</code> piece must be replaced with <code>NOPASSWD: /usr/bin/veracrypt, /usr/bin/uptime</code>. More info available at <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/64431">FS#64431</a> and <a rel="nofollow" class="external autonumber" href="https://sourceforge.net/p/veracrypt/discussion/general/thread/604d12bba8/">[4]</a>.</div>
<h3><span class="mw-headline" id="Automatic_mount_on_login">Automatic mount on login</span></h3>
<p>Simply add:
</p>
<pre>$ truecrypt /home/user/<i>Encrypted File</i>.tc /home/user/<i>Encrypted File Folder</i> &lt;&lt;EOF
<i>password</i>
EOF
</pre>
<p>to your startup procedure. Do not use the <code>-p</code> switch, this method is more secure. Otherwise everyone can just look up the password via <i>ps</i> and similar tools, as it is in the process name! <a rel="nofollow" class="external text" href="https://thoughtyblog.wordpress.com/2009/07/05/truecrypt-linux-hide-password-from-ps/">source</a>
</p>
<p>The most recent truecrypt has a couple of followup questions. If you have expect installed, this will work (assuming no keyfile and no desire to protect hidden volume), saved to a file with root-only perms called from /etc/rc.local:
</p>
<pre>#! /bin/bash
expect &lt;&lt; EOF
spawn /usr/bin/truecrypt ''/path/to/EncryptedFile'' ''/mount/point''
expect "Enter password"
send "volume password\n"
expect "Enter keyfile"
send "\n"
expect "Protect hidden volume"
send "\n"
expect eof;
EOF
</pre>
<p>Of course, this isn't as secure as entering your password manually. But for some use cases, such as when your TrueCrypt filesystem is in a file on shared storage, it's better than being unencrypted.
</p>
<h2>
<span id="Safely_unmount_and_unmap_volumes_.28on_shutdown.29"></span><span class="mw-headline" id="Safely_unmount_and_unmap_volumes_(on_shutdown)">Safely unmount and unmap volumes (on shutdown)</span>
</h2>
<p>You can unmount a specific device by
</p>
<pre># truecrypt -d <i>/path/to/mountpoint</i>
</pre>
<p>or leave away the path to unmount all truecrypt volumes.
</p>
<p>If you want your truecrypt device to be unmounted automatically at shutdown, add the following to the file <code>/etc/rc.local.shutdown</code>:
</p>
<pre>if (/usr/bin/truecrypt --text --list)
then {
/usr/bin/truecrypt -d
sleep 3
}
fi
</pre>
<p>You can also leave away the <i>sleep</i> command, it is just to give the unmounting some time to complete before the actual shutdown.
</p>
<h2><span class="mw-headline" id="Errors">Errors</span></h2>
<h3><span class="mw-headline" id="TrueCrypt_is_already_running">TrueCrypt is already running</span></h3>
<p>If a messagebox <i>TrueCrypt is already running</i> appears when starting TrueCrypt, check for a hidden file in the home directory of the concerned user called <i>.TrueCrypt-lock-username</i>. Substitute <i>username</i> with the individual username. Delete the file and start TrueCrypt again.
</p>
<h3><span class="mw-headline" id="Deleted_stale_lockfile">Deleted stale lockfile</span></h3>
<p>If you always get a message "Delete stale lockfile [....]" after starting Truecrypt, the Truecrypt process with the lowest ID has to be killed during Gnome log out. Edit <code>/etc/gdm/PostSession/Default</code> and add the following line before exit 0:
</p>
<pre>kill $(ps -ef | grep truecrypt | tr -s ' ' | cut -d ' ' -f 2)
</pre>
<h3>
<span id="Issues_with_Unicode_file.2Ffolder_names"></span><span class="mw-headline" id="Issues_with_Unicode_file/folder_names">Issues with Unicode file/folder names</span>
</h3>
<h4><span class="mw-headline" id="NTFS">NTFS</span></h4>
<p>Should files resp. folders containing Unicode characters in their names be incorrectly or not at all displayed on TrueCrypt NTFS volumes (while e. g. being correctly handled on non-encrypted NTFS partitions), first verify that you have the <a href="../en/NTFS-3G.html" title="NTFS-3G">NTFS-3G</a> driver installed and then create the following symlink as root:
</p>
<pre>ln -s /sbin/mount.ntfs-3g /sbin/mount.ntfs
</pre>
<p>That will cause TrueCrypt to automatically use this driver for NTFS volumes, having the same effect as the explicit use of
</p>
<pre>truecrypt --filesystem=ntfs-3g /path/to/volume
</pre>
<p>via the console.
</p>
<p>One may also consider setting e.g.:
</p>
<pre>rw,noatime
</pre>
<p>amongst other options in the TrueCrypt GUI (<i>Settings &gt; Preferences &gt; Mount Options</i>).
</p>
<h4><span class="mw-headline" id="FAT">FAT</span></h4>
<p>Similarly, FAT32 volumes created using Windows may use Unicode rather than ISO 8859-1. In order to use UTF-8 globally, set the mount option:
</p>
<pre>iocharset=utf8
</pre>
<p>Alternatively, when mounting volumes locally use:
</p>
<pre>--fs-options=iocharset=utf8
</pre>
<p>Since linux-4.14.4, UTF8 charset is enabled by default. So in order to mount volumes using ISO 8859-1 encoding, you need to use <code>--fs-options=utf8=no</code>, see <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/56781">FS#56781</a>.
</p>
<h3>
<span id="Unmount_error_.28device_mapper.29"></span><span class="mw-headline" id="Unmount_error_(device_mapper)">Unmount error (device mapper)</span>
</h3>
<p>If you always get a message "device-mapper: remove ioctl failed: Device or resource busy" when attempting to dismount your truecrypt volume, the solution is to goto: Setting &gt; Preferences &gt; System Integration &gt; Kernel Service and check the box
</p>
<pre>Do not use kernel cryptographic services
</pre>
<h3>
<span id="Mount_error_.28device_mapper.2C_truecrypt_partition.29"></span><span class="mw-headline" id="Mount_error_(device_mapper,_truecrypt_partition)">Mount error (device mapper, truecrypt partition)</span>
</h3>
<p>When attempting to mount your truecrypt volume, a message like this one may appear:
</p>
<pre>Error: device-mapper: create ioctl failed: Device or resource busy
Command failed
</pre>
<p>If so, run:
</p>
<pre># cryptsetup remove /dev/mapper/truecrypt1
</pre>
<h3><span class="mw-headline" id="Failed_to_set_up_a_loop_device">Failed to set up a loop device</span></h3>
<p>If you get a message "Failed to set up a loop device" when trying to create/mount a TrueCrypt volume, it may be because you updated your kernel recently without rebooting.
Rebooting should fix this error.
</p>
<p>Otherwise, check if <i>loop</i> has been loaded as kernel module:
</p>
<pre>$ lsmod | grep loop
</pre>
<p>If not listed, retry the TrueCrypt command after <code>modprobe loop</code>. Should it work, consider to add <i>loop</i> to the modules in <code>/etc/modules-load.d</code>:
</p>
<pre># tee /etc/modules-load.d/truecrypt.conf &lt;&lt;&lt; "loop"
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> As of udev 181-5, the loop device module is no longer auto-loaded, and the procedure described here is necessary.</div>
<p>With newer kernel versions there are no loop devices created at startup. If there are no loop devices the first time mounting a container file, TrueCrypt fails ("Failed to set up a loop device") but also creates the maximum number of loop devices (usually 256), mounting should now work.
</p>
<p>To avoid this you can create a loop device before mounting a file:
</p>
<pre># mknod -m 0660 /dev/loop8 b 7 8
</pre>
<p>This creates <code>/dev/loop8</code>. Or create some loop devices at startup:
</p>
<pre># echo "options loop max_loop=8" &gt; /etc/modprobe.d/eightloop.conf
</pre>
<p>Change <code>max_loop=8</code> to the number of devices you need.
</p>
<h3><span class="mw-headline" id="System_partition_passwords_need_en_US_keymap">System partition passwords need en_US keymap</span></h3>
<p>If you are using Xorg (which you most likely are, should you not know what that is), use the following command to use US keymap until restart:
</p>
<pre># setxkbmap us
</pre>
<h3><span class="mw-headline" id="Permission_denied_on_NTFS_volume">Permission denied on NTFS volume</span></h3>
<p>If you cannot modify the filesystem, although permissions seem to be correct, this can be a result of not having <a href="../en/NTFS-3G.html" title="NTFS-3G">NTFS-3G</a> installed, see <a href="#NTFS">NTFS</a>.
</p>
<h3><span class="mw-headline" id="Corrupted_standard_volume_file_system">Corrupted standard volume file system</span></h3>
<p>In case you cannot access your VeraCrypt volume or container anymore, <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=testdisk">testdisk</a></span> from the <a href="../en/Official_repositories.html" title="Official repositories">official repositories</a>. See more information on <a rel="nofollow" class="external text" href="https://www.cgsecurity.org/wiki/Recover_a_TrueCrypt_Volume">CGSecurity page</a>.
</p>
<pre>$ ./truecrypt -t --filesystem=none /data/data_for_testdisk/truecrypt.dd 
Enter password for /data/data_for_testdisk/truecrypt.dd: 
Enter keyfile [none]: 
Protect hidden volume? (y=Yes/n=No) [No]: 
Enter system administrator password: 
$ mount
...
truecrypt on /tmp/.truecrypt_aux_mnt1 type fuse.truecrypt (rw,nosuid,nodev,allow_other)
$ sudo testdisk /tmp/.truecrypt_aux_mnt1/volume
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="http://www.truecrypt.org/">TrueCrypt homepage</a></li>
<li><a rel="nofollow" class="external text" href="http://www.howtoforge.com/truecrypt_data_encryption">Truecrypt tutorial on HowToForge</a></li>
<li>
<a rel="nofollow" class="external text" href="http://www.privacylover.com/encryption/analysis-is-there-a-backdoor-in-truecrypt-is-truecrypt-a-cia-honeypot/">There is a good chance the CIA has a backdoor?</a><sup title="Last check status: domain name not resolved">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-04-03 ⓘ]</sup> (via <a href="https://en.wikipedia.org/wiki/Truecrypt" class="extiw" title="wikipedia:Truecrypt">Wikipedia</a>)</li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Data-at-rest_encryption.html" title="Category:Data-at-rest encryption">Data-at-rest encryption</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Move.html" title="Category:Pages or sections flagged with Template:Move">Pages or sections flagged with Template:Move</a></li>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=TrueCrypt&amp;oldid=647069">https://wiki.archlinux.org/index.php?title=TrueCrypt&amp;oldid=647069</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 26 December 2020, at 12:27.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
