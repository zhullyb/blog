<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>PostgreSQL - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-PostgreSQL rootpage-PostgreSQL skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">PostgreSQL</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../en/PhpPgAdmin.html" title="PhpPgAdmin">PhpPgAdmin</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://www.postgresql.org/">PostgreSQL</a> is an open source, community driven, standard compliant object-relational database system.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Installation"><span class="tocnumber">1</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Initial_configuration"><span class="tocnumber">2</span> <span class="toctext">Initial configuration</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Create_your_first_database/user"><span class="tocnumber">3</span> <span class="toctext">Create your first database/user</span></a></li>
<li class="toclevel-1 tocsection-4">
<a href="#Familiarize_with_PostgreSQL"><span class="tocnumber">4</span> <span class="toctext">Familiarize with PostgreSQL</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Access_the_database_shell"><span class="tocnumber">4.1</span> <span class="toctext">Access the database shell</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6">
<a href="#Optional_configuration"><span class="tocnumber">5</span> <span class="toctext">Optional configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Restricts_access_rights_to_the_database_superuser_by_default"><span class="tocnumber">5.1</span> <span class="toctext">Restricts access rights to the database superuser by default</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Configure_PostgreSQL_to_be_accessible_exclusively_through_UNIX_Sockets"><span class="tocnumber">5.2</span> <span class="toctext">Configure PostgreSQL to be accessible exclusively through UNIX Sockets</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Configure_PostgreSQL_to_be_accessible_from_remote_hosts"><span class="tocnumber">5.3</span> <span class="toctext">Configure PostgreSQL to be accessible from remote hosts</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Configure_PostgreSQL_authenticate_against_PAM"><span class="tocnumber">5.4</span> <span class="toctext">Configure PostgreSQL authenticate against PAM</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Change_default_data_directory"><span class="tocnumber">5.5</span> <span class="toctext">Change default data directory</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Change_default_encoding_of_new_databases_to_UTF-8"><span class="tocnumber">5.6</span> <span class="toctext">Change default encoding of new databases to UTF-8</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="#Graphical_tools"><span class="tocnumber">6</span> <span class="toctext">Graphical tools</span></a></li>
<li class="toclevel-1 tocsection-14">
<a href="#Upgrading_PostgreSQL"><span class="tocnumber">7</span> <span class="toctext">Upgrading PostgreSQL</span></a>
<ul>
<li class="toclevel-2 tocsection-15"><a href="#pg_upgrade"><span class="tocnumber">7.1</span> <span class="toctext">pg_upgrade</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Manual_dump_and_reload"><span class="tocnumber">7.2</span> <span class="toctext">Manual dump and reload</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-17">
<a href="#Troubleshooting"><span class="tocnumber">8</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-18"><a href="#Improve_performance_of_small_transactions"><span class="tocnumber">8.1</span> <span class="toctext">Improve performance of small transactions</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Prevent_disk_writes_when_idle"><span class="tocnumber">8.2</span> <span class="toctext">Prevent disk writes when idle</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#pgAdmin_4_issues_after_upgrade_to_PostgreSQL_12"><span class="tocnumber">8.3</span> <span class="toctext">pgAdmin 4 issues after upgrade to PostgreSQL 12</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Don't duplicate <a href="../en/Sudo.html" title="Sudo">sudo</a> and <a href="../en/Su.html" title="Su">su</a>. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:PostgreSQL">Talk:PostgreSQL#</a>)</div>
</div>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=postgresql">postgresql</a></span> package. It will also create a system user called <i>postgres</i>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> See <a href="#Upgrading_PostgreSQL">#Upgrading PostgreSQL</a> for necessary steps before installing new versions of the PostgreSQL packages.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Commands that should be run as the <i>postgres</i> user are prefixed by <code>[postgres]$</code> in this article.</div>
<p>You can switch to the PostgreSQL user by executing the following command:
</p>
<ul><li>If you have <a href="../en/Sudo.html" title="Sudo">sudo</a> and are in <a href="../en/Sudo.html#Configuration" class="mw-redirect" title="Sudoers">sudoers</a>:</li></ul>
<dl><dd><pre>$ sudo -iu postgres</pre></dd></dl>
<ul><li>Otherwise using <a href="../en/Su.html" title="Su">su</a>:</li></ul>
<dl><dd><pre>$ su
# su -l postgres
</pre></dd></dl>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 8 sudo"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sudo.8">sudo(8)</a></span> or <span class="plainlinks archwiki-template-man" title="$ man 1 su"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/su.1">su(1)</a></span> for their usage.
</p>
<h2><span class="mw-headline" id="Initial_configuration">Initial configuration</span></h2>
<p>Before PostgreSQL can function correctly, the database cluster must be initialized:
</p>
<pre>[postgres]$ initdb -D /var/lib/postgres/data
</pre>
<p>Where <code>-D</code> is the default location where the database cluster must be stored (see <a href="#Change_default_data_directory">#Change default data directory</a> if you want to use a different one).
</p>
<p>Note that by default, the locale and the encoding for the database cluster are derived from your current environment (using <a href="../en/Locale.html#LANG:_default_locale" title="Locale">$LANG</a> value). <a rel="nofollow" class="external autonumber" href="https://www.postgresql.org/docs/current/static/locale.html">[1]</a>
However, depending on your settings and use cases this might not be what you want, and you can override the defaults using:
</p>
<ul>
<li>
<code>--locale=<i>locale</i></code>, where <i>locale</i> is to be chosen amongst the system's <a href="../en/Locale.html#Generating_locales" title="Locale">available locales</a>;</li>
<li>
<code>-E <i>encoding</i></code> for the encoding (which must match the chosen locale);</li>
</ul>
<p>Example:
</p>
<pre>[postgres]$ initdb --locale=en_US.UTF-8 -E UTF8 -D /var/lib/postgres/data
</pre>
<p>Many lines should now appear on the screen with several ending by <code>... ok</code>:
</p>
<pre>The files belonging to this database system will be owned by user "postgres".
This user must also own the server process.

The database cluster will be initialized with locale "en_US.UTF-8".
The default database encoding has accordingly been set to "UTF8".
The default text search configuration will be set to "english".

Data page checksums are disabled.

fixing permissions on existing directory /var/lib/postgres/data ... ok
creating subdirectories ... ok
selecting default max_connections ... 100
selecting default shared_buffers ... 128MB
selecting dynamic shared memory implementation ... posix
creating configuration files ... ok
running bootstrap script ... ok
performing post-bootstrap initialization ... ok
syncing data to disk ... ok

WARNING: enabling "trust" authentication for local connections
You can change this by editing pg_hba.conf or using the option -A, or
--auth-local and --auth-host, the next time you run initdb.

Success. You can now start the database server using:

    pg_ctl -D /var/lib/postgres/ -l logfile start
</pre>
<p>If these are the kind of lines you see, then the process succeeded. Return to the regular user using <code>exit</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> To read more about this <code>WARNING</code>, see <a href="#Restricts_access_rights_to_the_database_superuser_by_default">#Restricts access rights to the database superuser by default</a>.</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If you change the root to something other than <code>/var/lib/postgres</code>, you will have to <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">edit</a> the service file. If the root is under <code>home</code>, make sure to set <code>ProtectHome</code> to false.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> 
<ul>
<li>If the database resides on a <a href="../en/Btrfs.html" title="Btrfs">Btrfs</a> file system, you should consider disabling <a href="../en/Btrfs.html#Copy-on-Write_(CoW)" title="Btrfs">Copy-on-Write</a> for the directory before creating any database.</li>
<li>If the database resides on a <a href="../en/ZFS.html" title="ZFS">ZFS</a> file system, you should consult <a href="../en/ZFS.html#Databases" title="ZFS">ZFS#Databases</a> before creating any database.</li>
</ul>
</div>
<p>Finally, <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">start</a> and <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Enable">enable</a> the <code>postgresql.service</code>.
</p>
<h2>
<span id="Create_your_first_database.2Fuser"></span><span class="mw-headline" id="Create_your_first_database/user">Create your first database/user</span>
</h2>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If you create a PostgreSQL user with the same name as your Linux username, it allows you to access the PostgreSQL database shell without having to specify a user to login (which makes it quite convenient).</div>
<p>Become the postgres user. Add a new database user using the <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/static/app-createuser.html">createuser</a> command:
</p>
<pre>[postgres]$ createuser --interactive
</pre>
<p>Create a new database over which the above user has read/write privileges using the <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/static/app-createdb.html">createdb</a> command (execute this command from your login shell if the database user has the same name as your Linux user, otherwise add <code>-O <i>database-username</i></code> to the following command):
</p>
<pre>$ createdb myDatabaseName
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If you did not grant your new user database creation privileges, add <code>-U postgres</code> to the previous command.</div>
<h2><span class="mw-headline" id="Familiarize_with_PostgreSQL">Familiarize with PostgreSQL</span></h2>
<h3><span class="mw-headline" id="Access_the_database_shell">Access the database shell</span></h3>
<p>Become the postgres user. Start the primary database shell, <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/static/app-psql.html">psql</a>, where you can do all your creation of databases/tables, deletion, set permissions, and run raw SQL commands. Use the <code>-d</code> option to connect to the database you created (without specifying a database, <code>psql</code> will try to access a database that matches your username).
</p>
<pre>[postgres]$ psql -d myDatabaseName
</pre>
<p>Some helpful commands:
</p>
<p>Get help:
</p>
<pre>=&gt; \help
</pre>
<p>Connect to a particular database:
</p>
<pre>=&gt; \c &lt;database&gt;
</pre>
<p>List all users and their permission levels:
</p>
<pre>=&gt; \du
</pre>
<p>Show summary information about all tables in the current database:
</p>
<pre>=&gt; \dt
</pre>
<p>Exit/quit the <code>psql</code> shell:
</p>
<pre>=&gt; \q or CTRL+d
</pre>
<p>There are of course many more meta-commands, but these should help you get started. To see all meta-commands run: 
</p>
<pre>=&gt; \?
</pre>
<h2><span class="mw-headline" id="Optional_configuration">Optional configuration</span></h2>
<p>The PostgreSQL database server configuration file is <code>postgresql.conf</code>. This file is located in the data directory of the server, typically <code>/var/lib/postgres/data</code>. This folder also houses the other main configuration files, including the <code>pg_hba.conf</code> which defines authentication settings, for both <a href="#Restricts_access_rights_to_the_database_superuser_by_default">local users</a> and <a href="#Configure_PostgreSQL_to_be_accessible_from_remote_hosts">other hosts ones</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> By default, this folder will not be browsable or searchable by a regular user. This is why <code>find</code> and <code>locate</code> are not finding the configuration files.</div>
<h3><span class="mw-headline" id="Restricts_access_rights_to_the_database_superuser_by_default">Restricts access rights to the database superuser by default</span></h3>
<p>The defaults <code>pg_hba.conf</code> <b>allow any local user to connect as any database user</b>, including the database superuser.
This is likely not what you want, so in order to restrict global access to the <i>postgres</i> user, change the following line:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/postgres/data/pg_hba.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># TYPE  DATABASE        USER            ADDRESS                 METHOD

# "local" is for Unix domain socket connections only
local   all             all                                     trust</pre>
<p>To:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/postgres/data/pg_hba.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># TYPE  DATABASE        USER            ADDRESS                 METHOD

# "local" is for Unix domain socket connections only
local   all             postgres                                peer</pre>
<p>You might later add additional lines depending on your needs or software ones.
</p>
<h3><span class="mw-headline" id="Configure_PostgreSQL_to_be_accessible_exclusively_through_UNIX_Sockets">Configure PostgreSQL to be accessible exclusively through UNIX Sockets</span></h3>
<p>In the connections and authentications section of your configuration, set:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/postgres/data/postgresql.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">listen_addresses = ''</pre>
<p>This will disable network listening completely.
After this you should <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Restart">restart</a> <code>postgresql.service</code> for the changes to take effect.
</p>
<h3><span class="mw-headline" id="Configure_PostgreSQL_to_be_accessible_from_remote_hosts">Configure PostgreSQL to be accessible from remote hosts</span></h3>
<p>In the connections and authentications section, set the <code>listen_addresses</code> line to your needs:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/postgres/data/postgresql.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">listen_addresses = 'localhost,<i>my_local_ip_address'</i></pre>
<p>You can use <code>'*'</code> to listen on all available addresses.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> PostgreSQL uses TCP port <code>5432</code> by default for remote connections. Make sure this port is open in your <a href="../en/Category:Firewalls.html" class="mw-redirect" title="Firewall">firewall</a> and able to receive incoming connections. You can also change it in the configuration file, right below <code>listen_addresses</code>
</div>
<p>Then add a line like the following to the authentication config:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/postgres/data/pg_hba.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># TYPE  DATABASE        USER            ADDRESS                 METHOD
# IPv4 local connections:
host    all             all             <i>ip_address</i>/32   md5</pre>
<p>where <code><i>ip_address</i></code> is the IP address of the remote client.
</p>
<p>See the documentation for <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/static/auth-pg-hba-conf.html">pg_hba.conf</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Neither sending your plain password nor the md5 hash (used in the example above) over the Internet is secure if it is not done over an SSL-secured connection. See <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/static/ssl-tcp.html">Secure TCP/IP Connections with SSL</a> for how to configure PostgreSQL with SSL.</div>
<p>After this you should <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Restart">restart</a> <code>postgresql.service</code> for the changes to take effect.
</p>
<p>For troubleshooting take a look in the server log file:
</p>
<pre>$ journalctl -u postgresql.service
</pre>
<h3><span class="mw-headline" id="Configure_PostgreSQL_authenticate_against_PAM">Configure PostgreSQL authenticate against PAM</span></h3>
<p>PostgreSQL offers a number of authentication methods. If you would like to allow users to authenticate with their system password, additional steps are necessary. First you need to enable <a href="../en/PAM.html" title="PAM">PAM</a> for the connection.
</p>
<p>For example, the same configuration as above, but with PAM enabled:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/postgres/data/pg_hba.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># IPv4 local connections:
host   all   all   <i>my_remote_client_ip_address</i>/32   pam</pre>
<p>The PostgreSQL server is however running without root privileges and will not be able to access <code>/etc/shadow</code>. We can work around that by allowing the postgres group to access this file:
</p>
<pre># setfacl -m g:postgres:r /etc/shadow
</pre>
<h3><span class="mw-headline" id="Change_default_data_directory">Change default data directory</span></h3>
<p>The default directory where all your newly created databases will be stored is <code>/var/lib/postgres/data</code>. To change this, follow these steps:
</p>
<p>Create the new directory and make the postgres user its owner:
</p>
<pre># mkdir -p /pathto/pgroot/data
# chown -R postgres:postgres /pathto/pgroot
</pre>
<p>Become the postgres user, and initialize the new cluster:
</p>
<pre>[postgres]$ initdb -D /pathto/pgroot/data
</pre>
<p><a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">Edit</a> <code>postgresql.service</code> to create a drop-in file and override the <code>Environment</code> and <code>PIDFile</code> settings. For example:
</p>
<pre>[Service]
Environment=PGROOT=<i>/pathto/pgroot</i>
PIDFile=<i>/pathto/pgroot/</i>data/postmaster.pid
</pre>
<p>If you want to use <code>/home</code> directory for default directory or for tablespaces, add one more line in this file:
</p>
<pre>ProtectHome=false
</pre>
<h3><span class="mw-headline" id="Change_default_encoding_of_new_databases_to_UTF-8">Change default encoding of new databases to UTF-8</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you ran <code>initdb</code> with <code>-E UTF8</code> or while using an UTF-8 locale, these steps are not required.</div>
<p>When creating a new database (e.g. with <code>createdb blog</code>) PostgreSQL actually copies a template database. There are two predefined templates: <code>template0</code> is vanilla, while <code>template1</code> is meant as an on-site template changeable by the administrator and is used by default. In order to change the encoding of a new database, one of the options is to change on-site <code>template1</code>. To do this, log into PostgreSQL shell (<code>psql</code>) and execute the following:
</p>
<p>First, we need to drop <code>template1</code>. Templates cannot be dropped, so we first modify it so it is an ordinary database:
</p>
<pre>UPDATE pg_database SET datistemplate = FALSE WHERE datname = 'template1';
</pre>
<p>Now we can drop it:
</p>
<pre>DROP DATABASE template1;
</pre>
<p>The next step is to create a new database from <code>template0</code>, with a new default encoding:
</p>
<pre>CREATE DATABASE template1 WITH TEMPLATE = template0 ENCODING = 'UNICODE';
</pre>
<p>Now modify <code>template1</code> so it is actually a template:
</p>
<pre>UPDATE pg_database SET datistemplate = TRUE WHERE datname = 'template1';
</pre>
<p>Optionally, if you do not want anyone connecting to this template, set <code>datallowconn</code> to <code>FALSE</code>:
</p>
<pre>UPDATE pg_database SET datallowconn = FALSE WHERE datname = 'template1';
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This last step can create problems when upgrading via <code>pg_upgrade</code>.</div>
<p>Now you can create a new database:
</p>
<pre>[postgres]$ createdb blog
</pre>
<p>If you log back in to <code>psql</code> and check the databases, you should see the proper encoding of your new database:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">\l</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">                              List of databases
  Name    |  Owner   | Encoding  | Collation | Ctype |   Access privileges
-----------+----------+-----------+-----------+-------+----------------------
blog      | postgres | UTF8      | C         | C     |
postgres  | postgres | SQL_ASCII | C         | C     |
template0 | postgres | SQL_ASCII | C         | C     | =c/postgres
                                                     : postgres=CTc/postgres
template1 | postgres | UTF8      | C         | C     |
</pre>
<h2><span class="mw-headline" id="Graphical_tools">Graphical tools</span></h2>
<ul><li>
<b><a href="../en/PhpPgAdmin.html" title="PhpPgAdmin">phpPgAdmin</a></b> — Web-based administration tool for PostgreSQL.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="http://phppgadmin.sourceforge.net">http://phppgadmin.sourceforge.net</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=phppgadmin">phppgadmin</a></span>
</dd></dl>
<ul><li>
<b>pgAdmin</b> — Comprehensive design and management GUI for PostgreSQL.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://www.pgadmin.org/">https://www.pgadmin.org/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pgadmin3/">pgadmin3</a></span><sup><small>AUR</small></sup> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pgadmin4">pgadmin4</a></span>
</dd></dl>
<ul><li>
<b>pgModeler</b> — Graphical schema designer for PostgreSQL.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://pgmodeler.io/">https://pgmodeler.io/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pgmodeler/">pgmodeler</a></span><sup><small>AUR</small></sup>
</dd></dl>
<p>For tools supporting multiple DBMSs, see <a href="../en/List_of_applications/Documents.html#Database_tools" title="List of applications/Documents">List of applications/Documents#Database tools</a>.
</p>
<h2><span class="mw-headline" id="Upgrading_PostgreSQL">Upgrading PostgreSQL</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Don't show basic systemctl commands, etc. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:PostgreSQL">Talk:PostgreSQL#</a>)</div>
</div>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> How to upgrade when using third party extensions? (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:PostgreSQL#pg_upgrade_problem_if_extensions_(like_postgis)_are_used">Talk:PostgreSQL#pg_upgrade problem if extensions (like postgis) are used</a>)</div>
</div>
<p>Upgrading major PostgreSQL versions requires some extra maintenance.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Official PostgreSQL <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/static/upgrading.html">upgrade documentation</a> should be followed.</li>
<li>From version <code>10.0</code> onwards PostgreSQL <a rel="nofollow" class="external text" href="https://www.postgresql.org/about/news/1786/">changed its versioning scheme</a>. Earlier upgrade from version <code>9.<i>x</i></code> to <code>9.<i>y</i></code> was considered as major upgrade. Now upgrade from version <code>10.<i>x</i></code> to <code>10.<i>y</i></code> is considered as minor upgrade and upgrade from version <code>10.<i>x</i></code> to <code>11.<i>y</i></code> is considered as major upgrade.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> The following instructions could cause data loss. Do not run the commands below blindly, without understanding what they do. <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/static/backup.html">Backup database</a> first.</div>
<p>Get the currently used database version via
</p>
<pre># cat /var/lib/postgres/data/PG_VERSION
</pre>
<p>To ensure you do not accidentally upgrade the database to an incompatible version, it is recommended to <a href="../en/Pacman.html#Skip_package_from_being_upgraded" title="Pacman">skip updates</a> to the PostgreSQL packages:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
IgnorePkg = postgresql postgresql-libs
...</pre>
<p>Minor version upgrades are safe to perform. However, if you do an accidental upgrade to a different major version, you might not be able to access any of your data. Always check the <a rel="nofollow" class="external text" href="https://www.postgresql.org/">PostgreSQL home page</a> to be sure of what steps are required for each upgrade. For a bit about why this is the case, see the <a rel="nofollow" class="external text" href="https://www.postgresql.org/support/versioning">versioning policy</a>.
</p>
<p>There are two main ways to upgrade your PostgreSQL database. Read the official documentation for details.
</p>
<h3><span class="mw-headline" id="pg_upgrade">pg_upgrade</span></h3>
<p>For those wishing to use <code>pg_upgrade</code>, a <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=postgresql-old-upgrade">postgresql-old-upgrade</a></span> package is available that will always run one major version behind the real PostgreSQL package. This can be installed side-by-side with the new version of PostgreSQL. To upgrade from older versions of PostgreSQL there are AUR packages available: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/postgresql-96-upgrade/">postgresql-96-upgrade</a></span><sup><small>AUR</small></sup>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/postgresql-95-upgrade/">postgresql-95-upgrade</a></span><sup><small>AUR</small></sup>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/postgresql-94-upgrade/">postgresql-94-upgrade</a></span><sup><small>AUR</small></sup>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/postgresql-93-upgrade/">postgresql-93-upgrade</a></span><sup><small>AUR</small></sup>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/postgresql-92-upgrade/">postgresql-92-upgrade</a></span><sup><small>AUR</small></sup>. Read the <span class="plainlinks archwiki-template-man" title="$ man 1 pg_upgrade"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pg_upgrade.1">pg_upgrade(1)</a></span> man page to understand what actions it performs.
</p>
<p>Note that the databases cluster directory does not change from version to version, so before running <code>pg_upgrade</code>, it is necessary to rename your existing data directory and migrate into a new directory. The new databases cluster must be initialized, as described in the <a href="#Installation">#Installation</a> section.
</p>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> The description of the <i>initdb</i> command is getting way too long and starts duplicating <a href="#Initial_configuration">#Initial configuration</a>. Why not just say that the same options which were used for the initial creation should be used here? (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:PostgreSQL">Talk:PostgreSQL#</a>)</div>
</div>
<p>While the database is still accessible, one may take the opportunity to check the locale and encoding used, and whether data checksums are used:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">[postgres]$ psql -l</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">                                  List of databases
   Name    |  Owner   | Encoding |   Collate   |    Ctype    |   Access privileges   
-----------+----------+----------+-------------+-------------+-----------------------
 postgres  | postgres | UTF8     | fr_FR.UTF-8 | fr_FR.UTF-8 | 
 template0 | postgres | UTF8     | fr_FR.UTF-8 | fr_FR.UTF-8 | =c/postgres          +
           |          |          |             |             | postgres=CTc/postgres
 template1 | postgres | UTF8     | fr_FR.UTF-8 | fr_FR.UTF-8 | =c/postgres          +
           |          |          |             |             | postgres=CTc/postgres
(3 rows)
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">[postgres]$ psql -c "SHOW data_checksums"</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> data_checksums 
----------------
 off
(1 row)
</pre>
<p>When you are ready, stop the postgresql service, upgrade the following packages: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=postgresql">postgresql</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=postgresql-libs">postgresql-libs</a></span>, and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=postgresql-old-upgrade">postgresql-old-upgrade</a></span>. Finally upgrade the databases cluster.
</p>
<p>Stop and make sure PostgreSQL is stopped:
</p>
<pre># systemctl stop postgresql.service
# systemctl status postgresql.service
</pre>
<p>Make sure that PostgresSQL was stopped correctly. If it failed, <code>pg_upgrade</code> will fail too.
</p>
<p>Upgrade the packages:
</p>
<pre># pacman -S postgresql postgresql-libs postgresql-old-upgrade
</pre>
<p>Rename the databases cluster directory, and create an empty one:
</p>
<pre># mv /var/lib/postgres/data /var/lib/postgres/olddata
# mkdir /var/lib/postgres/data /var/lib/postgres/tmp
# chown postgres:postgres /var/lib/postgres/data /var/lib/postgres/tmp
[postgres]$ cd /var/lib/postgres/tmp
[postgres]$ initdb -D /var/lib/postgres/data
</pre>
<p>Should you have a conflicting system locale and encoding, add <code>--locale=<i>xy_XY.UTF-8</i></code> <code>--encoding=UTF8</code> options (where <i>xx_YY</i> matches your need).
Should you have data-checksums enabled, add <code>--data-checksums</code> option.
</p>
<p>Upgrade the cluster, replacing <code><i>PG_VERSION</i></code> below, with the old PostgreSQL version number (e.g. <code>12</code>):
</p>
<pre>[postgres]$ pg_upgrade -b /opt/pgsql-<i>PG_VERSION</i>/bin -B /usr/bin -d /var/lib/postgres/olddata -D /var/lib/postgres/data
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If necessary, adjust the configuration files of new cluster (e.g. <code>pg_hba.conf</code> and <code>postgresql.conf</code>) to match the old cluster.</div>
<p><code>pg_upgrade</code> will perform the upgrade and create some scripts in <code>/var/lib/postgres/tmp/</code>. Follow the instructions given on screen and act accordingly. You may delete the <code>/var/lib/postgres/tmp</code> directory once the upgrade is completely over.
</p>
<p>Start the cluster:
</p>
<pre># systemctl start postgresql.service
</pre>
<h3><span class="mw-headline" id="Manual_dump_and_reload">Manual dump and reload</span></h3>
<p>You could also do something like this (after the upgrade and install of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=postgresql-old-upgrade">postgresql-old-upgrade</a></span>).
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Below are the commands for upgrading from PostgreSQL 12. You can find similar commands in <code>/opt/</code> for your version of PostgreSQL cluster, provided you have matching version of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=postgresql-old-upgrade">postgresql-old-upgrade</a></span> package installed.</li>
<li>If you had customized your <code>pg_hba.conf</code> file, you may have to temporarily modify it to allow full access to old database cluster from local system. After upgrade is complete set your customization to new database cluster as well and <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Restart">restart</a> <code>postgresql.service</code>.</li>
</ul>
</div>
<pre># systemctl stop postgresql.service
# mv /var/lib/postgres/data /var/lib/postgres/olddata
# mkdir /var/lib/postgres/data
# chown postgres:postgres /var/lib/postgres/data
[postgres]$ initdb -D /var/lib/postgres/data
[postgres]$ /opt/pgsql-12/bin/pg_ctl -D /var/lib/postgres/olddata/ start
[postgres]$ pg_dumpall -h /tmp -f /tmp/old_backup.sql
[postgres]$ /opt/pgsql-12/bin/pg_ctl -D /var/lib/postgres/olddata/ stop
# systemctl start postgresql.service
[postgres]$ psql -f /tmp/old_backup.sql postgres
</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Improve_performance_of_small_transactions">Improve performance of small transactions</span></h3>
<p>If you are using PostgresSQL on a local machine for development and it seems slow, you could try turning <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/static/runtime-config-wal.html#GUC-SYNCHRONOUS-COMMIT">synchronous_commit off</a> in the configuration. Beware of the <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/static/runtime-config-wal.html#GUC-SYNCHRONOUS-COMMIT">caveats</a>, however.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/postgres/data/postgresql.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">synchronous_commit = off</pre>
<h3><span class="mw-headline" id="Prevent_disk_writes_when_idle">Prevent disk writes when idle</span></h3>
<p>PostgreSQL periodically updates its internal "statistics" file. By default, this file is stored on disk, which prevents disks from spinning down on laptops and causes hard drive seek noise. It is simple and safe to relocate this file to a memory-only file system with the following configuration option:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/postgres/data/postgresql.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">stats_temp_directory = '/run/postgresql'</pre>
<h3><span class="mw-headline" id="pgAdmin_4_issues_after_upgrade_to_PostgreSQL_12">pgAdmin 4 issues after upgrade to PostgreSQL 12</span></h3>
<p>If you see errors about <code>string indices must be integers</code> when navigating the tree on the left, or about <code>column rel.relhasoids does not exist</code> when viewing the data, remove the server from the connection list in pgAdmin and add a fresh server instance. pgAdmin will otherwise continue to treat the server as a PostgreSQL 11 server resulting in these issues.
</p>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Relational_DBMSs.html" title="Category:Relational DBMSs">Relational DBMSs</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=PostgreSQL&amp;oldid=646515">https://wiki.archlinux.org/index.php?title=PostgreSQL&amp;oldid=646515</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 24 December 2020, at 17:48.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
