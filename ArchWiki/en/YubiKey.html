<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>YubiKey - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-YubiKey rootpage-YubiKey skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">YubiKey</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../en/Universal_2nd_Factor.html" title="Universal 2nd Factor">Universal 2nd Factor</a></li>
<li><a href="../en/Initiative_for_Open_Authentication.html" class="mw-redirect" title="OATH">OATH</a></li>
<li><a href="../en/Dm-crypt/Encrypting_an_entire_system.html" title="Dm-crypt/Encrypting an entire system">dm-crypt/Encrypting an entire system</a></li>
<li><a href="../en/PAM.html" title="PAM">PAM</a></li>
<li><a href="../en/GnuPG.html" title="GnuPG">GnuPG</a></li>
<li><a href="../en/KeePass.html" title="KeePass">KeePass</a></li>
</ul>
</div>
<p>The <a rel="nofollow" class="external text" href="https://www.yubico.com">YubiKey</a> is a small <a href="https://en.wikipedia.org/wiki/Security_token" class="extiw" title="wikipedia:Security token">USB Security token</a>. Depending on the model, it can:
</p>
<ul>
<li>Act as a smartcard (using the <a href="https://en.wikipedia.org/wiki/CCID_(protocol)" class="extiw" title="wikipedia:CCID (protocol)">CCID protocol</a>) - allowing storage of both <a rel="nofollow" class="external text" href="https://developers.yubico.com/PGP/">PGP</a> and <a rel="nofollow" class="external text" href="https://developers.yubico.com/PIV/">PIV</a> secret keys.</li>
<li>Handle <a href="https://en.wikipedia.org/wiki/Universal_2nd_Factor" class="extiw" title="wikipedia:Universal 2nd Factor">Universal 2nd Factor</a> (U2F) requests.</li>
<li>Store and query approximately 30 <a href="https://en.wikipedia.org/wiki/Initiative_for_Open_Authentication" class="extiw" title="wikipedia:Initiative for Open Authentication">OATH</a> credentials.</li>
<li>Handle <a href="https://en.wikipedia.org/wiki/Challenge%E2%80%93response_authentication" class="extiw" title="wikipedia:Challenge–response authentication">challenge-response requests</a>, in either the Yubico OTP mode or the HMAC-SHA1 mode.</li>
<li>Generate <a href="https://en.wikipedia.org/wiki/One-time_password" class="extiw" title="wikipedia:One-time password">One-time passwords</a> (OTP) - <a rel="nofollow" class="external text" href="https://developers.yubico.com/OTP/">Yubico's AES based standard</a>.</li>
<li>"Type" a static password up to 63 characters.</li>
</ul>
<p>While offering many features, newer versions of the YubiKey are <a rel="nofollow" class="external text" href="https://www.yubico.com/2016/05/secure-hardware-vs-open-source/">not released as open source</a>. An alternative is the <a href="../en/Solo.html" title="Solo">Solo</a>.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Installation"><span class="tocnumber">1</span> <span class="toctext">Installation</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Management_tools"><span class="tocnumber">1.1</span> <span class="toctext">Management tools</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Authentication_tools"><span class="tocnumber">1.2</span> <span class="toctext">Authentication tools</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#Inputs"><span class="tocnumber">2</span> <span class="toctext">Inputs</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Outputs"><span class="tocnumber">3</span> <span class="toctext">Outputs</span></a></li>
<li class="toclevel-1 tocsection-6">
<a href="#USB_connection_modes"><span class="tocnumber">4</span> <span class="toctext">USB connection modes</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Get_enabled_modes"><span class="tocnumber">4.1</span> <span class="toctext">Get enabled modes</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Set_modes"><span class="tocnumber">4.2</span> <span class="toctext">Set modes</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9">
<a href="#One-time_password"><span class="tocnumber">5</span> <span class="toctext">One-time password</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#Factory_configuration"><span class="tocnumber">5.1</span> <span class="toctext">Factory configuration</span></a></li>
<li class="toclevel-2 tocsection-11">
<a href="#Yubico_OTP"><span class="tocnumber">5.2</span> <span class="toctext">Yubico OTP</span></a>
<ul>
<li class="toclevel-3 tocsection-12"><a href="#YubiCloud_and_validation_servers"><span class="tocnumber">5.2.1</span> <span class="toctext">YubiCloud and validation servers</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#Configuration_and_usage"><span class="tocnumber">5.2.2</span> <span class="toctext">Configuration and usage</span></a></li>
<li class="toclevel-3 tocsection-14">
<a href="#Security_risks"><span class="tocnumber">5.2.3</span> <span class="toctext">Security risks</span></a>
<ul>
<li class="toclevel-4 tocsection-15"><a href="#AES_key_compromise"><span class="tocnumber">5.2.3.1</span> <span class="toctext">AES key compromise</span></a></li>
<li class="toclevel-4 tocsection-16"><a href="#Validation_requests/responses_tampering"><span class="tocnumber">5.2.3.2</span> <span class="toctext">Validation requests/responses tampering</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-17">
<a href="#Challenge-response"><span class="tocnumber">5.3</span> <span class="toctext">Challenge-response</span></a>
<ul>
<li class="toclevel-3 tocsection-18"><a href="#HMAC-SHA1_algorithm"><span class="tocnumber">5.3.1</span> <span class="toctext">HMAC-SHA1 algorithm</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="#Yubico_OTP_algorithm"><span class="tocnumber">5.3.2</span> <span class="toctext">Yubico OTP algorithm</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="#Sending_a_challenge"><span class="tocnumber">5.3.3</span> <span class="toctext">Sending a challenge</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-21"><a href="#Static_password"><span class="tocnumber">5.4</span> <span class="toctext">Static password</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#Emulated_USB_keyboard_limitations,_or_%22Why_does_my_password_look_so_weak?%22"><span class="tocnumber">5.5</span> <span class="toctext">Emulated USB keyboard limitations, or "Why does my password look so weak?"</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-23">
<a href="#OATH"><span class="tocnumber">6</span> <span class="toctext">OATH</span></a>
<ul>
<li class="toclevel-2 tocsection-24"><a href="#OATH_API"><span class="tocnumber">6.1</span> <span class="toctext">OATH API</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#OTP_slot_implementation"><span class="tocnumber">6.2</span> <span class="toctext">OTP slot implementation</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-26"><a href="#U2F"><span class="tocnumber">7</span> <span class="toctext">U2F</span></a></li>
<li class="toclevel-1 tocsection-27">
<a href="#CCID_smartcard"><span class="tocnumber">8</span> <span class="toctext">CCID smartcard</span></a>
<ul>
<li class="toclevel-2 tocsection-28"><a href="#PIV"><span class="tocnumber">8.1</span> <span class="toctext">PIV</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#OpenPGP_smartcards"><span class="tocnumber">8.2</span> <span class="toctext">OpenPGP smartcards</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-30">
<a href="#Use_cases"><span class="tocnumber">9</span> <span class="toctext">Use cases</span></a>
<ul>
<li class="toclevel-2 tocsection-31">
<a href="#Full_disk_encryption_with_LUKS"><span class="tocnumber">9.1</span> <span class="toctext">Full disk encryption with LUKS</span></a>
<ul>
<li class="toclevel-3 tocsection-32"><a href="#Common_prerequisites"><span class="tocnumber">9.1.1</span> <span class="toctext">Common prerequisites</span></a></li>
<li class="toclevel-3 tocsection-33"><a href="#Challenge-response_2"><span class="tocnumber">9.1.2</span> <span class="toctext">Challenge-response</span></a></li>
<li class="toclevel-3 tocsection-34"><a href="#systemd-based_initramfs"><span class="tocnumber">9.1.3</span> <span class="toctext">systemd-based initramfs</span></a></li>
<li class="toclevel-3 tocsection-35"><a href="#GnuPG_encrypted_keyfile"><span class="tocnumber">9.1.4</span> <span class="toctext">GnuPG encrypted keyfile</span></a></li>
<li class="toclevel-3 tocsection-36"><a href="#HMAC_secret_extension_of_FIDO2_protocol"><span class="tocnumber">9.1.5</span> <span class="toctext">HMAC secret extension of FIDO2 protocol</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-37"><a href="#KeePass"><span class="tocnumber">9.2</span> <span class="toctext">KeePass</span></a></li>
<li class="toclevel-2 tocsection-38"><a href="#SSH_keys"><span class="tocnumber">9.3</span> <span class="toctext">SSH keys</span></a></li>
<li class="toclevel-2 tocsection-39">
<a href="#Linux_user_authentication_with_PAM"><span class="tocnumber">9.4</span> <span class="toctext">Linux user authentication with PAM</span></a>
<ul>
<li class="toclevel-3 tocsection-40"><a href="#SSH_notes"><span class="tocnumber">9.4.1</span> <span class="toctext">SSH notes</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-41"><a href="#Browser/web_integration"><span class="tocnumber">9.5</span> <span class="toctext">Browser/web integration</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-42">
<a href="#Tips_and_tricks"><span class="tocnumber">10</span> <span class="toctext">Tips and tricks</span></a>
<ul>
<li class="toclevel-2 tocsection-43"><a href="#Executing_actions_on_insertion/removal_of_YubiKey_device"><span class="tocnumber">10.1</span> <span class="toctext">Executing actions on insertion/removal of YubiKey device</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-44">
<a href="#Maintenance_/_upgrades"><span class="tocnumber">11</span> <span class="toctext">Maintenance / upgrades</span></a>
<ul>
<li class="toclevel-2 tocsection-45">
<a href="#Installing_the_OATH_Applet_for_a_YubiKey_NEO"><span class="tocnumber">11.1</span> <span class="toctext">Installing the OATH Applet for a YubiKey NEO</span></a>
<ul>
<li class="toclevel-3 tocsection-46"><a href="#Configure_the_NEO_as_a_CCID_device"><span class="tocnumber">11.1.1</span> <span class="toctext">Configure the NEO as a CCID device</span></a></li>
<li class="toclevel-3 tocsection-47"><a href="#Install_the_applet"><span class="tocnumber">11.1.2</span> <span class="toctext">Install the applet</span></a></li>
<li class="toclevel-3 tocsection-48"><a href="#(Optional)_Install_the_Yubico_Authenticator_desktop_client"><span class="tocnumber">11.1.3</span> <span class="toctext">(Optional) Install the Yubico Authenticator desktop client</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-49">
<a href="#Troubleshooting"><span class="tocnumber">12</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-50"><a href="#YubiKey_not_acting_as_HID_device"><span class="tocnumber">12.1</span> <span class="toctext">YubiKey not acting as HID device</span></a></li>
<li class="toclevel-2 tocsection-51"><a href="#ykman_fails_to_connect_to_the_YubiKey"><span class="tocnumber">12.2</span> <span class="toctext">ykman fails to connect to the YubiKey</span></a></li>
<li class="toclevel-2 tocsection-52"><a href="#Error:_Failed_connecting_to_YubiKey_5_%5BOTP+FIDO+CCID%5D._Make_sure_the_application_have_the_required_permissions."><span class="tocnumber">12.3</span> <span class="toctext">Error: Failed connecting to YubiKey 5 [OTP+FIDO+CCID]. Make sure the application have the required permissions.</span></a></li>
<li class="toclevel-2 tocsection-53"><a href="#YubiKey_fails_to_bind_within_a_guest_VM"><span class="tocnumber">12.4</span> <span class="toctext">YubiKey fails to bind within a guest VM</span></a></li>
<li class="toclevel-2 tocsection-54"><a href="#Error:_%5Bkey%5D_could_not_be_locally_signed_or_gpg:_No_default_secret_key:_No_public_key"><span class="tocnumber">12.5</span> <span class="toctext">Error: [key] could not be locally signed or gpg: No default secret key: No public key</span></a></li>
<li class="toclevel-2 tocsection-55"><a href="#YubiKey_disappears_and_reappears_in_Yubico_Authenticator"><span class="tocnumber">12.6</span> <span class="toctext">YubiKey disappears and reappears in Yubico Authenticator</span></a></li>
<li class="toclevel-2 tocsection-56"><a href="#YubiKey_core_error:_timeout"><span class="tocnumber">12.7</span> <span class="toctext">YubiKey core error: timeout</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<h3><span class="mw-headline" id="Management_tools">Management tools</span></h3>
<ul><li>
<b>YubiKey Manager</b> — Python library and command-line tool (<code>ykman</code>) for configuring and querying a YubiKey over USB. Has optional GUI.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://developers.yubico.com/yubikey-manager/">https://developers.yubico.com/yubikey-manager/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=yubikey-manager">yubikey-manager</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=yubikey-manager-qt">yubikey-manager-qt</a></span>
<dl><dd><div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> After installation, enable <code>pcscd.service</code>
</div></dd></dl>
</dd></dl>
<ul><li>
<b>YubiKey Personalization</b> — Library and tool for configuring and querying a YubiKey over the OTP USB connection. More powerful than ykman, but harder to use. Has optional GUI.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://developers.yubico.com/yubikey-personalization/">https://developers.yubico.com/yubikey-personalization/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=yubikey-personalization">yubikey-personalization</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=yubikey-personalization-gui">yubikey-personalization-gui</a></span>
</dd></dl>
<h3><span class="mw-headline" id="Authentication_tools">Authentication tools</span></h3>
<ul><li>
<b>Yubico PAM</b> — <a href="../en/PAM.html" title="PAM">PAM</a> user authentication with either Yubico OTP or challenge-response.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://developers.yubico.com/yubico-pam/">https://developers.yubico.com/yubico-pam/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=yubico-pam">yubico-pam</a></span>
</dd></dl>
<ul><li>
<b>Yubico PAM-U2F</b> — <a href="../en/PAM.html" title="PAM">PAM</a> user authentication with <a href="../en/Universal_2nd_Factor.html" class="mw-redirect" title="U2F">U2F</a>.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://developers.yubico.com/pam-u2f/">https://developers.yubico.com/pam-u2f/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pam-u2f">pam-u2f</a></span>
</dd></dl>
<ul><li>
<b>Yubico Authenticator for Desktop</b> —  GUI to read OATH codes from your YubiKey over USB. Support the newer OATH implementation (YubiKey NEO and 4) as well as the older slot-based implementation (YubiKey Standard and Edge).</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://developers.yubico.com/OATH/YubiKey_OATH_software.html">https://developers.yubico.com/OATH/YubiKey_OATH_software.html</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=yubioath-desktop">yubioath-desktop</a></span>
</dd></dl>
<ul><li>
<b>libfido2</b> — Client-side U2F support. Enables web browsers to use the U2F protocol for authentication with your YubiKey.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://developers.yubico.com/libfido2/">https://developers.yubico.com/libfido2/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libfido2">libfido2</a></span>
</dd></dl>
<ul><li>
<b>YubiKey Full Disk Encryption</b> — Use challenge-response mode to create strong LUKS passphrases. Supports full disk encryption.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/agherzan/yubikey-full-disk-encryption">https://github.com/agherzan/yubikey-full-disk-encryption</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=yubikey-full-disk-encryption">yubikey-full-disk-encryption</a></span>
</dd></dl>
<h2><span class="mw-headline" id="Inputs">Inputs</span></h2>
<p>The YubiKey takes inputs in the form of API calls over USB and button presses.
</p>
<p>The button is very sensitive. Depending on the context, touching it does one of these things:
</p>
<ul>
<li>Trigger a static password or one-time password (OTP) (Short press for slot 1, long press for slot 2). This is the default behavior, and easy to trigger inadvertently.</li>
<li>Confirm / allow a function or access. The LED will illuminate to prompt the user.</li>
<li>Insert / eject the smartcard</li>
</ul>
<h2><span class="mw-headline" id="Outputs">Outputs</span></h2>
<p>The YubiKey transforms these inputs into outputs:
</p>
<ul>
<li>Keystrokes (emulating a USB keyboard), used to type static passwords and OTPs. (Note that static passwords are vulnerable to keyloggers.)</li>
<li>The built-in LED:
<ul>
<li>Blinks once when plugged in, useful for troubleshooting.</li>
<li>Blinks steadily when a button press is required to permit an API response.</li>
</ul>
</li>
<li>API responses over USB. This is used for:
<ul>
<li>Challenge-Response requests (calculated using either Yubico OTP mode or HMAC-SHA1 mode)</li>
<li>U2F Challenge-Response requests</li>
<li>CCID Smartcard related requests</li>
</ul>
</li>
</ul>
<h2><span class="mw-headline" id="USB_connection_modes">USB connection modes</span></h2>
<p>Depending on the YubiKey model, the device provides up to three different USB interfaces. Two of the interfaces implement the USB HID (Human Interface Device) device class; the third is a smart card interface (CCID). All three can be enabled or disabled independently, allowing control of their associated protocols.
</p>
<p>The following table shows which protocols use which interfaces:
</p>
<table class="wikitable">
<tbody>
<tr>
<th>Protocol</th>
<th>Interface
</th>
</tr>
<tr>
<td>OTP</td>
<td>Keyboard HID
</td>
</tr>
<tr>
<td>FIDO</td>
<td>Other HID
</td>
</tr>
<tr>
<td>PIV</td>
<td>CCID
</td>
</tr>
<tr>
<td>OpenPGP</td>
<td>CCID
</td>
</tr>
<tr>
<td>OATH</td>
<td>CCID
</td>
</tr>
</tbody>
</table>
<p><code>ykman</code> uses the term "modes", named OTP, FIDO, and CCID. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> ykman renamed "U2F" to "FIDO" in release 0.6.1 (2018-04-16). <a rel="nofollow" class="external free" href="https://developers.yubico.com/yubikey-manager/Release_Notes.html">https://developers.yubico.com/yubikey-manager/Release_Notes.html</a>
</div>
<h3><span class="mw-headline" id="Get_enabled_modes">Get enabled modes</span></h3>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ykman mode</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Current connection mode is: OTP+FIDO+CCID
</pre>
<h3><span class="mw-headline" id="Set_modes">Set modes</span></h3>
<p>All modes are enabled from the factory. To change them:
</p>
<p><code>$ ykman mode [OPTIONS] &lt;MODE&gt;</code>
</p>
<ul>
<li>
<code>&lt;MODE&gt;</code> can be a string, such as <code>OTP+FIDO+CCID</code>, or a shortened form <code>o+f+c</code>.</li>
<li>
<code>&lt;MODE&gt;</code> can be a mode-number, which encodes several enabled modes.</li>
</ul>
<p>Here is a table of mode-numbers, if you care to use them:
</p>
<table class="wikitable">
<tbody>
<tr>
<td>0</td>
<td>OTP device only.
</td>
</tr>
<tr>
<td>1</td>
<td>CCID device only.
</td>
</tr>
<tr>
<td>2</td>
<td>OTP/CCID composite device.
</td>
</tr>
<tr>
<td>3</td>
<td>U2F device only.
</td>
</tr>
<tr>
<td>4</td>
<td>OTP/U2F composite device.
</td>
</tr>
<tr>
<td>5</td>
<td>U2F/CCID composite device.
</td>
</tr>
<tr>
<td>6</td>
<td>OTP/U2F/CCID composite device.
</td>
</tr>
<tr>
<td>81</td>
<td>CCID device only, with touch-eject.
</td>
</tr>
</tbody>
</table>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  Some examples use mode number 86, which is <a rel="nofollow" class="external text" href="https://github.com/Yubico/yubikey-manager/issues/20#issuecomment-326496204">invalid</a>. The 80 will be ignored, and it will behave like 6.</div>
<p>Options:
</p>
<ul>
<li>
<code>--touch-eject</code> - The button will insert and eject the smart card. This only works if the mode is CCID only; FIDO and OTP must be disabled.</li>
<li>
<code>--autoeject-timeout &lt;SECONDS&gt;</code> - Automatically eject the smart card after some time. Same restrictions as <code>--touch-eject</code>.</li>
<li>
<code>--chalresp-timeout &lt;SECONDS&gt;</code> - Set the challenge-response timeout.</li>
</ul>
<p>For more information, see <code>$ ykman mode --help</code>
</p>
<h2><span class="mw-headline" id="One-time_password">One-time password</span></h2>
<p>This feature has a somewhat misleading name, because it also encompasses the static password and challenge-response functions. 
</p>
<p>2 slots are provided for this feature, accessible by short and long button presses respectively. Each can be configured with <b>one</b> of the following:
</p>
<ul>
<li>Yubico OTP</li>
<li>OATH-HOTP</li>
<li>OATH-TOTP</li>
<li>Challenge-response</li>
<li>Static Password</li>
</ul>
<p>Each function has several configuration options provided at the time of creation, but once set they cannot be read back. It is possible to swap slots 1 and 2, with <code>$ ykman otp swap </code>.
</p>
<h3><span class="mw-headline" id="Factory_configuration">Factory configuration</span></h3>
<p>On a new YubiKey, Yubico OTP is preconfigured on slot 1. This initial AES symmetric key is stored in the YubiKey on the Yubico Authentication server. This allows validating against YubiCloud, allowing the use of Yubico OTP in combination with the Yubico Forum website for instance or on <a rel="nofollow" class="external free" href="https://demo.yubico.com">https://demo.yubico.com</a>).
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> If you ever overwrite the factory key in slot 1, you cannot create a new key of the same
trust level. Factory generated Yubico OTP credentials begin with a <code>CC</code> prefix, while user generated credentials begin with <code>VV</code>. There is no fundamental difference in security or functionality, though some services only trust <code>CC</code> credentials. More information can be found in this <a rel="nofollow" class="external text" href="https://forum.yubico.com/viewtopic12ca.html?f%3D16&amp;t%3D1960">forum thread</a>.</div>
<h3><span class="mw-headline" id="Yubico_OTP">Yubico OTP</span></h3>
<p>The <a rel="nofollow" class="external text" href="https://developers.yubico.com/OTP/">Yubico OTP</a> is based on <a href="https://en.wikipedia.org/wiki/Symmetric_cryptography" class="extiw" title="wikipedia:Symmetric cryptography">symmetric cryptography</a>. More specifically, each YubiKey contains a 128-bit <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard" class="extiw" title="wikipedia:Advanced Encryption Standard">AES</a> key unique to that device, which is also stored on a validation server. When asked for a password, the YubiKey will create a token by concatenating different fields such as the ID of the key, a counter, and a random number, and encrypting the result.
</p>
<p>This OTP is sent to the target system, which passes it to a validation server. The validation server (also in posession of the secret key) decrypts it and verifies the information inside. The result is returned to the target system, which can then decide whether to grant access.
</p>
<h4><span class="mw-headline" id="YubiCloud_and_validation_servers">YubiCloud and validation servers</span></h4>
<p>Yubico provides a validation server with free unlimited access, called YubiCloud. YubiCloud knows the factory configuration of all YubiKeys, and is the "default" validation service used by (for example) <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=yubico-pam">yubico-pam</a></span>. Yubico also offers <a rel="nofollow" class="external text" href="https://developers.yubico.com/Software_Projects/Yubico_OTP/YubiCloud_Validation_Servers/">open-source implementations</a> of the server.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> To authenticate the Yubico validation server, you can use:
<ul>
<li>
<b>HMAC</b>: use <a rel="nofollow" class="external free" href="https://upgrade.yubico.com/getapikey/">https://upgrade.yubico.com/getapikey/</a> to get an HMAC key and ID</li>
<li>
<b>HTTPS</b>: the validation server's certificate is signed by GoDaddy, and is thus trusted by default in Arch installs (at least if you have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ca-certificates">ca-certificates</a></span> installed)</li>
</ul>
</div>
<h4><span class="mw-headline" id="Configuration_and_usage">Configuration and usage</span></h4>
<p>Generate a new key in slot 2, and upload it to YubiCloud (opens in a browser):
</p>
<pre>$ ykman otp yubiotp --generate-key --upload 2
</pre>
<p>For more information, see <code>$ ykman otp yubiotp --help</code>
</p>
<h4><span class="mw-headline" id="Security_risks">Security risks</span></h4>
<h5><span class="mw-headline" id="AES_key_compromise">AES key compromise</span></h5>
<p>As you can imagine, the AES key should be kept secret. It cannot be retrieved from the YubiKey itself (or it should not, at least not with software). It is also present in the validation server, so the security of this server is very important.
</p>
<h5>
<span id="Validation_requests.2Fresponses_tampering"></span><span class="mw-headline" id="Validation_requests/responses_tampering">Validation requests/responses tampering</span>
</h5>
<p>Since the target system relies on a validation server, a possible attack would be to impersonate it. To prevent this, the target system needs to authenticate the validation server, either using HMAC or HTTPS.
</p>
<h3><span class="mw-headline" id="Challenge-response">Challenge-response</span></h3>
<p>A challenge is sent to the YubiKey, which calculates a response based on some secret. The same challenge always results in the same response. Without the secret this calculation is not feasible, even with many challenge-response pairs.
</p>
<p>This can be used for
</p>
<ul>
<li>True 2-factor authentication: The user is provided a challenge, they must provide the correct response in addition to a password. Both parties must have the secret key.</li>
<li>"Semi" 2-factor authentication: the challenge acts as a password, and the server stores the correct response. This is not an OTP, and if anyone can obtain the response they will gain access, but it is simpler as the server does not need the secret key.</li>
</ul>
<p>There are two Challenge-Response algorithms:
</p>
<ul>
<li>HMAC-SHA1</li>
<li>Yubico OTP</li>
</ul>
<p>You can set them up with a GUI using the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=yubikey-personalization-gui">yubikey-personalization-gui</a></span>, or with the following instructions:
</p>
<h4><span class="mw-headline" id="HMAC-SHA1_algorithm">HMAC-SHA1 algorithm</span></h4>
<p>Set up slot 2 in challenge response mode with a generated key:
</p>
<pre> $ ykman otp chalresp --generate 2
</pre>
<p>You can omit the <code>--generate</code> flag in order to provide a key. For more information, see <code>$ ykman otp chalresp --help</code>
</p>
<h4><span class="mw-headline" id="Yubico_OTP_algorithm">Yubico OTP algorithm</span></h4>
<p><code>ykman</code> Does not appear to support setting the chal-yubico algorithm, but you can use <code>ykpersonalize</code>. Generate a random key in slot 2:
</p>
<pre> $ ykpersonalize -2 -ochal-resp -ochal-yubico
</pre>
<p>For more information, see <span class="plainlinks archwiki-template-man" title="$ man 1 ykpersonalize"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ykpersonalize.1">ykpersonalize(1)</a></span>.
</p>
<h4><span class="mw-headline" id="Sending_a_challenge">Sending a challenge</span></h4>
<p>To send a challenge and get a response:
</p>
<pre>ykchalresp -&lt;SLOT NUMBER&gt; &lt;CHALLENGE&gt;</pre>
<h3><span class="mw-headline" id="Static_password">Static password</span></h3>
<p>You can either generate a static password:
</p>
<pre> ykman otp static --generate &lt;SLOT NUMBER&gt;
</pre>
<p>or provide one:
</p>
<pre> ykman otp static &lt;SLOT NUMBER&gt; &lt;PASSWORD&gt;
</pre>
<p>You have several options; you can set the length and character set of the generated password, and whether or not to send an Enter keystroke. See <code>ykman otp static --help</code> for more.
</p>
<h3>
<span id="Emulated_USB_keyboard_limitations.2C_or_.22Why_does_my_password_look_so_weak.3F.22"></span><span class="mw-headline" id='Emulated_USB_keyboard_limitations,_or_"Why_does_my_password_look_so_weak?"'>Emulated USB keyboard limitations, or "Why does my password look so weak?"</span>
</h3>
<p>In order for the YubiKey to work with most keyboard layouts, passwords are by default limited to the ModHex alphabet (<code>cbdefghijklnrtuv</code>), digits <code>0-9</code>, and <code>!</code>. These characters use the same scan codes across a very large number of keyboard layouts, ensuring compatibility with most computers.
</p>
<p>Yubico has provided a <a rel="nofollow" class="external text" href="https://www.yubico.com/wp-content/uploads/2015/11/Yubico_WhitePaper_Static_Password_Function.pdf">whitepaper</a> on the subject.
</p>
<h2><span class="mw-headline" id="OATH">OATH</span></h2>
<p>The YubiKey offers 2 <a href="../en/Initiative_for_Open_Authentication.html" class="mw-redirect" title="OATH">OATH</a> implementations:
</p>
<dl>
<dt>OATH API</dt>
<dd>Newer method, can store approximately 30 credentials depending on the model. (YubiKey 4, NEO, and newer)</dd>
<dt>OTP slot</dt>
<dd>Older method, both OTP slots can store a single credential. (All models which support challenge-response)</dd>
</dl>
<h3><span class="mw-headline" id="OATH_API">OATH API</span></h3>
<p>If you prefer a GUI, you can use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=yubioath-desktop">yubioath-desktop</a></span>.
</p>
<p><code>ykman</code> can add codes in the URI format with <code>ykman oath uri</code>. Here is a one-liner that will add a credential from an image of a QR code:
</p>
<pre> $ zbarimg qr_code.png --quiet --raw | xargs ykman oath uri
</pre>
<p>You can also do things manually. Program a TOTP key, requiring a button touch to generate a code:
</p>
<pre> $ ykman oath add --touch (name) (secret)
</pre>
<p>Program an HOTP key:
</p>
<pre> $ ykman oath add --oath-type HOTP (name) (secret)
</pre>
<p>List credentials:
</p>
<pre> $ ykman oath list
</pre>
<p>Generate codes:
</p>
<pre> $ ykman oath code (query)
</pre>
<p>To see all available subcommands see <code>ykman oath --help</code>. To see information about each, use <code>ykman oath (subcommand) --help</code>.
</p>
<h3><span class="mw-headline" id="OTP_slot_implementation">OTP slot implementation</span></h3>
<p>Program an HOTP in slot 2:
</p>
<pre> $ ykman otp hotp 2 (key)
</pre>
<p>Program a TOTP:
</p>
<pre> $ ykman otp chalresp --totp (slot number) (key)
</pre>
<p>Generate an HOTP:
</p>
<pre> $ ykman otp calculate (slot number)
</pre>
<p>Generate a TOTP:
</p>
<pre> $ ykman otp calculate --totp (slot number)
</pre>
<p>See also: <code>ykman otp --help</code>, and <a rel="nofollow" class="external free" href="https://developers.yubico.com/OATH/">https://developers.yubico.com/OATH/</a>
</p>
<h2><span class="mw-headline" id="U2F">U2F</span></h2>
<p><a href="../en/Universal_2nd_Factor.html" title="Universal 2nd Factor">Universal 2nd Factor</a> (U2F) with a YubiKey is very simple, requiring no configuration for the key itself. Note that this mode is also referred to as 'FIDO' in some documentation and utilities. You have a few limited management options through the <code>ykman</code> utility: 
</p>
<ul>
<li>Set a PIN:  <code>$ ykman fido set-pin</code>
</li>
<li>delete individual credentials: <code>$ ykman fido delete &lt;QUERY&gt;</code>
</li>
<li>Reset all credentials and PIN: <code>$ ykman fido reset</code>
</li>
</ul>
<p>To use U2F for authentication, see the instructions in <a href="../en/Universal_2nd_Factor.html" class="mw-redirect" title="U2F">U2F</a>.
</p>
<h2><span class="mw-headline" id="CCID_smartcard">CCID smartcard</span></h2>
<p>CCID (Chip Card Interface Device) is a USB standard device class for use by USB devices that act as smart card readers or with security tokens that connect directly via USB, like the YubiKey. HID (Human Interface Device) and CCID are both USB device classes, i.e. they are in the same category of USB specifications. HID is a specification for computer peripherals, like keyboards. The YubiKey works like a USB (HID) keyboard when used in the OTP and FIDO modes, but switches to the CCID protocol when using the PIV application, or as an OpenPGP device.
</p>
<p>CCID mode should be enabled by default on all YubiKeys shipped since November 2015 <a rel="nofollow" class="external autonumber" href="https://www.yubico.com/support/knowledge-base/categories/articles/use-yubikey-yubikey-windows-hello-app/">[1]</a>. Enable at least the CCID mode. Please see <a href="#Get_enabled_modes">#Get enabled modes</a>.
</p>
<h3><span class="mw-headline" id="PIV">PIV</span></h3>
<p>Starting with the YubiKey NEO, the YubiKeys contain a PIV (Personal Identity Verification) application on the chip. PIV is a US government standard (FIPS 201) that specifies how a token using RSA or ECC (Elliptic Curve Cryptography) is used for personal electronic identification. The YubiKey NEO only supports RSA encryption, later models (YubiKey 4 and 5) support both RSA and ECC. The distinguishing characteristic of a PIV token is that it is built to protect private keys and operate on-chip. A private key never leaves the token after it has been installed on it. Optionally, the private key can even be generated on-chip with the aid of an on-chip random number generator. If generated on-chip, the private key is never handled outside of the chip, and there is no way to recover it from the token. When using the PIV mechanism, the YubiKey functions as a CCID device.
</p>
<h3><span class="mw-headline" id="OpenPGP_smartcards">OpenPGP smartcards</span></h3>
<p>The YubiKey can act as a standard GPG smartcard; see the <a href="../en/GnuPG.html#Smartcards" title="GnuPG">GPG Smartcard</a> section for instructions on how to set up and use it. Yubico also provides some documentation <a rel="nofollow" class="external text" href="https://developers.yubico.com/PGP/">here</a>.
</p>
<p>If you do not want to use the other features (U2F and OTP), the button can be configured to insert and eject it, and an auto-eject timeout can be set as well. See <a href="#USB_connection_modes">#USB connection modes</a> for more.
</p>
<p>The default user pin is <code>123456</code> and the default admin pin is <code>12345678</code>. The default PUK is also <code>12345678</code>. Remember to change all 3.
</p>
<h2><span class="mw-headline" id="Use_cases">Use cases</span></h2>
<p>This section details how to use your YubiKey for various authentication purposes. It is by no means an exhaustive list.
</p>
<h3><span class="mw-headline" id="Full_disk_encryption_with_LUKS">Full disk encryption with LUKS</span></h3>
<p>You have several options:
</p>
<ul>
<li>
<b>Challenge-Response:</b> the <a href="#Challenge-response">response</a> to some challenge is used as a LUKS key. The challenge can act as a password for true 2-factor authentication, or stored in plain-text for one-factor authentication.</li>
<li>
<b>GnuPG:</b> Uses the yubikey's <a href="#CCID_smartcard">PGP smartcard</a> functionality. Offers strong 2-factor authentication without needing a huge passphrase.</li>
<li>
<b>FIDO HMAC Secret:</b> If your YubiKey supports <a href="../en/Universal_2nd_Factor.html" class="mw-redirect" title="U2F">U2F</a>, it can be configured to return a symmetric secret when given some passphrase.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> A disk's encryption is only as strong as its weakest key. Once you configure one of these tools, consider removing the initial passphrase, or replacing it with a very long one.</div>
<h4><span class="mw-headline" id="Common_prerequisites">Common prerequisites</span></h4>
<ul>
<li>A bootable <a href="../en/Dm-crypt/Encrypting_an_entire_system.html" title="Dm-crypt/Encrypting an entire system">LUKS encrypted</a> system, using the <code>encrypt</code> <a href="../en/Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a> hook, with at least one free keyslot.
<ul><li>With the exception of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mkinitcpio-ykfde/">mkinitcpio-ykfde</a></span><sup><small>AUR</small></sup>, the <code>sd-encrypt</code> hook is not supported by any of these tools.</li></ul>
</li>
<li>Backed up LUKS header (Optional, though advisable)</li>
</ul>
<h4><span class="mw-headline" id="Challenge-response_2">Challenge-response</span></h4>
<p>See <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=yubikey-full-disk-encryption">yubikey-full-disk-encryption</a></span>'s <a rel="nofollow" class="external text" href="https://github.com/agherzan/yubikey-full-disk-encryption#usage">official documentation</a> for complete instructions. Broadly:
</p>
<ol>
<li>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=yubikey-full-disk-encryption">yubikey-full-disk-encryption</a></span>
</li>
<li>Configure <code>/etc/ykfde.conf</code>
</li>
<li>Enroll the disk: <code># ykfde-enroll -d /dev/&lt;DISK&gt; -s &lt;LUKS_SLOT&gt;</code>
</li>
<li>Add the <code>ykfde</code> <a href="../en/Mkinitcpio.html#HOOKS" title="Mkinitcpio">mkinitcpio hook</a> before the <code>encrypt</code> hook.</li>
<li>Regenerate the initramfs: <code> # mkinitcpio -P</code>
</li>
</ol>
<dl><dd><div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Plymouth Users: Replace the <code>plymouth-encrypt</code> hook with the <code>ykfde</code> hook.</div></dd></dl>
<p>There are a few variations available:
</p>
<ul>
<li>2FA: default behavior. You must provide the challenge as a password when enrolling the device, and upon boot.</li>
<li>1FA: Set <code>YKFDE_CHALLENGE</code> in <code>ykfde.conf</code>. Note that this is stored in plaintext. Consider disabling non-root read permissions to this file.</li>
<li>
<a rel="nofollow" class="external text" href="https://github.com/agherzan/yubikey-full-disk-encryption#enable-nfc-support-in-ykfde-initramfs-hook-experimental">NFC support</a> (Experimental)</li>
<li>
<a rel="nofollow" class="external text" href="https://github.com/agherzan/yubikey-full-disk-encryption#enable-ykfde-suspend-service-experimental">Suspend &amp; Resume support</a> (Experimental) Automatically lock encrypted volumes on suspend, unlock them on resume.</li>
</ul>
<p>You must regenerate the initramfs for any configuration changes to take effect.
</p>
<h4><span class="mw-headline" id="systemd-based_initramfs">systemd-based initramfs</span></h4>
<p>Users of the <code>sd-encrypt</code> hook may install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mkinitcpio-ykfde/">mkinitcpio-ykfde</a></span><sup><small>AUR</small></sup> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mkinitcpio-ykfde-git/">mkinitcpio-ykfde-git</a></span><sup><small>AUR</small></sup> and follow the instruction in the <a rel="nofollow" class="external text" href="https://github.com/eworm-de/mkinitcpio-ykfde/blob/master/README-mkinitcpio.md">project documentation</a>.  The procedure is broadly similar to <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=yubikey-full-disk-encryption">yubikey-full-disk-encryption</a></span>.
</p>
<h4><span class="mw-headline" id="GnuPG_encrypted_keyfile">GnuPG encrypted keyfile</span></h4>
<p>One tool to accomplish this is <a rel="nofollow" class="external text" href="https://github.com/fuhry/initramfs-scencrypt">initramfs-scencrypt</a>; see its docs for complete instructions. Note that as of October 2020 this package is not in the AUR and is not thoroughly tested, though the GitHub repo offers a PKGBUILD.
</p>
<p>The <a href="../en/Dm-crypt/Specialties.html#Using_GPG,_LUKS,_or_OpenSSL_Encrypted_Keyfiles" title="Dm-crypt/Specialties">dm-crypt pages</a> offer a few alternatives, though they are mostly links to old forum posts.
</p>
<h4><span class="mw-headline" id="HMAC_secret_extension_of_FIDO2_protocol">HMAC secret extension of FIDO2 protocol</span></h4>
<p>Yet another way of using YubiKey for full disk encryption is to utilize <a rel="nofollow" class="external text" href="https://fidoalliance.org/specs/fido-v2.0-id-20180227/fido-client-to-authenticator-protocol-v2.0-id-20180227.html#sctn-hmac-secret-extension">HMAC Secret Extension</a> to retrieve the LUKS password from YubiKey which is protected by passphrase supplied by user. This functionality requires at least <a rel="nofollow" class="external text" href="https://support.yubico.com/support/solutions/articles/15000027138-yubikey-5-2-3-enhancements-to-fido-2-support">YubiKey 5 with firmware 5.2.3+</a>.
</p>
<p>In order to use this install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/khefin/">khefin</a></span><sup><small>AUR</small></sup> and follow instructions available in <a rel="nofollow" class="external text" href="https://github.com/mjec/khefin/wiki/Arch-Linux-LUKS-configuration">project documentation</a>.
</p>
<h3><span class="mw-headline" id="KeePass">KeePass</span></h3>
<p><a href="../en/KeePass.html" title="KeePass">KeePass</a> can be configured for YubiKey support; see the <a href="../en/KeePass.html#Yubikey" title="KeePass">YubiKey section</a> for instructions.
</p>
<h3><span class="mw-headline" id="SSH_keys">SSH keys</span></h3>
<p>If your yubikey supports CCID smartcards, you can use it as a hardware-backed <a href="../en/SSH_keys.html" class="mw-redirect" title="SSH key">SSH key</a>, either based on GPG or PIV keys. Yubico offers good documentation:
</p>
<ul>
<li>An <a rel="nofollow" class="external text" href="https://developers.yubico.com/PIV/Guides/Securing_SSH_with_OpenPGP_or_PIV.html">overview of both</a> possibilities, giving their advantages and disadvantages</li>
<li>Instructions for <a rel="nofollow" class="external text" href="https://developers.yubico.com/PGP/SSH_authentication/index.html">PGP authentication</a>
</li>
<li>Instructions for <a rel="nofollow" class="external text" href="https://developers.yubico.com/PIV/Guides/SSH_user_certificates.html">PIV authentication through user certificates</a>
</li>
<li>Instructions for <a rel="nofollow" class="external text" href="https://developers.yubico.com/PIV/Guides/SSH_with_PIV_and_PKCS11.html">PIV authentication through #PKCS11</a>
</li>
</ul>
<dl><dd><div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The default PIN code of the PIV application on the YubiKey is  <code>123456</code>; you may want to change it, as well as the default management key. See the <a rel="nofollow" class="external text" href="https://developers.yubico.com/PIV/Guides/Device_setup.html">device setup instructions</a> for more.</div></dd></dl>
<h3><span class="mw-headline" id="Linux_user_authentication_with_PAM">Linux user authentication with PAM</span></h3>
<p><a href="../en/PAM.html" title="PAM">PAM</a>, and therefore anything which uses PAM for user authentication, can be configured to use a YubiKey as a factor of its user authentication process. This includes sudo, su, ssh, screen lockers, display managers, and nearly every other instance where a Linux system needs to authenticate a user. Its flexible configuration allows you to set whichever authentication requirements fit your needs, for the entire system, a specific application, or for groups of applications. For example, you could accept the YubiKey as an alternative to a password for local sessions, while requiring both for remote sessions. In addition to the Arch Wiki, You are encouraged to read <span class="plainlinks archwiki-template-man" title="$ man 8 pam"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pam.8">pam(8)</a></span> and <span class="plainlinks archwiki-template-man" title="$ man 5 pam.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pam.conf.5">pam.conf(5)</a></span> to understand how it works and how to configure it.
</p>
<p>There are several modules available which integrate YubiKey-supported protocols into PAM:
</p>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pam-u2f">pam-u2f</a></span> - Supports <a href="#U2F">#U2F</a> via the FIDO2 standard. If you are not sure which method to use, this one is a good choice.
<ul>
<li><a href="../en/Universal_2nd_Factor.html#Authentication_for_Arch_Linux" title="Universal 2nd Factor">Arch Wiki Instructions</a></li>
<li>
<a rel="nofollow" class="external text" href="https://developers.yubico.com/pam-u2f/">Yubico's official docs</a>, including a list of supported module parameters.</li>
<li>Man Pages: <span class="plainlinks archwiki-template-man" title="$ man 8 pam_u2f"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pam_u2f.8">pam_u2f(8)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 1 pamu2fcfg"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pamu2fcfg.1">pamu2fcfg(1)</a></span>
</li>
</ul>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=oath-toolkit">oath-toolkit</a></span> - Supports <a href="#OATH">#OATH</a> one-time passwords (either HOTP or TOTP)
<ul><li><a href="../en/Pam_oath.html" title="Pam oath">pam_oath</a></li></ul>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=yubico-pam">yubico-pam</a></span> - Supports <a href="#Yubico_OTP">#Yubico OTP</a> and challenge-response OTPs. Note that Yubico OTP mode requires a network connection to a validation server, while challenge-response mode does not.
<ul>
<li><a rel="nofollow" class="external text" href="https://developers.yubico.com/yubico-pam/">Yubico's official docs</a></li>
<li>
<span class="plainlinks archwiki-template-man" title="$ man 8 pam_yubico"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pam_yubico.8">pam_yubico(8)</a></span> - Take note of the <code>mode</code> parameter, used to set challenge-response mode.</li>
</ul>
</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Exercise caution when modifying PAM configuration files. Mistakes can render a system completely insecure, or so secure that no authentication is possible.</div>
<p>PAM configuration is beyond the scope of this article, but for a brief overview:
</p>
<ul>
<li>Create file(s) containing authorized keys, either in users' home directories or centrally.</li>
<li>Add a line in the appropriate place in the appropriate PAM configuration file which follows this format:</li>
</ul>
<pre>   auth [required|sufficient] [module_name].so [module arguments]
</pre>
<ul>
<li>
<code>auth required</code> for multifactor, <code>auth sufficient</code> for single factor.</li>
<li>
<code>module_name</code> - Example: <code>pam_u2f.so</code>. See a list of installed modules: <code> $ ls /usr/lib/security </code>
</li>
<li>Module configuration arguments are for things like the location of the keyfile, or which method the module should use for authentication.</li>
</ul>
<h4><span class="mw-headline" id="SSH_notes">SSH notes</span></h4>
<ul>
<li>Yubico has provided <a rel="nofollow" class="external text" href="https://developers.yubico.com/yubico-pam/Yubikey_and_SSH_via_PAM.html">additional guidance</a>. It's written for an old version of Ubuntu, but much of it still applies to an updated Arch system.</li>
<li>If you are configuring a distant server to use YubiKey, you should open at least one additional, rescue SSH session, so that you are not locked out if the configuration fails.</li>
<li>Check that <code>/etc/ssh/sshd_config</code> contains the following settings. The <code>sshd_config</code> shipped with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span> has these set correctly by default.</li>
</ul>
<pre>   ChallengeResponseAuthentication no
   UsePAM yes
</pre>
<h3>
<span id="Browser.2Fweb_integration"></span><span class="mw-headline" id="Browser/web_integration">Browser/web integration</span>
</h3>
<p>Many web services are beginning to support FIDO hardware tokens. See the <a href="../en/Universal_2nd_Factor.html" class="mw-redirect" title="U2F">U2F</a> page for more information, but usually the only thing you need to do is to install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libfido2">libfido2</a></span> and <a rel="nofollow" class="external text" href="https://demo.yubico.com/webauthn-technical/registration">try it</a>.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3>
<span id="Executing_actions_on_insertion.2Fremoval_of_YubiKey_device"></span><span class="mw-headline" id="Executing_actions_on_insertion/removal_of_YubiKey_device">Executing actions on insertion/removal of YubiKey device</span>
</h3>
<p>For example, you want to perform an action when you pull your YubiKey out of the USB slot, create <code>/etc/udev/rules.d/80-yubikey-actions.rules</code> and add the following contents:
</p>
<pre>ACTION=="remove", ENV{ID_VENDOR}=="Yubico", ENV{ID_VENDOR_ID}=="1050", ENV{ID_MODEL_ID}=="0010|0111|0112|0113|0114|0115|0116|0401|0402|0403|0404|0405|0406|0407|0410", RUN+="/usr/local/bin/script args"
</pre>
<p>Please note, most keys are covered within this example but it may not work for all versions of YubiKey. You will have to look at the output of lsusb to get the vendor and model ID's, along with the description of the device or you could use udevadm to get information. Of course, to execute a script on insertion, you would change the action to 'add' instead of remove.
</p>
<h2>
<span id="Maintenance_.2F_upgrades"></span><span class="mw-headline" id="Maintenance_/_upgrades">Maintenance / upgrades</span>
</h2>
<h3><span class="mw-headline" id="Installing_the_OATH_Applet_for_a_YubiKey_NEO">Installing the OATH Applet for a YubiKey NEO</span></h3>
<p>These steps will allow you to install the OATH applet onto your YubiKey NEO. This allows the use of Yubico Authenticator in the Google Play Store.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> These steps are only for NEOs with a firmware version &lt;= 3.1.2. The current generation NEOs (with U2F) come with the OpenPGP applet already installed)</div>
<h4><span class="mw-headline" id="Configure_the_NEO_as_a_CCID_device">Configure the NEO as a CCID device</span></h4>
<ol>
<li>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=yubikey-personalization-gui">yubikey-personalization-gui</a></span> (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/yubikey-personalization-gui-git/">yubikey-personalization-gui-git</a></span><sup><small>AUR</small></sup>).</li>
<li>Add the udev rules and reboot so you can manage the YubiKey without needing to be root</li>
<li>Run <code>ykpersonalize -m82</code>, enter <code>y</code>, and hit enter.</li>
</ol>
<h4><span class="mw-headline" id="Install_the_applet">Install the applet</span></h4>
<ol>
<li>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/gpshell/">gpshell</a></span><sup><small>AUR</small></sup>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/gppcscconnectionplugin/">gppcscconnectionplugin</a></span><sup><small>AUR</small></sup>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/globalplatform/">globalplatform</a></span><sup><small>AUR</small></sup>, and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pcsclite">pcsclite</a></span>.</li>
<li>
<a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">Start</a> <code>pcscd.service</code>.</li>
<li>Download the most recent CAP file from the <a rel="nofollow" class="external text" href="http://opensource.yubico.com/ykneo-oath/releases.html">ykneo-oath</a> site.</li>
<li>Download <code>gpinstall.txt</code> from <a rel="nofollow" class="external text" href="https://github.com/Yubico/ykneo-oath/blob/master/gpinstall.txt">GitHub</a>.</li>
<li>Edit the line in gpinstall.txt beginning with <code>install -file</code> to reflect the path where the CAP file is located.</li>
<li>Open a terminal and run <code> gpshell &lt;location of gpinstall.txt&gt;</code>
</li>
<li>Ideally, a bunch of text will scroll by and it ends saying something like</li>
</ol>
<pre> Command --&gt; 80E88013D7C000C400BE00C700CA00CA00B400BE00CE00D200D500D700B000DB00C700DF00BEFFFF00BE00E400AC00AE00AE00DB00E700A
A00EA00ED00ED00ED00BE00EF00F100F400F100F700FA00FF00BE00F700AA01010103010700CA00C400B400AA00F700B400AA00B600C7010C
010C00AA0140012001B0056810B0013005600000056810E0011006B4B44304B44404B44106B44B4405B443400343B002410636810E06B4B44
407326810B004B43103441003334002B102B404B3B403BB4003B440076820A4100221024405B4341008B44600000231066820A100
Wrapped command --&gt; 84E88013DFC000C400BE00C700CA00CA00B400BE00CE00D200D500D700B000DB00C700DF00BEFFFF00BE00E400AC00AE00AE00DB00E700A
A00EA00ED00ED00ED00BE00EF00F100F400F100F700FA00FF00BE00F700AA01010103010700CA00C400B400AA00F700B400AA00B600C7010C
010C00AA0140012001B0056810B0013005600000056810E0011006B4B44304B44404B44106B44B4405B443400343B002410636810E06B4B44
407326810B004B43103441003334002B102B404B3B403BB4003B440076820A4100221024405B4341008B44600000231066820A15D848CB77
27D0EDA00
Response &lt;-- 009000
Command --&gt; 80E60C002107A000000527210108A00000052721010108A000000527210101010003C901000000
Wrapped command --&gt; 84E60C002907A000000527210108A00000052721010108A000000527210101010003C9010000B4648127914A4C7C00
Response &lt;-- 009000
card_disconnect
release_context</pre>
<ol><li>Unplug the NEO and try it with the Yubico Authenticator app</li></ol>
<h4>
<span id=".28Optional.29_Install_the_Yubico_Authenticator_desktop_client"></span><span class="mw-headline" id="(Optional)_Install_the_Yubico_Authenticator_desktop_client">(Optional) Install the Yubico Authenticator desktop client</span>
</h4>
<p>You can get the desktop version of the Yubico Authenticator by installing <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=yubioath-desktop">yubioath-desktop</a></span>.
</p>
<p>While <code>pcscd.service</code> is running, run <code>yubioath-desktop</code> and insert your YubiKey when prompted.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<p>Restart, especially if you have completed updates since your YubiKey last worked. Do this even if some functions appear to be functioning.
</p>
<h3><span class="mw-headline" id="YubiKey_not_acting_as_HID_device">YubiKey not acting as HID device</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> These steps are no longer necessary after <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/commit/d45ee2f31a8358db0accde2e7c81777cedadc3c2">systemd since v244</a> added native support for this functionality.</div>
<p>Add udev rule as described in <a rel="nofollow" class="external text" href="https://michaelheap.com/yubikey-on-arch/">this article</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/10-security-key.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">KERNEL=="hidraw*", SUBSYSTEM=="hidraw", MODE="0664", GROUP="users", ATTRS{idVendor}=="2581", ATTRS{idProduct}=="f1d0"</pre>
<p>Run <code>udevadm trigger</code> afterwards.
</p>
<p>You may also need to <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> the package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libu2f-host">libu2f-host</a></span> if you want support in chrome.
</p>
<h3><span class="mw-headline" id="ykman_fails_to_connect_to_the_YubiKey">ykman fails to connect to the YubiKey</span></h3>
<p>If the manager fails to connect to the YubiKey, make sure you have started <code>pcscd.service</code> or <code>pcscd.socket</code>.
</p>
<h3>
<span id="Error:_Failed_connecting_to_YubiKey_5_.5BOTP.2BFIDO.2BCCID.5D._Make_sure_the_application_have_the_required_permissions."></span><span class="mw-headline" id="Error:_Failed_connecting_to_YubiKey_5_[OTP+FIDO+CCID]._Make_sure_the_application_have_the_required_permissions.">Error: Failed connecting to YubiKey 5 [OTP+FIDO+CCID]. Make sure the application have the required permissions.</span>
</h3>
<p>This can occur when using <code>ykman</code> to access the oath credentials on the device if <code>scdaemon</code> has already taken exclusive control of the device. <a rel="nofollow" class="external autonumber" href="https://github.com/Yubico/yubikey-manager/issues/35">[2]</a>
</p>
<p>To fix this you can set the <code>reader-port</code> option with the correct value for your device in <code>~/.gnupg/scdaemon.conf</code>. <a rel="nofollow" class="external autonumber" href="https://support.yubico.com/support/solutions/articles/15000014892-troubleshooting-gpg-no-such-device-">[3]</a>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This will cause the gpgagent to re-prompt you to unlock the YubiKey after each time you access the YubiKey through ykman.</div>
<p>For YubiKey NEO and YubiKey 4:
</p>
<pre>reader-port Yubico Yubikey
</pre>
<p>or for YubiKey 5
</p>
<pre>reader-port Yubico Yubi
</pre>
<h3><span class="mw-headline" id="YubiKey_fails_to_bind_within_a_guest_VM">YubiKey fails to bind within a guest VM</span></h3>
<p>Assuming the YubiKey is available to the guest, the issue results from a driver binding to the device on the host. To unbind the device, the bus and port information is needed from <code>dmesg</code> on the host:
</p>
<pre>$ dmesg | grep -B1 Yubico | tail -n 2 | head -n 1 | sed -E 's/^\[[^]]+\] usb ([^:]*):.*/\1/'
</pre>
<p>The resulting USB id should be of the form <code>X-Y.Z</code> or <code>X-Y</code>. Then, on the host, use <code>find</code> to search <code>/sys/bus/usb/drivers</code> for which driver the YubiKey is binded to (e.g. <code>usbhid</code> or <code>usbfs</code>).
</p>
<pre>$ find /sys/bus/usb/drivers -name "*X-Y.Z*"
</pre>
<p>To unbind the device, use the result from the previous command (i.e. <code>/sys/bus/usb/drivers/&lt;DRIVER&gt;/X-Y.Z:1.0</code>):
</p>
<pre># echo 'X-Y.Z:1.0' &gt; /sys/bus/usb/drivers/&lt;DRIVER&gt;/unbind
</pre>
<h3>
<span id="Error:_.5Bkey.5D_could_not_be_locally_signed_or_gpg:_No_default_secret_key:_No_public_key"></span><span class="mw-headline" id="Error:_[key]_could_not_be_locally_signed_or_gpg:_No_default_secret_key:_No_public_key">Error: [key] could not be locally signed or gpg: No default secret key: No public key</span>
</h3>
<p>Occurs when attempting to sign keys on a non-standard keyring while a YubiKey is plugged in, e.g. as <a href="../en/Pacman/Package_signing.html" title="Pacman/Package signing">Pacman</a> does in <code>pacman-key --populate archlinux</code>. The solution is to remove the offending YubiKey and start over.
</p>
<h3><span class="mw-headline" id="YubiKey_disappears_and_reappears_in_Yubico_Authenticator">YubiKey disappears and reappears in Yubico Authenticator</span></h3>
<p>This happens when the CCID driver is not installed. You may need to <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ccid">ccid</a></span> package.
</p>
<h3><span class="mw-headline" id="YubiKey_core_error:_timeout">YubiKey core error: timeout</span></h3>
<p>You are probably using the wrong slot. Try the other one.
</p>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Universal_2nd_Factor.html" title="Category:Universal 2nd Factor">Universal 2nd Factor</a></li></ul>
</div></div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=YubiKey&amp;oldid=646546">https://wiki.archlinux.org/index.php?title=YubiKey&amp;oldid=646546</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 25 December 2020, at 07:33.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
