<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>distcc - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Distcc rootpage-Distcc skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">distcc</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><span></span>
</p>
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../en/TORQUE.html" title="TORQUE">TORQUE</a></li>
<li><a href="../en/Slurm.html" title="Slurm">Slurm</a></li>
</ul>
</div>
<p><a href="https://en.wikipedia.org/wiki/distcc" class="extiw" title="wikipedia:distcc">distcc</a> is a program to distribute builds of C, C++, Objective C or Objective C++ code across several machines on a network to speed up building. It should always generate the same results as a local build, is simple to install and use, and is usually much faster than a local compile. Further, one can use it together with native Arch build tools such as makepkg.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Terms"><span class="tocnumber">1</span> <span class="toctext">Terms</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Getting_started"><span class="tocnumber">2</span> <span class="toctext">Getting started</span></a></li>
<li class="toclevel-1 tocsection-3">
<a href="#Configuration"><span class="tocnumber">3</span> <span class="toctext">Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Modes_of_operation"><span class="tocnumber">3.1</span> <span class="toctext">Modes of operation</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Volunteers"><span class="tocnumber">3.2</span> <span class="toctext">Volunteers</span></a></li>
<li class="toclevel-2 tocsection-6">
<a href="#Client"><span class="tocnumber">3.3</span> <span class="toctext">Client</span></a>
<ul>
<li class="toclevel-3 tocsection-7">
<a href="#For_use_with_makepkg"><span class="tocnumber">3.3.1</span> <span class="toctext">For use with makepkg</span></a>
<ul>
<li class="toclevel-4 tocsection-8"><a href="#Plain_mode_example"><span class="tocnumber">3.3.1.1</span> <span class="toctext">Plain mode example</span></a></li>
<li class="toclevel-4 tocsection-9"><a href="#Pump_mode_example"><span class="tocnumber">3.3.1.2</span> <span class="toctext">Pump mode example</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-10">
<a href="#For_use_without_makepkg"><span class="tocnumber">3.3.2</span> <span class="toctext">For use without makepkg</span></a>
<ul>
<li class="toclevel-4 tocsection-11"><a href="#Plain_mode_example_2"><span class="tocnumber">3.3.2.1</span> <span class="toctext">Plain mode example</span></a></li>
<li class="toclevel-4 tocsection-12"><a href="#Pump_mode_example_2"><span class="tocnumber">3.3.2.2</span> <span class="toctext">Pump mode example</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-13">
<a href="#Compile"><span class="tocnumber">4</span> <span class="toctext">Compile</span></a>
<ul>
<li class="toclevel-2 tocsection-14">
<a href="#With_makepkg"><span class="tocnumber">4.1</span> <span class="toctext">With makepkg</span></a>
<ul>
<li class="toclevel-3 tocsection-15"><a href="#Plain_mode_example_3"><span class="tocnumber">4.1.1</span> <span class="toctext">Plain mode example</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="#Pump_mode_example_3"><span class="tocnumber">4.1.2</span> <span class="toctext">Pump mode example</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-17">
<a href="#Without_makepkg"><span class="tocnumber">4.2</span> <span class="toctext">Without makepkg</span></a>
<ul>
<li class="toclevel-3 tocsection-18"><a href="#Plain_mode_example_4"><span class="tocnumber">4.2.1</span> <span class="toctext">Plain mode example</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="#Pump_mode_example_4"><span class="tocnumber">4.2.2</span> <span class="toctext">Pump mode example</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-20"><a href="#With_CMake"><span class="tocnumber">4.3</span> <span class="toctext">With CMake</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-21"><a href="#Monitoring_progress"><span class="tocnumber">5</span> <span class="toctext">Monitoring progress</span></a></li>
<li class="toclevel-1 tocsection-22">
<a href="#Cross_compiling_with_distcc"><span class="tocnumber">6</span> <span class="toctext">Cross compiling with distcc</span></a>
<ul>
<li class="toclevel-2 tocsection-23">
<a href="#Arch_Linux_ARM_as_clients_(x86_64_as_volunteers)"><span class="tocnumber">6.1</span> <span class="toctext">Arch Linux ARM as clients (x86_64 as volunteers)</span></a>
<ul>
<li class="toclevel-3 tocsection-24"><a href="#Volunteers_2"><span class="tocnumber">6.1.1</span> <span class="toctext">Volunteers</span></a></li>
<li class="toclevel-3 tocsection-25"><a href="#Client_2"><span class="tocnumber">6.1.2</span> <span class="toctext">Client</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-26">
<a href="#Arch_Linux_(x86_64)_as_clients_(Arch_ARM_as_volunteers)"><span class="tocnumber">6.2</span> <span class="toctext">Arch Linux (x86_64) as clients (Arch ARM as volunteers)</span></a>
<ul>
<li class="toclevel-3 tocsection-27"><a href="#Client_3"><span class="tocnumber">6.2.1</span> <span class="toctext">Client</span></a></li>
<li class="toclevel-3 tocsection-28"><a href="#Volunteers_3"><span class="tocnumber">6.2.2</span> <span class="toctext">Volunteers</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-29"><a href="#Additional_toolchains"><span class="tocnumber">6.3</span> <span class="toctext">Additional toolchains</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-30">
<a href="#Troubleshooting"><span class="tocnumber">7</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-31"><a href="#Quirks_compiling_the_Arch_Linux_kernel_package"><span class="tocnumber">7.1</span> <span class="toctext">Quirks compiling the Arch Linux kernel package</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="#Quirks_compiling_chromium"><span class="tocnumber">7.2</span> <span class="toctext">Quirks compiling chromium</span></a></li>
<li class="toclevel-2 tocsection-33"><a href="#Journalctl"><span class="tocnumber">7.3</span> <span class="toctext">Journalctl</span></a></li>
<li class="toclevel-2 tocsection-34"><a href="#Adjust_log_level"><span class="tocnumber">7.4</span> <span class="toctext">Adjust log level</span></a></li>
<li class="toclevel-2 tocsection-35"><a href="#Limit_HDD/SSD_usage_by_relocating_%24HOME/.distcc"><span class="tocnumber">7.5</span> <span class="toctext">Limit HDD/SSD usage by relocating $HOME/.distcc</span></a></li>
<li class="toclevel-2 tocsection-36">
<a href="#For_distccd-alarm"><span class="tocnumber">7.6</span> <span class="toctext">For distccd-alarm</span></a>
<ul>
<li class="toclevel-3 tocsection-37"><a href="#No_such_file_or_directory"><span class="tocnumber">7.6.1</span> <span class="toctext">No such file or directory</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-38"><a href="#Avahi-daemon_stops_publishing_when_distccd.service_starts"><span class="tocnumber">7.7</span> <span class="toctext">Avahi-daemon stops publishing when distccd.service starts</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-39"><a href="#See_also"><span class="tocnumber">8</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Terms">Terms</span></h2>
<dl>
<dt>client</dt>
<dd>The client is the computer initiating the compilation.</dd>
<dt>volunteer</dt>
<dd>The volunteer is the computer accepting compilation requests sent by the client.  One can setup multiple volunteers or just a single one.</dd>
</dl>
<h2><span class="mw-headline" id="Getting_started">Getting started</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=distcc">distcc</a></span> package on all participating  PCs in the distcc cluster.  For other distros, or even operating systems including Windows through using Cygwin, refer to the <a rel="nofollow" class="external text" href="http://distcc.samba.org/doc.html">distcc docs</a> or the included man pages <span class="plainlinks archwiki-template-man" title="$ man 1 distcc"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/distcc.1">distcc(1)</a></span> and <span class="plainlinks archwiki-template-man" title="$ man 1 distccd"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/distccd.1">distccd(1)</a></span>.  Be sure to allow traffic on the port on which distcc runs (the default is 3632/tcp), see <a href="../en/Category:Firewalls.html" title="Category:Firewalls">Category:Firewalls</a>.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<h3><span class="mw-headline" id="Modes_of_operation">Modes of operation</span></h3>
<p>Distcc can be run in plain mode (default) or in pump mode.  At a high level, the key difference is in how distcc deals with preprocessed source.  Plain mode transfers the complete source and compiler args.  Preprocessing is kept on the client.  Pump mode distributes both preprocessing and compilation to the distcc cluser which, in many cases, is more efficient and faster.  See <code>man distcc</code> for more details.
</p>
<h3><span class="mw-headline" id="Volunteers">Volunteers</span></h3>
<p>The configuration for the volunteer is stored in <code>/etc/conf.d/distccd</code>. At a minimum, add the --allow-private switch which covers a number of ipv4 private network ranges.  Logging to a file is also nice for troubleshooting if needed.
</p>
<pre>DISTCC_ARGS="--allow-private --log-file /tmp/distccd.log"
</pre>
<p>If multiple interfaces are present on the machine, consider passing the --listen ADDRESS option as well.  Other options can be defined.  Refer to <span class="plainlinks archwiki-template-man" title="$ man 1 distccd"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/distccd.1">distccd(1)</a></span>. 
</p>
<p><a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">Start</a> <code>distccd.service</code> on every participating volunteer. To have <code>distccd.service</code> start at boot-up, <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Enable">enable</a> it.
</p>
<h3><span class="mw-headline" id="Client">Client</span></h3>
<h4><span class="mw-headline" id="For_use_with_makepkg">For use with makepkg</span></h4>
<p>Edit <code>/etc/makepkg.conf</code> in the following sections:
</p>
<ol>
<li>The BUILDENV array will need to have <i>distcc</i> unbanged i.e. list it without exclamation point.</li>
<li>Uncomment the <i>DISTCC_HOSTS</i> line and add the host name or IP addresses of the volunteers. Optionally, follow this with a forward slash and the max number of threads they are to use.  The subsequent nodes should be separated by a white space.  This list should be ordered from most powerful to least powerful (processing power).</li>
<li>Adjust the MAKEFLAGS variable to correspond roughly twice the number max threads per server.  In the example below, this is 2x(9+5+5+3)=44.</li>
</ol>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Hostnames can be used rather than IP addresses but if the intention is to build using devtools build scripts, name resolution in the build root is not currently supported, so stick with IP addresses in this scenario.  Another reason to use the IP address is on networks running pi-hole for name resolution as pi-hole's logs will record every request from distcc thus spamming the logs with thousands of superfluous lines.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> The <code>-march=native</code> flag cannot be used in the <code>CFLAGS</code> and <code>CXXFLAGS</code> variables, otherwise distccd will not distribute work to other machines.</div>
<p>It should be noted that there are no true universal configurations.  Try one, test it, compare the results to other setups.  The following are a few common setups:
</p>
<h5><span class="mw-headline" id="Plain_mode_example">Plain mode example</span></h5>
<pre>BUILDENV=(distcc fakeroot color !ccache check !sign)
MAKEFLAGS="-j44"
DISTCC_HOSTS="localhost/9 192.168.10.2/5 192.168.10.3/5 192.168.10.4/3"
</pre>
<h5><span class="mw-headline" id="Pump_mode_example">Pump mode example</span></h5>
<pre>BUILDENV=(distcc fakeroot color !ccache check !sign)
MAKEFLAGS="-j70"
DISTCC_HOSTS="localhost/9 192.168.10.2,cpp,lzo 192.168.10.3,cpp,lzo 192.168.10.4,cpp,lzo"
</pre>
<p>Several things to call out here:  
</p>
<ul>
<li>Pump mode generally performs better with a high value for MAKEFLAGS than plain mode.</li>
<li>In pump mode, the IP or hostname is suffixed with a literal ',cpp,lzo' as required by pump mode.  Further, the localhost in this example was not.  This means that distcc will load localhost with the 9 jobs defined and more aggressively distribute the code generation to the volunteers.  It could be that in larger clusters, one might want to restrict the number of local jobs on the localhost to fewer to allow processing of distribution out to the cluster.  One could also use the ,cpp,lzo suffix to the localhost as well.</li>
<li>As mentioned above, there is not a single configuration that will work efficiently with all distcc clusters/determining the optimal settings is more empirical.</li>
</ul>
<h4><span class="mw-headline" id="For_use_without_makepkg">For use without makepkg</span></h4>
<h5><span class="mw-headline" id="Plain_mode_example_2">Plain mode example</span></h5>
<p>The minimal configuration for distcc on the client includes the setting of the available volunteers and re-defining the PATH.
</p>
<pre>$ export PATH="/usr/lib/distcc/bin:$PATH"
$ export DISTCC_HOSTS="localhost/9 192.168.10.2/5 192.168.10.3/5 192.168.10.4/3"
</pre>
<h5><span class="mw-headline" id="Pump_mode_example_2">Pump mode example</span></h5>
<pre>$ export PATH="/usr/lib/distcc/bin:$PATH"
$ export DISTCC_HOSTS="localhost/9 192.168.10.2,cpp,lzo 192.168.10.3,cpp,lzo 192.168.10.4,cpp,lzo"
</pre>
<h2><span class="mw-headline" id="Compile">Compile</span></h2>
<h3><span class="mw-headline" id="With_makepkg">With makepkg</span></h3>
<h5><span class="mw-headline" id="Plain_mode_example_3">Plain mode example</span></h5>
<p>No special steps are needed once <code>/etc/makepkg.conf</code> has been configured.  Simply call makepkg as normal.
</p>
<h5><span class="mw-headline" id="Pump_mode_example_3">Pump mode example</span></h5>
<p>The user must start pump prior to compiling whether with makepkg or on the shell.  Since pump includes a check to make sure there is a set of DISTCC_HOSTS correctly configured, we need to first define a bogus DISTCC_HOSTS line.  Remember that makepkg will use the values specified in <code>/etc/makepkg.conf</code>.
</p>
<pre>$ export DISTCC_HOSTS="localhost,cpp,lzo"
$ eval `pump --startup`
</pre>
<p>Now call makepkg as normal.
</p>
<p>When finished, optionally stop pump:
</p>
<pre>$ pump --shutdown
</pre>
<h3><span class="mw-headline" id="Without_makepkg">Without makepkg</span></h3>
<h5><span class="mw-headline" id="Plain_mode_example_4">Plain mode example</span></h5>
<p>After exporting the two variables describe in <a href="#For_use_without_makepkg">#For use without makepkg</a>, simply call the compiler:
</p>
<pre>$ make -j44
</pre>
<p>Some programs may require one to define the CC and/or CXX variable to work properly:
</p>
<pre> $ make -j44 CC=distcc CXX=distcc
</pre>
<h5><span class="mw-headline" id="Pump_mode_example_4">Pump mode example</span></h5>
<p>Start pump as illustrated above.  Compilation is no different than plain mode.
</p>
<h3><span class="mw-headline" id="With_CMake">With CMake</span></h3>
<p>Use the following CMake options to build a CMake-based project with distcc:
</p>
<pre>$ cmake -DCMAKE_C_COMPILER_LAUNCHER=distcc -DCMAKE_CXX_COMPILER_LAUNCHER=distcc ...
</pre>
<h2><span class="mw-headline" id="Monitoring_progress">Monitoring progress</span></h2>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=distcc">distcc</a></span> ships with a cli monitor <code>distccmon-text</code> one can use to check on compilation status.
</p>
<p>The cli monitor can run continuously by appending a space followed by integer to the command which corresponds to the number of sec to wait for a repeat query:
</p>
<pre>$ distccmon-text 3
29291 Preprocess  probe_64.c                                 192.168.10.2[0]
30954 Compile     apic_noop.c                                192.168.10.2[0]
30932 Preprocess  kfifo.c                                    192.168.10.2[0]
30919 Compile     blk-core.c                                 192.168.10.2[1]
30969 Compile     i915_gem_debug.c                           192.168.10.2[3]
30444 Compile     block_dev.c                                192.168.10.3[1]
30904 Compile     compat.c                                   192.168.10.3[2]
30891 Compile     hugetlb.c                                  192.168.10.3[3]
30458 Compile     catalog.c                                  192.168.10.4[0]
30496 Compile     ulpqueue.c                                 192.168.10.4[2]
30506 Compile     alloc.c                                    192.168.10.4[0]
</pre>
<h2><span class="mw-headline" id="Cross_compiling_with_distcc">Cross compiling with distcc</span></h2>
<p>One can use distcc to help cross compile.  
</p>
<ul>
<li>A machine running the target architecture must be used as the client.</li>
<li>Non-native architecture volunteers will help compile but they require the corresponding toolchain to be installed and their distcc to point to it.</li>
</ul>
<h3>
<span id="Arch_Linux_ARM_as_clients_.28x86_64_as_volunteers.29"></span><span class="mw-headline" id="Arch_Linux_ARM_as_clients_(x86_64_as_volunteers)">Arch Linux ARM as clients (x86_64 as volunteers)</span>
</h3>
<p>This section details how to use Arch Linux (x86_64) volunteers to help an Arch ARM device cross-compile.  See <a rel="nofollow" class="external text" href="https://github.com/graysky2/distccd-alarm">these tests</a> for evidence that speed gains on the order of 2-4x can be realized with just a single x86_64 machine helping an ARM device compile.
</p>
<h4><span class="mw-headline" id="Volunteers_2">Volunteers</span></h4>
<p>The Arch ARM developers <i>highly</i> recommend using the official project <a rel="nofollow" class="external text" href="https://archlinuxarm.org/wiki/Distcc_Cross-Compiling">toolchains</a> which should be installed on the x86_64 volunteer(s).  Rather than manually managing these, the <a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a> provides all four toolchains as well as simple systemd service units:
</p>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/distccd-alarm-armv5/">distccd-alarm-armv5</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/distccd-alarm-armv6h/">distccd-alarm-armv6h</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/distccd-alarm-armv7h/">distccd-alarm-armv7h</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/distccd-alarm-armv8/">distccd-alarm-armv8</a></span><sup><small>AUR</small></sup>
</li>
</ul>
<p>Setup on the volunteer containing the toolchain is identical to <a href="#Volunteers">#Volunteers</a> except that the name of the configuration and systemd service file matches that of the respective package.  For example, for armv7h the config file is <code>/etc/conf.d/distccd-armv7h</code> and the systemd service unit is <code>distccd-armv7h.service</code>.
</p>
<p>Note that each of the toolchains runs on a unique port thus allowing all four of them to co-exist on the volunteer if needed.  Be sure to allow traffic to the port on which distcc runs see <a href="../en/Category:Firewalls.html" title="Category:Firewalls">Category:Firewalls</a> and <span class="plainlinks archwiki-template-man" title="$ man 1 distcc"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/distcc.1">distcc(1)</a></span>.
</p>
<table class="wikitable" align="center">

<tbody>
<tr>
<th>Target architecture</th>
<th>Distcc Port
</th>
</tr>
<tr>
<td><i>armv5</i></td>
<td>3633
</td>
</tr>
<tr>
<td><i>armv6h</i></td>
<td>3634
</td>
</tr>
<tr>
<td><i>armv7h</i></td>
<td>3635
</td>
</tr>
<tr>
<td><i>armv8h/aarch64</i></td>
<td>3636
</td>
</tr>
</tbody>
</table>
<h4><span class="mw-headline" id="Client_2">Client</span></h4>
<p>The easiest method to setup the Arch ARM client is to use the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/distccd-arch-arm/">distccd-arch-arm</a></span><sup><small>AUR</small></sup> package.  It provides the matched set of distccd configuration and systemd service units.  For example, if the client is an armv7h device, optionally edit <code>/etc/conf.d/distccd-armv7h</code> and change the defaults therein.  When ready to build, <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Enable">enable</a> <code>distccd-armv7h.service</code> and compile.
</p>
<p>If one would rather setup the client without using the AUR package mentioned above, manual setup of the client is identical to <a href="#Client">#Client</a> except, one needs to modify the following two files to define the now non-standard port the volunteers are expected to use.  Refer to the table above if using the AUR package.
</p>
<ol>
<li>
<code>/etc/conf.d/distcc</code>: example on an armv7h machine: <code>DISTCC_ARGS="--allow 127.0.0.1 --allow 192.168.10.0/24 --port 3635</code>
</li>
<li>
<code>/etc/makepkg.conf</code>: example on an armv7h machine: <code>DISTCC_HOSTS="192.168.10.2/5:3635 192.168.10.3/5:3635"</code>
</li>
</ol>
<h3>
<span id="Arch_Linux_.28x86_64.29_as_clients_.28Arch_ARM_as_volunteers.29"></span><span class="mw-headline" id="Arch_Linux_(x86_64)_as_clients_(Arch_ARM_as_volunteers)">Arch Linux (x86_64) as clients (Arch ARM as volunteers)</span>
</h3>
<p>This section details how to use Arch ARM volunteers to help an x86_64 client cross-compile.  See <a rel="nofollow" class="external text" href="https://github.com/graysky2/crosstool-ng_for_distcc#real-speed-gains-compiling-x86-64-can-be-realized-with-arm-volunteers">these tests</a> for evidence that compilation times can be significantly sped up using even 1 Arch ARM volunteer and that up to 2 can double that gain.
</p>
<h4><span class="mw-headline" id="Client_3">Client</span></h4>
<p>Setup of the client is identical to <a href="#Client">#Client</a> with distcc running on the standard port 3632.
</p>
<h4><span class="mw-headline" id="Volunteers_3">Volunteers</span></h4>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/distccd-x86_64/">distccd-x86_64</a></span><sup><small>AUR</small></sup> will provide a toolchain to install on the Arch ARM devices to enable cross compilation.
</p>
<h3><span class="mw-headline" id="Additional_toolchains">Additional toolchains</span></h3>
<ul>
<li>
<a rel="nofollow" class="external text" href="https://embtoolkit.org/">EmbToolkit</a>: Tool for creating cross compilation tool chain; supports ARM and MIPS architectures; supports building of an LLVM based tool chain</li>
<li>
<a rel="nofollow" class="external text" href="http://crosstool-ng.org/">crosstool-ng</a>: Similar to EmbToolkit; supports more architectures (see website for more information)</li>
<li>
<a rel="nofollow" class="external text" href="https://www.linaro.org/downloads/">Linaro</a>: Provides tool chains for ARM development</li>
</ul>
<p>The <code>EmbToolkit</code> provides a nice graphical configuration menu (<code>make xconfig</code>) for configuring the tool chain.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Quirks_compiling_the_Arch_Linux_kernel_package">Quirks compiling the Arch Linux kernel package</span></h3>
<p>If building the kernel from the official PKGBUILD (or many from the AUR), distcc will not work due to the fact that the kernel is hard-coded to use GCC plugins which cannot be supported by distccd due to technical reasons.  For more, see <a rel="nofollow" class="external text" href="https://github.com/distcc/distcc/issues/136">Issue #136 </a>.
</p>
<p>One can either edit the PKGBUILD to pass the CC=distcc and CXX=distcc variables as part of the build command:
</p>
<pre>make all CC=distcc CXX=distcc
</pre>
<p>Or one can edit the kernel source removing the hard-coded requirement of GCC plugins.  This can be accomplished with a sed one liner in the PKGBUILD itself inserted before the make step:
</p>
<pre>sed -i '/HAVE_GCC_PLUGINS/d' arch/x86/Kconfig
</pre>
<p>Failure to do this will result in distcc not working during the build.  See <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/64275">FS#64275</a>.
</p>
<h3><span class="mw-headline" id="Quirks_compiling_chromium">Quirks compiling chromium</span></h3>
<p>Compiling <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=chromium">chromium</a></span> which uses clang is currently affected by <a rel="nofollow" class="external text" href="https://github.com/distcc/distcc/issues/368">issue#386</a>.  In order to circumvent the bug, add the following to the <code>_flags</code> array in the PKGBUILD per <a rel="nofollow" class="external text" href="https://blogs.igalia.com/jaragunde/2018/06/13/chromium-official-release-builds-and-icecc/">this</a> blog:
</p>
<pre>'clang_use_default_sample_profile=false'
'is_cfi=false'
</pre>
<h3><span class="mw-headline" id="Journalctl">Journalctl</span></h3>
<p>Use <code>journalctl</code> to find out what was going wrong:
</p>
<pre>$ journalctl $(which distccd) -e --since "5 min ago"
</pre>
<h3><span class="mw-headline" id="Adjust_log_level">Adjust log level</span></h3>
<p>By default, distcc will log to <code>/var/log/messages.log</code> as it goes along.  One trick (actually recommended in the distccd manpage) is to log to an alternative file directly.  Again, one can locate this in RAM via /tmp.  Another trick is to lower to log level of minimum severity of error that will be included in the log file.  Useful if only wanting to see error messages rather than an entry for each connection.  LEVEL can be any of the  standard syslog levels, and in particular critical, error, warning, notice, info, or debug.
</p>
<p>Either call distcc with the arguments mentioned here on the client or appended it to DISTCC_ARGS in <code>/etc/conf.d/distccd</code> on the volunteers:
</p>
<pre>DISTCC_ARGS="--allow 192.168.10.0/24 --log-level error --log-file /tmp/distccd.log"
</pre>
<h3>
<span id="Limit_HDD.2FSSD_usage_by_relocating_.24HOME.2F.distcc"></span><span class="mw-headline" id="Limit_HDD/SSD_usage_by_relocating_$HOME/.distcc">Limit HDD/SSD usage by relocating $HOME/.distcc</span>
</h3>
<p>By default, distcc creates <code>$HOME/.distcc</code> which stores transient relevant info as it serves up work for nodes to compile. This will avoid needless HDD read/writes and is particularly important for SSDs.
</p>
<pre>$ export DISTCC_DIR=/tmp/distcc
</pre>
<h3><span class="mw-headline" id="For_distccd-alarm">For distccd-alarm</span></h3>
<h4><span class="mw-headline" id="No_such_file_or_directory">No such file or directory</span></h4>
<p>Errors similar to the following indicate that the user is mistakenly running the distccd service provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=distcc">distcc</a></span> and NOT provided by the distccd-alarm packages (ie <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/distccd-alarm-armv5/">distccd-alarm-armv5</a></span><sup><small>AUR</small></sup>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/distccd-alarm-armv6h/">distccd-alarm-armv6h</a></span><sup><small>AUR</small></sup>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/distccd-alarm-armv7h/">distccd-alarm-armv7h</a></span><sup><small>AUR</small></sup>, or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/distccd-alarm-armv8/">distccd-alarm-armv8</a></span><sup><small>AUR</small></sup>.)
</p>
<p>Be sure to start the correct service for the target architecture.
</p>
<pre>distcc[25479] (dcc_execvp) ERROR: failed to exec armv7l-unknown-linux-gnueabihf-g++: No such file or directory
</pre>
<h3><span class="mw-headline" id="Avahi-daemon_stops_publishing_when_distccd.service_starts">Avahi-daemon stops publishing when distccd.service starts</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> This does not fix anything if the user <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Restart">restarts</a> the service later. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Distcc">Talk:Distcc#</a>)</div>
</div>
<p>Launching <code>distccd.service</code> as a service might cause <code>avahi-daemon</code> to stop working. This can be mitigated by making sure <code>avahi-daemon.service</code> starts after <code>distccd.service</code> by editing <code>avahi-daemon.service</code>'s unit file (see <a href="../en/Systemd.html#Editing_provided_units" title="Systemd">Systemd#Editing provided units</a>) and adding <code>After=distccd.service</code> at the end of the <code>[Unit]</code> section:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/avahi-daemon.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...

[Unit]
Description=Avahi mDNS/DNS-SD Stack
Requires=avahi-daemon.socket
After=distccd.service

...</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul><li><a rel="nofollow" class="external free" href="https://github.com/distcc/distcc">https://github.com/distcc/distcc</a></li></ul>
<ul><li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/icecream/">icecream</a></span><sup><small>AUR</small></sup> - An easier to configure fork of distcc.</li></ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Distributed_computing.html" title="Category:Distributed computing">Distributed computing</a></li>
<li><a href="../en/Category:Development.html" title="Category:Development">Development</a></li>
<li><a href="../en/Category:Package_development.html" title="Category:Package development">Package development</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li></ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Distcc&amp;oldid=647356">https://wiki.archlinux.org/index.php?title=Distcc&amp;oldid=647356</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 27 December 2020, at 20:53.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
