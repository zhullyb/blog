<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>System76 Darter Pro 6 - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-System76_Darter_Pro_6 rootpage-System76_Darter_Pro_6 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">System76 Darter Pro 6</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Installation"><span class="tocnumber">1</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Drivers"><span class="tocnumber">2</span> <span class="toctext">Drivers</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Screen_Brightness"><span class="tocnumber">3</span> <span class="toctext">Screen Brightness</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Keyboard_Backlight"><span class="tocnumber">4</span> <span class="toctext">Keyboard Backlight</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Palm_Detection"><span class="tocnumber">5</span> <span class="toctext">Palm Detection</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#X11"><span class="tocnumber">6</span> <span class="toctext">X11</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Suspend/Resume"><span class="tocnumber">7</span> <span class="toctext">Suspend/Resume</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#DisplayPort_over_USB-C"><span class="tocnumber">8</span> <span class="toctext">DisplayPort over USB-C</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>Installation was uneventful. This particular laptop does use Coreboot, but it was otherwise a normal EFI installation.
</p>
<p>One may consider mounting their boot partition to /boot/efi instead of /boot, since <a rel="nofollow" class="external text" href="https://github.com/pop-os/system76-firmware/blob/dde2142ccfc6aeed90873d639b38049303385967/daemon/src/main.rs#L29-L30">System76's firmware update tool hard-codes /boot/efi as the mount point</a>. This got fixed <a rel="nofollow" class="external autonumber" href="https://github.com/pop-os/system76-firmware/pull/29">[1]</a> but there is no new release yet.
</p>
<h2><span class="mw-headline" id="Drivers">Drivers</span></h2>
<p>Driver support for the System76 Darter Pro 6 should be <a rel="nofollow" class="external text" href="https://old.reddit.com/r/System76/comments/ev4jry/archlinux_on_the_system76_darter_pro/fftl66v/">included the kernel as of Linux 5.5</a>. For older kernels, there are various drivers in the AUR.
</p>
<p>Otherwise, the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/system76-firmware-daemon/">system76-firmware-daemon</a></span><sup><small>AUR</small></sup> (or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/system76-firmware-daemon-git/">system76-firmware-daemon-git</a></span><sup><small>AUR</small></sup>) package provides the <code>system76-firmware-cli</code> tool, which can be used to schedule firmware updates.
</p>
<h2><span class="mw-headline" id="Screen_Brightness">Screen Brightness</span></h2>
<p>Works out of the box with the <code>xorg-xbacklight</code> package.
</p>
<h2><span class="mw-headline" id="Keyboard_Backlight">Keyboard Backlight</span></h2>
<p>The keyboard backlight can be controlled programmatically via <code>/sys</code> entries. Specifically,
</p>
<pre># sh -c "echo 255 &gt; /sys/class/leds/system76_acpi::kbd_backlight/brightness"
</pre>
<p>will increase the brightness to its maximum, and
</p>
<pre># sh -c "echo FFA500 &gt; /sys/class/leds/system76_acpi::kbd_backlight/color"
</pre>
<p>will set the color of the backlight via a 6-digit RGB hex code.
</p>
<h2><span class="mw-headline" id="Palm_Detection">Palm Detection</span></h2>
<p>If the touchpad is not sensitive enough to detect your palm, then it is possible to reduce the palm pressure detection threshold using libinput's quirks. The first step is to <a rel="nofollow" class="external text" href="https://wayland.freedesktop.org/libinput/doc/latest/touchpad-pressure-debugging.html">follow the instructions for debugging touchpad pressure</a> (you will need the <code>python-pyudev</code> and <code>python-libevdev</code> packages installed). Once you run the program, youâ€™ll be able to experiment with different ways to touch the touchpad and see which things are registered as clicks and which are registered as a palm.
</p>
<p>Once you have found the ideal palm pressure threshold, you can make it persistent by creating a libinput quirks file at <code>/etc/libinput/local-overrides.quirks</code>. For example, the following decreases the threshold to <code>70</code>:
</p>
<pre>[Touchpad pressure override]
MatchUdevType=touchpad
MatchName=*SynPS/2 Synaptics TouchPad
MatchDMIModalias=dmi:*svnSystem76*pvrdarp6*
AttrPalmPressureThreshold=70
</pre>
<p>To confirm it is working correctly, run
</p>
<pre>$ libinput quirks list /dev/input/eventXX
</pre>
<p>where <code>XX</code> is the number of the event device. (It should be shown in the output of the <code>libinput measure touchpad-pressure</code> command that you ran above.) The output should look something like this, with no errors:
</p>
<pre>ModelSynapticsSerialTouchpad=1
AttrPalmPressureThreshold=70
</pre>
<p>At this point, you can reboot and the setting should be applied persistently.
</p>
<h2><span class="mw-headline" id="X11">X11</span></h2>
<p>Install intel-media-driver for hardware accelerated graphics. Do NOT install xf86-video-intel, and libva-mesa-driver packages.
</p>
<h2>
<span id="Suspend.2FResume"></span><span class="mw-headline" id="Suspend/Resume">Suspend/Resume</span>
</h2>
<p>Occasionally, on Linux 5.4, it was found that the laptop would become unresponsive when resuming from sleep. After about 90 seconds, the laptop would unfreeze itself and resume normal operation. After profiling the kernel with <a rel="nofollow" class="external text" href="https://github.com/01org/suspendresume">suspendresume</a>, it was found that the culprit was the thunderbolt port. Namely, this error message was found in <code>dmesg</code>:
</p>
<pre>[  803.725685] thunderbolt 0000:03:00.0: failed to send driver ready to ICM
</pre>
<p>One approach to fix this is to disable thunderbolt support on suspend and then re-enable it on resume. This can be done via a systemd hook script.
</p>
<p>Drop the following into <code>/usr/lib/systemd/system-sleep/system76-darter-hook-sleep</code> and make it executable:
</p>
<pre>#!/bin/sh

# This is a systemd hook script that is run whenever
# suspend/resume takes place. It should be symlinked into
# /usr/lib/systemd/system-sleep.

# $1 is 'pre' (going to sleep) or 'post' (waking up)
# $2 is 'suspend', 'hibernate' or 'hybrid-sleep'
case "$1/$2" in
  pre/*)
    if lsmod | grep -q thunderbolt; then
      rmmod thunderbolt
    fi
    ;;
  post/*)
    modprobe thunderbolt
    ;;
esac
</pre>
<p>Alternatively, System76 support <a rel="nofollow" class="external text" href="https://github.com/pop-os/system76-driver/blob/354d396bd7d37e591e5ed204b566c2d0c3f0dc3d/system76-thunderbolt-reload#L1">suggested disabling the corresponding PCI device on suspend and then reloading it on resume.</a> Adapting their <code>Pop!_OS</code> fix for Archlinux, the above file might look like this instead:
</p>
<pre>#!/bin/sh

# This is a systemd hook script that is run whenever
# suspend/resume takes place. It should be symlinked into
# /usr/lib/systemd/system-sleep.

# $1 is 'pre' (going to sleep) or 'post' (waking up)
# $2 is 'suspend', 'hibernate' or 'hybrid-sleep'
case "$1/$2" in
  pre/*)
    echo 1 &gt; '/sys/devices/pci0000:00/0000:00:1c.0/remove'
    ;;
  post/*)
    echo 1 &gt; '/sys/devices/pci0000:00/pci_bus/0000:00/bus_rescan'     
    ;;
esac
</pre>
<p>You may find that <code>/sys/devices/pci0000:00/pci_bus/0000:00/bus_rescan</code> does not exist but <code>/sys/devices/pci0000:00/pci_bus/0000:00/rescan</code> does.
</p>
<h2><span class="mw-headline" id="DisplayPort_over_USB-C">DisplayPort over USB-C</span></h2>
<p>For proper operation of DisplayPort over USB-C you need the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/system76-power/">system76-power</a></span><sup><small>AUR</small></sup> package, system-76 power service enabled with <code>systemctl enable --now system76-power.service</code> and following parameter in kernel cmdline <code>iomem=relaxed</code>.
</p>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:System76.html" title="Category:System76">System76</a></li></ul>
</div></div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=System76_Darter_Pro_6&amp;oldid=633570">https://wiki.archlinux.org/index.php?title=System76_Darter_Pro_6&amp;oldid=633570</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 27 August 2020, at 09:10.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
