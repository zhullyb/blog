<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Makepkg (Português) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Makepkg_Português rootpage-Makepkg_Português skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Makepkg (Português)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Status de tradução:</strong> Esse artigo é uma tradução de <a href="../en/Makepkg.html" title="Makepkg">Makepkg</a>. Data da última tradução: 2020-06-17. Você pode ajudar a sincronizar a tradução, se houver <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Makepkg&amp;diff=0&amp;oldid=618806">alterações</a> na versão em inglês.</div>
<div class="archwiki-template-meta-related-articles-start">
<p>Artigos relacionados</p>
<ul>
<li><a href="../pt/Creating_packages.html" class="mw-redirect" title="Criando pacotes">Criando pacotes</a></li>
<li><a href="../pt/PKGBUILD.html" title="PKGBUILD (Português)">PKGBUILD</a></li>
<li><a href="../pt/Arch_User_Repository.html" title="Arch User Repository (Português)">Arch User Repository</a></li>
<li><a href="../pt/Pacman.html" title="Pacman (Português)">pacman</a></li>
<li><a href="../pt/Official_repositories.html" class="mw-redirect" title="Repositórios oficiais">Repositórios oficiais</a></li>
<li><a href="../pt/Arch_Build_System.html" title="Arch Build System (Português)">Arch Build System</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://projects.archlinux.org/pacman.git/tree/scripts/makepkg.sh.in">makepkg</a> é um script usado para automatizar a compilação de pacotes. Os requisitos para usar o script são uma plataforma tipo Unix capaz de compilar e um <a href="../pt/PKGBUILD.html" title="PKGBUILD (Português)">PKGBUILD</a>. 
</p>
<p>O <i>makepkg</i> é fornecido pelo pacote <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman">pacman</a></span>.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Configura%C3%A7%C3%A3o"><span class="tocnumber">1</span> <span class="toctext">Configuração</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Informa%C3%A7%C3%A3o_do_empacotador"><span class="tocnumber">1.1</span> <span class="toctext">Informação do empacotador</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Sa%C3%ADda_de_pacote"><span class="tocnumber">1.2</span> <span class="toctext">Saída de pacote</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Verifica%C3%A7%C3%A3o_de_assinatura"><span class="tocnumber">1.3</span> <span class="toctext">Verificação de assinatura</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="#Uso"><span class="tocnumber">2</span> <span class="toctext">Uso</span></a></li>
<li class="toclevel-1 tocsection-6">
<a href="#Dicas_e_truques"><span class="tocnumber">3</span> <span class="toctext">Dicas e truques</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Compilando_bin%C3%A1rios_otimizados"><span class="tocnumber">3.1</span> <span class="toctext">Compilando binários otimizados</span></a></li>
<li class="toclevel-2 tocsection-8">
<a href="#Melhorando_os_tempos_de_compila%C3%A7%C3%A3o"><span class="tocnumber">3.2</span> <span class="toctext">Melhorando os tempos de compilação</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#Compila%C3%A7%C3%A3o_paralela"><span class="tocnumber">3.2.1</span> <span class="toctext">Compilação paralela</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#Compilando_de_arquivos_na_mem%C3%B3ria"><span class="tocnumber">3.2.2</span> <span class="toctext">Compilando de arquivos na memória</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#Usando_cache_de_compila%C3%A7%C3%A3o"><span class="tocnumber">3.2.3</span> <span class="toctext">Usando cache de compilação</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-12"><a href="#Gerar_novos_checksums"><span class="tocnumber">3.3</span> <span class="toctext">Gerar novos checksums</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Usar_outros_algoritmos_de_compress%C3%A3o"><span class="tocnumber">3.4</span> <span class="toctext">Usar outros algoritmos de compressão</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Usando_v%C3%A1rios_n%C3%BAcleos_na_compress%C3%A3o"><span class="tocnumber">3.5</span> <span class="toctext">Usando vários núcleos na compressão</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Mostrar_pacotes_com_um_empacotador_espec%C3%ADfico"><span class="tocnumber">3.6</span> <span class="toctext">Mostrar pacotes com um empacotador específico</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Compilar_pacotes_32_bits_em_um_sistema_64_bits"><span class="tocnumber">3.7</span> <span class="toctext">Compilar pacotes 32 bits em um sistema 64 bits</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-17">
<a href="#Solu%C3%A7%C3%A3o_de_problemas"><span class="tocnumber">4</span> <span class="toctext">Solução de problemas</span></a>
<ul>
<li class="toclevel-2 tocsection-18"><a href="#Especificando_diret%C3%B3rio_de_instala%C3%A7%C3%A3o_para_pacotes_baseados_em_QMAKE"><span class="tocnumber">4.1</span> <span class="toctext">Especificando diretório de instalação para pacotes baseados em QMAKE</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#AVISO:_O_pacote_cont%C3%A9m_refer%C3%AAncia_para_%24srcdir"><span class="tocnumber">4.2</span> <span class="toctext">AVISO: O pacote contém referência para $srcdir</span></a></li>
<li class="toclevel-2 tocsection-20">
<a href="#Makepkg_falha_em_baixar_depend%C3%AAncias_quando_por_tr%C3%A1s_de_um_proxy"><span class="tocnumber">4.3</span> <span class="toctext">Makepkg falha em baixar dependências quando por trás de um proxy</span></a>
<ul>
<li class="toclevel-3 tocsection-21"><a href="#Habilitar_proxy_definindo_sua_URL_no_XferCommand"><span class="tocnumber">4.3.1</span> <span class="toctext">Habilitar proxy definindo sua URL no XferCommand</span></a></li>
<li class="toclevel-3 tocsection-22"><a href="#Habilitar_proxy_via_env_keep_do_sudoers"><span class="tocnumber">4.3.2</span> <span class="toctext">Habilitar proxy via env_keep do sudoers</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-23"><a href="#Makepkg_falha,_mas_make_obt%C3%A9m_sucesso"><span class="tocnumber">4.4</span> <span class="toctext">Makepkg falha, mas make obtém sucesso</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-24"><a href="#Veja_tamb%C3%A9m"><span class="tocnumber">5</span> <span class="toctext">Veja também</span></a></li>
</ul>
</div>

<h2>
<span id="Configura.C3.A7.C3.A3o"></span><span class="mw-headline" id="Configuração">Configuração</span>
</h2>
<p>Veja <span class="plainlinks archwiki-template-man" title="$ man 5 makepkg.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/makepkg.conf.5">makepkg.conf(5)</a></span> para detalhes sobre as opções de configuração do <i>makepkg</i>.
</p>
<p>A configuração do sistema está disponível em <code>/etc/makepkg.conf</code>, mas alterações específicas para cada usu[ario podem ser feitas em <code>$XDG_CONFIG_HOME/pacman/makepkg.conf</code> ou <code>~/.makepkg.conf</code>. É recomendado revisar a configuração antes de compilar pacotes. 
</p>
<h3>
<span id="Informa.C3.A7.C3.A3o_do_empacotador"></span><span class="mw-headline" id="Informação_do_empacotador">Informação do empacotador</span>
</h3>
<p>Cada pacote é marcado com metadados identificando, entre outros, também o <i>empacotador</i>. Por padrão, os pacotes compilados pelo usuário são marcados com <code>Empacotador desconhecido</code>. Se vários usuários estiverem compilando pacotes em um sistema, ou de outra forma distribuindo seus pacotes para outros usuários, é conveniente fornecer contato real. Isso pode ser feito configurando a variável <code>PACKAGER</code> em <code>makepkg.conf</code>.
</p>
<p>Para verificar isso em um pacote instalado:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ pacman -Qi <i>pacote</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Empacotador       : John Doe &lt;john@doe.com&gt;
...
</pre>
<p>Para automaticamente produzir pacotes assinados, defina também a variável <code>GPGKEY</code> em <code>makepkg.conf</code>.
</p>
<h3>
<span id="Sa.C3.ADda_de_pacote"></span><span class="mw-headline" id="Saída_de_pacote">Saída de pacote</span>
</h3>
<p>Por padrão, <i>makepkg</i> cria os <i>tarballs</i> de pacote no diretório atual de trabalho e baixa os dados fonte diretamente para o diretório <code>src/</code>. Caminhos personalizados podem ser configurados, por exemplo, para manter todos os pacotes compilados em <code>~/build/pacotes/</code> e todos os fontes em <code>~/build/fontes/</code>.
</p>
<p>Configure as seguintes variáveis do <code>makepkg.conf</code>, se necessário:
</p>
<ul>
<li>
<code>PKGDEST</code> – diretório para armazenar pacotes resultantes</li>
<li>
<code>SRCDEST</code> – diretório para armazenar dados <a href="../pt/PKGBUILD.html#source" title="PKGBUILD (Português)">fonte</a> (links simbólicos serão colocados em <code>src/</code> se ele aponta para outro lugar)</li>
<li>
<code>SRCPKGDEST</code> – diretório para armazenar os pacotes fontes (compilado com <code>makepkg -S</code>)</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> O diretório <code>PKGDEST</code> pode ser limpado com, p. ex., <code>paccache -c ~/build/pacotes/</code> como descrito em <a href="../pt/Pacman.html#Limpando_o_cache_de_pacotes" title="Pacman (Português)">pacman (Português)#Limpando o cache de pacotes</a>.</div>
<h3>
<span id="Verifica.C3.A7.C3.A3o_de_assinatura"></span><span class="mw-headline" id="Verificação_de_assinatura">Verificação de assinatura</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> A verificação de assinatura implementada no <i>makepkg</i> não usa o chaveiro do pacman; em vez disso, depende do chaveiro do usuário.<a rel="nofollow" class="external autonumber" href="http://allanmcrae.com/2015/01/two-pgp-keyrings-for-package-management-in-arch-linux/">[1]</a>
</div>
<p>Se um arquivo de assinatura na forma de <i>.sig</i> ou <i>.asc</i> é parte do vetor fonte do <a href="../pt/PKGBUILD.html" title="PKGBUILD (Português)">PKGBUILD</a>, o <i>makepkg</i> tenta automaticamente <a href="../en/GnuPG.html#Verify_a_signature" title="GnuPG">verificá-la</a>. No caso do chaveiro do usuário não contém a chave pública necessária para verificação de assinatura, o <i>makepkg</i> vai abortar a instalação com uma mensagem de que a chave PGP não pôde ser verificada.
</p>
<p>Se uma chave pública necessária para um pacote está faltando, o <a href="../pt/PKGBUILD.html" title="PKGBUILD (Português)">PKGBUILD</a> muito provavelmente vai conter uma entrada <a href="../pt/PKGBUILD.html#validpgpkeys" title="PKGBUILD (Português)">validpgpkeys</a> com os IDs de chaves necessárias. Você pode <a href="../en/GnuPG.html#Import_a_public_key" title="GnuPG">importá-la</a> manualmente ou você pode localizá-la <a href="../en/GnuPG.html#Use_a_keyserver" title="GnuPG">em um servidor de chaves</a> e importá-la de lá.
</p>
<h2><span class="mw-headline" id="Uso">Uso</span></h2>
<p>Antes de continuar, <a href="../pt/Help:Reading.html#Instala%C3%A7%C3%A3o_de_pacotes" class="mw-redirect" title="Instale">instale</a> o grupo <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/groups/x86_64/base-devel/">base-devel</a></span>. Os pacotes que pertencem a este grupo <b>não</b> são exigidos na lista de dependência de compilação (<i>makedepends</i>) nos arquivos <a href="../pt/PKGBUILD.html" title="PKGBUILD (Português)">PKGBUILD</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> * Certifique-se de que o <a href="../pt/Sudo.html" title="Sudo (Português)">sudo</a> está configurado corretamente para comandos passados para o <a href="../pt/Pacman.html" title="Pacman (Português)">pacman</a>.
<ul><li>Executar <i>makepkg</i> em si como root <a rel="nofollow" class="external text" href="https://lists.archlinux.org/pipermail/pacman-dev/2014-March/018911.html">não é permitido</a>.<a rel="nofollow" class="external autonumber" href="https://projects.archlinux.org/pacman.git/tree/NEWS">[2]</a> Além disso, como um <code>PKGBUILD</code> pode conter comandos arbitrários, compilar como root geralmente é considerado inseguro.<a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=67561">[3]</a> Usuários que não possuem acesso a uma conta de usuário comum devem executar o makepkg como o <a rel="nofollow" class="external text" href="http://allanmcrae.com/2015/01/replacing-makepkg-asroot/">usuário <i>nobody</i></a>.</li></ul>
</div>
<p>Para compilar um pacote, deve-se primeiro criar um <a href="../pt/PKGBUILD.html" title="PKGBUILD (Português)">PKGBUILD</a>, ou um script de compilação, como descrito em <a href="../pt/Creating_packages.html" class="mw-redirect" title="Criando pacotes">Criando pacotes</a>. Scripts existentes estão disponíveis na árvore do <a href="../pt/Arch_Build_System.html" title="Arch Build System (Português)">Arch Build System</a> <i>(ABS)</i> ou do <a href="../pt/Arch_User_Repository.html" class="mw-redirect" title="AUR (Português)">AUR</a>. Uma vez em posse de um <code>PKGBUILD</code>, altere o diretório no qual está salvo e execute o seguinte comando para compilar o pacote:
</p>
<pre>$ makepkg
</pre>
<p>Se estiverem faltando dependências necessárias, o <i>makepkg</i> emitirá um aviso antes de falhar. Para compilar o pacote e instalar as dependências necessárias, adicione a opção <code>-s/--syncdeps</code>:
</p>
<pre>$ makepkg --syncdeps
</pre>
<p>Adicionar as opções <code>-r</code>/<code>--rmdeps</code> faz com que o <i>makepkg</i> remova as dependências de compilação logo em seguida, já que não são mais necessárias. Se estiver compilando pacotes constantemente, considere usar <a href="../pt/e746729236f459b9c753b9b9307aab6d.html#Removendo_pacotes_n%C3%A3o_usados_(%C3%B3rf%C3%A3os)" class="mw-redirect" title="Pacman/Dicas e truques">Pacman/Dicas e truques#Removendo pacotes não usados (órfãos)</a> de vez em quando.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> 
<ul>
<li>Essas dependências devem estar disponíveis nos repositórios configurados; veja <a href="../pt/Pacman.html#Reposit%C3%B3rios_e_espelhos" title="Pacman (Português)">pacman (Português)#Repositórios e espelhos</a> para detalhes. Alternativamente, pode-se instalar manualmente as dependências antes de compilar (<code>pacman -S --asdeps <i>dep1</i> <i>dep2</i></code>).</li>
<li>Apenas valores globais são usados ao instalar dependências, ou seja, qualquer sobrescrita feita em uma função de empacotamento de pacotes divididos não serão sadas.</li>
</ul>
</div>
<p>Uma vez que todas as dependências estejam satisfeitas e os pacotes compilados com sucesso, um arquivo de pacote (<code><i>pkgname</i>-<i>pkgver</i>.pkg.tar.xz</code>) será criado no diretório. Para instalar, use <code>-i</code>/<code>--install</code> (o mesmo que <code>pacman -U <i>pkgname</i>-<i>pkgver</i>.pkg.tar.xz</code>):
</p>
<pre># pacman --install
</pre>
<p>Para limpar arquivos e pastas restantes, tais como arquivos extraídos para $<code>$srcdir</code>, adicione a opção <code>-c</code>/<code>--clean</code>. Isso é útil para várias compilações do mesmo pacote ou ao atualizar a versão do pacote, enquanto usa a mesma pasta de compilação. Isso evita arquivos obsoletos e remanescentes de serem carregados para novas compilações:
</p>
<pre>$ makepkg --clean
</pre>
<p>Para mais informações, veja <a rel="nofollow" class="external text" href="https://archlinux.org/pacman/makepkg.8.html">makepkg(8)</a>.
</p>
<h2><span class="mw-headline" id="Dicas_e_truques">Dicas e truques</span></h2>
<h3>
<span id="Compilando_bin.C3.A1rios_otimizados"></span><span class="mw-headline" id="Compilando_binários_otimizados">Compilando binários otimizados</span>
</h3>
<p>Uma melhoria de desempenho do software empacotado pode ser conseguida ao habilitar otimizações do compilador para a máquina host. A desvantagem é que os binários compilados para uma arquitetura de processador específica não serão executados corretamente em outras máquinas. Nas máquinas x86_64, raramente existem ganhos de desempenho reais significativos que justificariam investir o tempo para reconstruir pacotes oficiais.
</p>
<p>No entanto, é muito fácil reduzir o desempenho usando <i>flags</i> de compilação "não padronizadas". Muitas otimizações de compilação só são úteis em certas situações e não devem ser aplicadas indiscriminadamente em cada pacote. A menos que você possa verificar/avaliar que algo é mais rápido, há uma chance muito boa de não ser! O <a rel="nofollow" class="external text" href="http://www.gentoo.org/doc/en/gcc-optimization.xml">Guia de Otimização de Compilação</a> e artigo wiki <a rel="nofollow" class="external text" href="http://wiki.gentoo.org/wiki/Safe_CFLAGS">CFLAGS Seguras</a> do Gentoo (ambos em inglês) fornecem mais informações detalhadas sobre a otimização do compilador.
</p>
<p>As opções passadas para um compilador C/C++ (ex.: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gcc">gcc</a></span> ou <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=clang">clang</a></span>) são controladas pelas variáveis de ambiente <code>CFLAGS</code>, <code>CXXFLAGS</code> e<code>CPPFLAGS</code>. Para usar o sistema de compilação do Arch, o <i>makepkg</i> expõe essas variáveis de ambiente como opções de configuração no <code>makepkg.conf</code>. Os valores padrão são configurados para produzir binários genéricos que podem ser instalados em uma ampla gama de máquinas.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> * Tenha em mente que nem todos os sistemas de compilação usam as variáveis configuradas no <code>makepkg.conf</code>. Por exemplo, <i>cmake</i> ignora a variável de ambiente das opções de pré-processador, <code>CPPFLAGS</code>. Consequentemente, muitos <a href="../pt/PKGBUILD.html" title="PKGBUILD (Português)">PKGBUILD</a> contêm soluções alternativas com opções específicas para o sistema de compilação usado pelo software empacotado.
<ul><li>A configuração fornecida com o código fonte no <code>Makefile</code> ou em um argumento específico na linha de comando de compilação tem a preferência e pode potencialmente sobrescrever aquela no <code>makepkg.conf</code>.</li></ul>
</div>
<p>O GCC pode detectar e habilitar automaticamente otimizações seguras específicas para cada arquitetura. Para usar esse recurso, primeiro remova os sinalizadores <code>-march</code> e <code>-mtune</code>, então adicione <code>-march = native</code>. Por exemplo:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/makepkg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">CFLAGS="<b>-march=native</b> -O2 -pipe -fstack-protector-strong -fno-plt"
CXXFLAGS="${CFLAGS}"</pre>
<p>Para ver quais sinalizadores isso habilita em sua máquina, execute:
</p>
<pre>$ gcc -march=native -v -Q --help=target
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Se você especificar um valor diferente de <code>-march=native</code>, então <code>-Q --help=target</code> <b>não vai</b> funcionar como esperado.<a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?pid=1616694#p1616694">[4]</a> Você precisa passar por uma fase de compilação para descobrir quais opções estão realmente habilitadas. Veja <a rel="nofollow" class="external text" href="https://wiki.gentoo.org/wiki/Safe_CFLAGS#Find_CPU-specific_options">Encontre opções específicas da CPU</a> (inglês) no wiki do Gentoo para instruções.</div>
<h3>
<span id="Melhorando_os_tempos_de_compila.C3.A7.C3.A3o"></span><span class="mw-headline" id="Melhorando_os_tempos_de_compilação">Melhorando os tempos de compilação</span>
</h3>
<h4>
<span id="Compila.C3.A7.C3.A3o_paralela"></span><span class="mw-headline" id="Compilação_paralela">Compilação paralela</span>
</h4>
<p>O sistema de compilação do <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=make">make</a></span> usa a <a href="../pt/Environment_variables.html" class="mw-redirect" title="Variável de ambiente">variável de ambiente</a> <code>MAKEFLAGS</code> para especificar opções adicionais para o <i>make</i>. A variável também pode ser definida no arquivo <code>makepkg.conf</code>.
</p>
<p>Os usuários com sistemas multi-core/multiprocessados podem especificar o número de trabalhos a serem executados simultaneamente. Isso pode ser realizado com o uso de <i>nproc</i> para determinar o número de processadores disponíveis, ex. <code>MAKEFLAGS="-j$(nproc)"</code>. Alguns <a href="../pt/PKGBUILD.html" title="PKGBUILD (Português)">PKGBUILD</a> substituem especificamente isso com <code>-j1</code>, devido a condições de corrida em certas versões ou simplesmente porque não é suportado em primeiro lugar. Os pacotes que não conseguem ser compilados devido a isso devem ser <a href="../pt/Bug_reporting_guidelines.html" class="mw-redirect" title="Diretrizes de relatórios de erro">relatados</a> no rastreador de erros (ou no caso dos pacotes do <a href="../pt/Arch_User_Repository.html" class="mw-redirect" title="AUR (Português)">AUR</a>, ao mantenedor do pacote) depois de ter certeza de que o erro está sendo realmente causado pelo seu <code>MAKEFLAGS</code>.
</p>
<p>Veja <span class="plainlinks archwiki-template-man" title="$ man 1 make"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/make.1">make(1)</a></span> para uma lista completa de opções disponíveis.
</p>
<h4>
<span id="Compilando_de_arquivos_na_mem.C3.B3ria"></span><span class="mw-headline" id="Compilando_de_arquivos_na_memória">Compilando de arquivos na memória</span>
</h4>
<p>Como a compilação requer muitas operações de E/S e lidar com arquivos pequenos, mover o diretório de trabalhos para um <a href="../en/Tmpfs.html" title="Tmpfs">tmpfs</a> pode trazer melhorias em tempos de compilação.
</p>
<p>A variável <code>BUILDDIR</code> pode ser temporariamente exportada para <i>makepkg</i> para definir o diretório de compilação para um tmpfs existente. Por exemplo:
</p>
<pre>$ BUILDDIR=/tmp/makepkg makepkg
</pre>
<p>Uma configuração persistente pode ser feita no <code>makepkg.conf</code> descomentando a opção <code>BUILDDIR</code>, que é encontrada no fim da seção <code>BUILD ENVIRONMENT</code> no arquivo padrão <code>/etc/makepkg.conf</code>. Definir esses valores para, por exemplo, <code>BUILDDIR=/tmp/makepkg</code> fará uso do sistema de arquivos temporário <code>/tmp</code> padrão do Arch.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> 
<ul>
<li>Evite compilar pacotes grandes no tmpfs para evitar ficar sem memória.</li>
<li>A pasta tmpfs deve ser montada sem a opção <code>noexec</code>; do contrário, ela vai impedir que binários sejam executados.</li>
<li>Tenha em mente que pacotes compilados no tmpfs não persistirá após reinicialização. Considere configurar a opção <a href="#Sa%C3%ADda_de_pacote">PKGDEST</a> apropriadamente para mover o pacote compilado automaticamente para um diretório persistente.</li>
</ul>
</div>
<h4>
<span id="Usando_cache_de_compila.C3.A7.C3.A3o"></span><span class="mw-headline" id="Usando_cache_de_compilação">Usando cache de compilação</span>
</h4>
<p>O uso de <a href="../pt/Ccache.html" title="Ccache (Português)">ccache</a> pode melhorar os tempos de compilação ao armazenar em cache os resultados de compilações para uso sucessivo.
</p>
<h3><span class="mw-headline" id="Gerar_novos_checksums">Gerar novos checksums</span></h3>
<p>Instale <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman-contrib">pacman-contrib</a></span> e execute o seguinte comando no mesmo diretório que o arquivo PKGBUILD para gerar novas somas de verificação (<i>checksums</i>):
</p>
<pre>$ updpkgsums
</pre>
<p>As somas de verificação também podem ser obtidos com, por exemplo, <code>sha256sum</code> e adicionados ao vetor <code>sha256sums</code> manualmente.
</p>
<h3>
<span id="Usar_outros_algoritmos_de_compress.C3.A3o"></span><span class="mw-headline" id="Usar_outros_algoritmos_de_compressão">Usar outros algoritmos de compressão</span>
</h3>
<p>Para acelerar o empacotamento e a instalação, com a consequência de ter arquivos de pacotes maiores, você pode alterar <code>PKGEXT</code>. Por exemplo, o seguinte torna o arquivo de pacote descompactado para apenas uma invocação:
</p>
<pre>$ PKGEXT='.pkg.tar' makepkg
</pre>
<p>Um outro exemplo abaixo mostra o uso do algoritmo lzop, com o pacote <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lzop">lzop</a></span> necessário:
</p>
<pre>$ PKGEXT='.pkg.tar.lzo' makepkg
</pre>
<p>Para fazer uma dessas configurações permanentes, configure <code>PKGEXT</code> em <code>/etc/makepkg.conf</code>.
</p>
<h3>
<span id="Usando_v.C3.A1rios_n.C3.BAcleos_na_compress.C3.A3o"></span><span class="mw-headline" id="Usando_vários_núcleos_na_compressão">Usando vários núcleos na compressão</span>
</h3>
<p>O <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xz">xz</a></span> oferece suporte a <a href="https://en.wikipedia.org/wiki/pt:Multiprocessamento_sim%C3%A9trico" class="extiw" title="wikipedia:pt:Multiprocessamento simétrico">multiprocessamento simétrico (SMP)</a> por meio do sinalizador <code>--threads</code> para acelerar a compressão. Por exemplo, para deixar o makepkg usar quantos núcleos de CPU for possível para comprimir os pacotes, edite o vetor <code>COMPRESSXZ</code> em <code>/etc/makepkg.conf</code>:
</p>
<pre>COMPRESSXZ=(xz -c -z - <b>--threads=0</b>)
</pre>
<p>O <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pigz">pigz</a></span> é uma implementação paralela para o <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gzip">gzip</a></span> que, por padrão, usa todos os núcleos disponíveis na CPU (o sinalizador <code>-p/--processes</code> pode ser usado para empregar menos núcleos):
</p>
<pre>COMPRESSGZ=(<b>pigz</b> -c -f -n)
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pbzip2">pbzip2</a></span> é um <i>drop-in</i>, implementação paralela para <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bzip2">bzip2</a></span> que também usa todos os núcleos de CPU disponíveis por padrão. A opção <code>-p#</code> pode ser usado para empregar menos núcleos (note: nenhum espaço entre o <code>-p</code> e número de núcleos).
</p>
<pre>COMPRESSBZ2 =(<b>pbzip2</b> -c -f)
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=zstd">zstd</a></span> possui suporte a <a href="https://en.wikipedia.org/wiki/pt:Multiprocessamento_sim%C3%A9trico" class="extiw" title="wikipedia:pt:Multiprocessamento simétrico">multiprocessamento simétrico (SMP)</a> por meio do sinalizador <code>--threads</code> para acelerar compressão. Por exemplo, para deixar o makepkg usar o máximo possível de núcleos de CPU para comprimir pacotes, edite o vetor <code>COMPRESSZST</code> em <code>/etc/makepkg.conf</code>:
</p>
<pre>COMPRESSZST=(zstd -c -z -q - <b>--threads=0</b>)
</pre>
<h3>
<span id="Mostrar_pacotes_com_um_empacotador_espec.C3.ADfico"></span><span class="mw-headline" id="Mostrar_pacotes_com_um_empacotador_específico">Mostrar pacotes com um empacotador específico</span>
</h3>
<p>Isso mostra todos os pacotes instalados no sistema com o empacotador chamado <i>nome-empacotador</i>:
</p>
<pre>$ expac "%n %p" | grep "<i>nome-empacotador</i>" | column -t
</pre>
<p>Isso mostra todos os pacotes instalados no sistema com o empacotador definido na variável <code>PACKAGER</code> do <code>/etc/makepkg</code>. Isso mostra apenas pacotes que estão em um repositório definido em <code>/etc/pacman.conf</code>.
</p>
<pre>$ . /etc/makepkg.conf; grep -xvFf &lt;(pacman -Qqm) &lt;(expac "%n\t%p" | grep "$PACKAGER$" | cut -f1)
</pre>
<h3><span class="mw-headline" id="Compilar_pacotes_32_bits_em_um_sistema_64_bits">Compilar pacotes 32 bits em um sistema 64 bits</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> Erros foram relatados ao usar esse método par compilar o pacote <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span>.</div>
<p>Primeiro, habilite o repositório <a href="../pt/Official_repositories.html#multilib" class="mw-redirect" title="Multilib (Português)">multilib</a> e <a href="../pt/Help:Reading.html#Instala%C3%A7%C3%A3o_de_pacotes" class="mw-redirect" title="Instale">instale</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/groups/x86_64/multilib-devel/">multilib-devel</a></span>.
</p>
<p>Então, crie um arquivo de configuração 32 bits
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.makepkg.i686.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">CARCH="i686"
CHOST="i686-unknown-linux-gnu"
CFLAGS="-m32 -march=i686 -mtune=generic -O2 -pipe -fstack-protector-strong"
CXXFLAGS="${CFLAGS}"
LDFLAGS="-m32 -Wl,-O1,--sort-common,--as-needed,-z,relro"</pre>
<p>e chame o makepkg assim
</p>
<pre>$ linux32 makepkg --config ~/.makepkg.i686.conf
</pre>
<h2>
<span id="Solu.C3.A7.C3.A3o_de_problemas"></span><span class="mw-headline" id="Solução_de_problemas">Solução de problemas</span>
</h2>
<h3>
<span id="Especificando_diret.C3.B3rio_de_instala.C3.A7.C3.A3o_para_pacotes_baseados_em_QMAKE"></span><span class="mw-headline" id="Especificando_diretório_de_instalação_para_pacotes_baseados_em_QMAKE">Especificando diretório de instalação para pacotes baseados em QMAKE</span>
</h3>
<p>O makefile gerado pelo qmake usa a variável de ambiente <code>INSTALL_ROOT</code> para especificar onde o programa deve ser instalado. Então, essa função <i>package</i> deve funcionar:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">PKGBUILD</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...

package() {
	cd "$srcdir/${pkgname%-git}"
	make INSTALL_ROOT="$pkgdir" install
}

...
</pre>
<p>Note que o qmake também tem que ser configurado adequadamente. Por exemplo, coloque isso em seu arquivo <i>.pro</i>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">SeuProjeto.pro</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...

target.path = /usr/local/bin
INSTALLS += target

...
</pre>
<h3>
<span id="AVISO:_O_pacote_cont.C3.A9m_refer.C3.AAncia_para_.24srcdir"></span><span class="mw-headline" id="AVISO:_O_pacote_contém_referência_para_$srcdir">AVISO: O pacote contém referência para $srcdir</span>
</h3>
<p>De alguma forma, as strings literais <code>$srcdir</code> ou <code>$pkgdir</code> acabaram em um dos arquivos instalados no seu pacote.
</p>
<p>Para identificar quais arquivos, execute o seguinte do diretório de compilação makepkg:
</p>
<pre>$ grep -R "$PWD/src" pkg/
</pre>
<p>Uma causa possível seria pelo uso da macro <code>__FILE__</code> no código C/C++ com caminho completo passado para o compilador.
</p>
<h3>
<span id="Makepkg_falha_em_baixar_depend.C3.AAncias_quando_por_tr.C3.A1s_de_um_proxy"></span><span class="mw-headline" id="Makepkg_falha_em_baixar_dependências_quando_por_trás_de_um_proxy">Makepkg falha em baixar dependências quando por trás de um proxy</span>
</h3>
<p>Quando o <i>makepkg</i> chama dependências, ele chama o pacman para instalar os pacotes, o que requer privilégios administrativos via <i>sudo</i>. No entanto, o <i>sudo</i> não passa nenhuma <a href="../pt/Environment_variables.html" class="mw-redirect" title="Variável de ambiente">variável de ambiente</a> para o ambiente privilegiado, e inclui as variáveis relacionadas ao proxy <code>ftp_proxy</code>, <code>http_proxy</code>, <code>https_proxy</code> e <code>no_proxy</code>.
</p>
<p>Para que ter o <i>makepkg</i> funcionando por trás de um proxy, você tem que fazer um dos seguintes métodos.
</p>
<h4><span class="mw-headline" id="Habilitar_proxy_definindo_sua_URL_no_XferCommand">Habilitar proxy definindo sua URL no XferCommand</span></h4>
<p>O XferCommand pode ser definido para usar a URL de proxy desejada no <code>/etc/pacman.conf</code>. Adicione ou descomente a linha a seguir em seu <code>pacman.conf</code><a rel="nofollow" class="external autonumber" href="http://www.mail-archive.com/arch-general@archlinux.org/msg15561.html">[5]</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
XferCommand = /usr/bin/curl -x http://usuário:senha@proxy.proxyhost.com:80 -L -C - -f -o %o %u
...
</pre>
<h4><span class="mw-headline" id="Habilitar_proxy_via_env_keep_do_sudoers">Habilitar proxy via env_keep do sudoers</span></h4>
<p>Alternativamente, pode-se usar a opção <code>env_keep</code> do sudoers, a qual permite preservar as variáveis de ambiente dadas no ambiente privilegiado. Veja <a href="../pt/Sudo.html#Vari%C3%A1veis_de_ambiente" title="Sudo (Português)">sudo#Variáveis de ambiente</a> para mais informações.
</p>
<h3>
<span id="Makepkg_falha.2C_mas_make_obt.C3.A9m_sucesso"></span><span class="mw-headline" id="Makepkg_falha,_mas_make_obtém_sucesso">Makepkg falha, mas make obtém sucesso</span>
</h3>
<p>Se algo compilar manualmente usando <i>make</i>, mas falhar através do <i>makepkg</i>, é quase certo que seja porque o <code>/etc/makepkg.conf</code> define uma variável de compilação para algo razoável que normalmente funcione, mas que seja incompatível com o que você esteja compilando. Tente adicionar esses sinalizadores ao array <code>options</code> do PKGBUILD:
</p>
<p><code>!buildflags</code>, para evitar seu <code>CPPFLAGS</code>, <code>CFLAGS</code>, <code>CXXFLAGS</code> e <code>LDFLAGS</code> padrão.
</p>
<p><code>!makeflags</code>, para evitar seu <code>MAKEFLAGS</code> padrão, caso você tenha editado <code>/etc/makepkg.conf</code> para habilitar compilações paralelas.
</p>
<p><code>!debug</code>, para evitar seu <code>DEBUG_CFLAGS</code> e <code>DEBUG_CXXFLAGS</code> padrão, no caso de seu pacote ser uma compilação de depuração.
</p>
<p>Se qualquer um deles resolver o problema, isso pode indicar que você pode relatar um erro no envio de dados, se você isolar exatamente qual sinalizador está causando o problema.
</p>
<h2>
<span id="Veja_tamb.C3.A9m"></span><span class="mw-headline" id="Veja_também">Veja também</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://archlinux.org/pacman/makepkg.8.html">Página de manual makepkg(8)</a></li>
<li><a rel="nofollow" class="external text" href="https://archlinux.org/pacman/makepkg.conf.5.html">Página de manual makepkg.conf(5)</a></li>
<li><a rel="nofollow" class="external text" href="https://gist.github.com/Earnestly/bebad057f40a662b5cc3">Um breve passeio no processo do makepkg</a></li>
<li><a rel="nofollow" class="external text" href="https://projects.archlinux.org/pacman.git/tree/scripts/makepkg.sh.in">Código fonte do makepkg</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../pt/Category:Package_development.html" title="Category:Package development (Português)">Package development (Português)</a></li>
<li><a href="../pt/Category:About_Arch.html" title="Category:About Arch (Português)">About Arch (Português)</a></li>
<li><a href="../pt/Category:Commands.html" title="Category:Commands (Português)">Commands (Português)</a></li>
</ul>
</div></div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Makepkg_(Portugu%C3%AAs)&amp;oldid=646911">https://wiki.archlinux.org/index.php?title=Makepkg_(Português)&amp;oldid=646911</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 26 December 2020, at 12:13.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
