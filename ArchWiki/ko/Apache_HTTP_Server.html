<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Apache HTTP Server (한국어) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Apache_HTTP_Server_한국어 rootpage-Apache_HTTP_Server_한국어 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Apache HTTP Server (한국어)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../en/PHP.html" title="PHP">PHP</a></li>
<li><a href="../en/MySQL.html" title="MySQL">MySQL</a></li>
<li><a href="../en/PhpMyAdmin.html" title="PhpMyAdmin">PhpMyAdmin</a></li>
<li><a href="../en/Adminer.html" title="Adminer">Adminer</a></li>
<li><a href="../en/XAMPP.html" title="XAMPP">XAMPP</a></li>
<li><a href="../en/Apache_HTTP_Server/mod_perl.html" class="mw-redirect" title="Mod perl">mod_perl</a></li>
</ul>
</div>
<p><a href="https://en.wikipedia.org/wiki/Apache_HTTP_Server" class="extiw" title="wikipedia:Apache HTTP Server">Apache HTTP Server</a>(생략해서 Apache라고도 한다)는 아파치 소프트웨어 재단에서 개발된 유명한 웹 서버이다.
</p>
<p>아파치는 보통 MySQL 같은 데이터베이스와 PHP 등의 스크립트 언어와 함께 사용된다. 이러ᅟ한 아파치와의 연동을 흔히 <a href="https://en.wikipedia.org/wiki/LAMP_(software_bundle)" class="extiw" title="wikipedia:LAMP (software bundle)">LAMP</a> stack (<b>L</b>inux, <b>A</b>pache, <b>M</b>ySQL, <b>P</b>HP)이라고 불린다. 이 문서에서는 아파치 서버 구축 방법과 <a href="../en/PHP.html" title="PHP">PHP</a>, <a href="../en/MySQL.html" title="MySQL">MySQL</a> 연동 방법에 대해서 설명한다.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%EC%84%A4%EC%B9%98"><span class="tocnumber">1</span> <span class="toctext">설치</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#%EC%84%A4%EC%A0%95"><span class="tocnumber">2</span> <span class="toctext">설정</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#%EA%B3%A0%EA%B8%89_%EC%98%B5%EC%85%98"><span class="tocnumber">2.1</span> <span class="toctext">고급 옵션</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#%EC%82%AC%EC%9A%A9%EC%9E%90_%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC"><span class="tocnumber">2.2</span> <span class="toctext">사용자 디렉토리</span></a></li>
<li class="toclevel-2 tocsection-5">
<a href="#TLS/SSL"><span class="tocnumber">2.3</span> <span class="toctext">TLS/SSL</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#%ED%82%A4_%EC%83%9D%EC%84%B1%EA%B3%BC_%EC%9E%90%EC%B2%B4_%EC%84%9C%EB%AA%85_%EC%9D%B8%EC%A6%9D_%EB%B0%A9%EB%B2%95"><span class="tocnumber">2.3.1</span> <span class="toctext">키 생성과 자체 서명 인증 방법</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-7">
<a href="#%EA%B0%80%EC%83%81_%ED%98%B8%EC%8A%A4%ED%8A%B8"><span class="tocnumber">2.4</span> <span class="toctext">가상 호스트</span></a>
<ul>
<li class="toclevel-3 tocsection-8"><a href="#%EA%B0%80%EC%83%81_%ED%98%B8%EC%8A%A4%ED%8A%B8_%EA%B4%80%EB%A6%AC"><span class="tocnumber">2.4.1</span> <span class="toctext">가상 호스트 관리</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-9">
<a href="#%ED%99%95%EC%9E%A5_%EB%AA%A8%EB%93%88(Extensions)"><span class="tocnumber">3</span> <span class="toctext">확장 모듈(Extensions)</span></a>
<ul>
<li class="toclevel-2 tocsection-10">
<a href="#PHP"><span class="tocnumber">3.1</span> <span class="toctext">PHP</span></a>
<ul>
<li class="toclevel-3 tocsection-11"><a href="#php-fpm,_mod_proxy_fcgi_%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0"><span class="tocnumber">3.1.1</span> <span class="toctext">php-fpm, mod_proxy_fcgi 사용하기</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#apache2-mpm-worker,_mod_fcgid_%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0"><span class="tocnumber">3.1.2</span> <span class="toctext">apache2-mpm-worker, mod_fcgid 사용하기</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#MySQL/MariaDB"><span class="tocnumber">3.1.3</span> <span class="toctext">MySQL/MariaDB</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-14"><a href="#HTTP2"><span class="tocnumber">3.2</span> <span class="toctext">HTTP2</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15">
<a href="#%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0"><span class="tocnumber">4</span> <span class="toctext">문제 해결</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="#%EC%95%84%ED%8C%8C%EC%B9%98_%EC%84%9C%EB%B2%84_%EC%83%81%ED%83%9C%EC%99%80_%EB%A1%9C%EA%B7%B8"><span class="tocnumber">4.1</span> <span class="toctext">아파치 서버 상태와 로그</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#Error:_PID_file_/run/httpd/httpd.pid_not_readable_(yet?)_after_start"><span class="tocnumber">4.2</span> <span class="toctext">Error: PID file /run/httpd/httpd.pid not readable (yet?) after start</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#Apache_is_running_a_threaded_MPM,_but_your_PHP_Module_is_not_compiled_to_be_threadsafe."><span class="tocnumber">4.3</span> <span class="toctext">Apache is running a threaded MPM, but your PHP Module is not compiled to be threadsafe.</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#AH00534:_httpd:_Configuration_error:_No_MPM_loaded."><span class="tocnumber">4.4</span> <span class="toctext">AH00534: httpd: Configuration error: No MPM loaded.</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#Changing_the_max_execution_time_in_php.ini_has_no_effect"><span class="tocnumber">4.5</span> <span class="toctext">Changing the max_execution_time in php.ini has no effect</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-21"><a href="#%EC%B0%B8%EC%A1%B0"><span class="tocnumber">5</span> <span class="toctext">참조</span></a></li>
</ul>
</div>

<h2>
<span id=".EC.84.A4.EC.B9.98"></span><span class="mw-headline" id="설치">설치</span>
</h2>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=apache">apache</a></span> 패키지를 설치(<a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a>)한다.
</p>
<h2>
<span id=".EC.84.A4.EC.A0.95"></span><span class="mw-headline" id="설정">설정</span>
</h2>
<p>아파치 설정 파일들은 <code>/etc/httpd/conf</code>에 위치한다. 주(主) 파일은 <code>/etc/httpd/conf/httpd.conf</code>로서 다른 설정파일들을 포함한다. 
기본 설정파일은 아파치 설치 과정에서 자동으로 생성되며 정상적으로 동작하는 설정 파일이다. 기본 설정파일은 <code>/srv/http</code> 디렉토리를 서버의 웹페이지에 접속한 사용자에게 제공한다.
</p>
<p>아파치 서버 서비스를 시작하기 위해서는 <a href="../en/Systemd.html#Using_units" title="Systemd">systemd</a>를 이용하여 <code>httpd.service</code>를 시작한다.
</p>
<p>서비스 시작 후에는 아파치 서버가 정상적으로 동작하고 있을 것이다. 서버의 동작여부를 확인하기 위해서는 웹 브라우저에서 <a rel="nofollow" class="external free" href="http://localhost/%EB%A1%9C">http://localhost/로</a> 접속한다. 접속하면 간단한 인덱스 페이지가 출력될 것이다.
</p>
<p>아파치 설정에 관련된 자세한 정보는 이어지는 절을 참고한다.
</p>
<h3>
<span id=".EA.B3.A0.EA.B8.89_.EC.98.B5.EC.85.98"></span><span class="mw-headline" id="고급_옵션">고급 옵션</span>
</h3>
<p>아래에 열거된 옵션들은 <code>/etc/httpd/conf/httpd.conf</code> 파일 내에 정의되어 있는 것으로서, 서버를 구축하고자 하는 사용자에게 유용한 옵션들이다.
</p>
<pre>User http
</pre>
<dl><dd>아파치는 보안 문제 때문에 root 관리자에 의해 시작된 뒤 곧바로 http UID로 전환된다. 설정파일에 기본으로 등록되는 사용자는 http이며 해당 사용자는 아파치 설치 과정에서 자동으로 생성된다.</dd></dl>
<pre>Listen 80
</pre>
<dl><dd>아파치 서버에서 열어 놓을 포트를 설정한다. 라우터를 이용한 인터넷 접근을 위해서는 반드시 포트포워딩을 설정해주어야 한다.</dd></dl>
<dl><dd>만일 아파치 서버를 로컬에서만 접속이 허용되도록 설정하고 싶다면, 해당 줄 내용을 <code>Listen 127.0.0.1:80</code>으로 변경한다.</dd></dl>
<pre>ServerAdmin you@example.com
</pre>
<dl><dd>관리자의 이메일 주소를 설정한다. 설정된 이메일 주소는 에러 페이지에서 관리자 메일로 표시된다.</dd></dl>
<pre>DocumentRoot "/srv/http"
</pre>
<dl><dd>호스팅할 웹 페이지들이 위치하는 디렉토리 위치</dd></dl>
<dl><dd>DocumentRoot를 변경하면 <code>&lt;Directory "/srv/http"&gt;</code>도 변경해야한다. 그렇지 않으면 변경된 DocumentRoot에 접근할 때 <b>403 에러</b>(권한 부족 에러)가 발생한다. 또한, <code>Require all denied</code> 부분을 <code>Require all granted</code>으로 변경해야 한다. 해당 라인을 바꾸지 않는 경우에도 <b>403 에러</b>가 발생할 수 있다. 언급한 두 가지 경우 외에, DocumentRoot 디텍토리와 그 부모 디렉토리의 권한 문제가 있는 경우에도 <b>403 에러</b>가 발생될 수 있다.</dd></dl>
<p>두 개의 디렉토리(DocumentRoot, DocumentRoot의 부모 디렉토리)는 반드시 다른 사용자들에게도 실행권한이 부여되어야 한다. (<code>chmod o+x /path/to/DocumentRoot</code>를 통해 설정할 수 있다)
</p>
<p>위에서 언급된 권한관련 해결방법에는 몇 가지 논란이 있다. 반드시 모든 사용자들에게 실행 권한을 줄 필요가 없고 ACL을 통해 웹서버에만 실행 권한을 줄 수 있는 방법이 있기 때문이다. 자세한 내용은 다음 링크를 살펴보자. <a href="../en/Access_Control_Lists.html#Granting_execution_permissions_for_private_files_to_a_web_server" title="Access Control Lists">Access Control Lists#Granting execution permissions for private files to a web server</a>, <a href="../en/Talk:Apache_HTTP_Server.html" title="Talk:Apache HTTP Server">Talk:Apache HTTP Server</a>
</p>
<pre>AllowOverride None
</pre>
<dl><dd>
<code>&lt;Directory&gt;</code> 섹션 안의 위 디렉티브는 아파치가 <code>.htaccess</code> 파일을 완전하게 무시하도록 설정해준다. 하지만 아피치 2.4버전 이후부터 해당 옵션은 기본으로 되어있기 때문에 <code>.htaccess</code> 파일을 사용하고 싶다면 명시적으로 허용해주어야 한다. <code>.htaccess</code>에서 <code>mod_rewrite</code> 혹은 다른 설정들을 사용하고 싶다면 .htaccess파일에 관련 디렉티브를 선언함으로써 서버 설정을 오버라이딩 해야 한다. 이에 관련된 자세한 내용은 다음 링크를 참고한다. <a rel="nofollow" class="external text" href="http://httpd.apache.org/docs/current/mod/core.html#allowoverride">Apache documentation</a>.</dd></dl>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 만약 아파치 설정파일과 관련된 이슈가 있다면 다음 명령어를 통해 설정파일을 점검할 수 있다: <code>apachectl configtest</code>
</div>
<p>더 많은 설정 옵션들은 다음 파일에서 확인할 수 있다: <code>/etc/httpd/conf/extra/httpd-default.conf</code>:
</p>
<p>서버 서명을 비활성화하려면 다음 라인을 추가한다:
</p>
<pre>ServerSignature Off
</pre>
<p>아파치와 PHP 버전과 같은 서버 정보를 숨기려면 다음 라인을 추가한다:
</p>
<pre>ServerTokens Prod
</pre>
<h3>
<span id=".EC.82.AC.EC.9A.A9.EC.9E.90_.EB.94.94.EB.A0.89.ED.86.A0.EB.A6.AC"></span><span class="mw-headline" id="사용자_디렉토리">사용자 디렉토리</span>
</h3>
<p>사용자 디렉토리는 기본적으로 <a rel="nofollow" class="external free" href="http://localhost/~yourusername/%EB%A5%BC">http://localhost/~yourusername/를</a> 통해서 접근 가능하며, <code>~/public_html</code>의 내용을 표시한다. (<code>/etc/httpd/conf/extra/httpd-userdir.conf</code>에서 변경이 가능하다).
</p>
<p>만일 유저 디렉토리를 원하지 않는 경우에는 <code>/etc/httpd/conf/httpd.conf</code> 파일에서 다음 라인을 주석처리한다:
</p>
<pre>Include conf/extra/httpd-userdir.conf
</pre>
<p>아파치가 사용자의 홈디렉토리에 접근하기 위해서는 반드시 디렉토리의 권한을 적절하게 설정해 주어야 한다. 홈 디렉토리와 <code>~/public_html</code>은 반드시 다른 사용자들이 실행권한을 갖고 있어야 한다. (혹은 ACL을 통해 아파치 사용자 http에 한해서만 허용하도록 한다.)
</p>
<pre>$ chmod o+x ~
$ chmod o+x ~/public_html
$ chmod -R o+r ~/public_html
</pre>
<p>권한 설정이 완료되면 <code>httpd.service</code>를 재시작한다. <a href="../en/Umask.html#Set_the_mask_value" title="Umask">Umask#Set the mask value</a> 참고.
</p>
<h3>
<span id="TLS.2FSSL"></span><span class="mw-headline" id="TLS/SSL">TLS/SSL</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> SSL/TLS 구현하고자 한다면 몇몇 변수들과 구현부분에서  <a rel="nofollow" class="external text" href="https://weakdh.org/#affected">여전히</a> <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security#Attacks_against_TLS.2FSSL" class="extiw" title="wikipedia:Transport Layer Security">공격에 취약</a>하다는 것을 알고 있어야 한다. 현재 SSL/TLS에서의 취약점과 웹 서버에 어떻게 반영시켜야 하는지 알고 싶다면 <a rel="nofollow" class="external free" href="http://disablessl3.com/%EC%99%80">http://disablessl3.com/와</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-12-19 ⓘ]</sup> <a rel="nofollow" class="external free" href="https://weakdh.org/sysadmin.html">https://weakdh.org/sysadmin.html</a> 사이트를 방문하면 더 자세한 정보를 얻을 수 있다.</div>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssl">openssl</a></span>는 TLS/SSL을 지원하고 아치에서 기본으로 설치된다.
</p>
<p><code>/etc/httpd/conf/httpd.conf</code>파일에서 다음 세 개의 라인의 주석처리를 해제한다:
</p>
<pre>LoadModule ssl_module modules/mod_ssl.so
LoadModule socache_shmcb_module modules/mod_socache_shmcb.so
Include conf/extra/httpd-ssl.conf
</pre>
<p>TLS/SSL를 위해서는 키와 인증이 필요하다. 만약 공공 도메인을 가지고 있다면 무료로 인증을 받기 위해 <a href="../en/Certbot.html" class="mw-redirect" title="Let's Encrypt">Let's Encrypt</a>를 사용할 수 있다. 공공 도메인을 가지고 있지 않다면 <a href="#%ED%82%A4_%EC%83%9D%EC%84%B1%EA%B3%BC_%EC%9E%90%EC%B2%B4_%EC%84%9C%EB%AA%85_%EC%9D%B8%EC%A6%9D_%EB%B0%A9%EB%B2%95">#키 생성과 자체 서명 인증 방법</a>방법을 참고한다.
</p>
<p>키와 인증을 얻고 나서는 <code>/etc/httpd/conf/extra/httpd-ssl.conf</code> 파일 내의 <code>SSLCertificateFile</code>, <code>SSLCertificateKeyFile</code> 라인에서 해당 키와 인증을 가리키도록 설정한다.
</p>
<p>마지막으로 변경 사항 적용을 위해 <code>httpd.service</code> 를 재시작한다.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Mozilla has a useful <a rel="nofollow" class="external text" href="https://wiki.mozilla.org/Security/Server_Side_TLS">SSL/TLS article</a> which includes <a rel="nofollow" class="external text" href="https://wiki.mozilla.org/Security/Server_Side_TLS#Apache">Apache specific</a> configuration guidelines as well as an <a rel="nofollow" class="external text" href="https://mozilla.github.io/server-side-tls/ssl-config-generator/">automated tool</a> to help create a more secure configuration.</div>
<h4>
<span id=".ED.82.A4_.EC.83.9D.EC.84.B1.EA.B3.BC_.EC.9E.90.EC.B2.B4_.EC.84.9C.EB.AA.85_.EC.9D.B8.EC.A6.9D_.EB.B0.A9.EB.B2.95"></span><span class="mw-headline" id="키_생성과_자체_서명_인증_방법">키 생성과 자체 서명 인증 방법</span>
</h4>
<p>개인키와 자체 서명 인증을 생성한다. 이것은 <a href="https://en.wikipedia.org/wiki/Certificate_signing_request" class="extiw" title="wikipedia:Certificate signing request">CSR</a>가 요구되지 않는 대부분의 설치로는 적절하다.
</p>
<pre># cd /etc/httpd/conf
# openssl req -new -x509 -nodes -newkey rsa:4096 -keyout server.key -out server.crt -days 1095
# chmod 400 server.key
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> -days 스위치는 옵션이며 RSA 키 크기는 최소 2048(기본값) 이상이어야 한다.</div>
<p>만약 <a href="https://en.wikipedia.org/wiki/Certificate_signing_request" class="extiw" title="wikipedia:Certificate signing request">CSR</a>의 생성이 필요하다면, 위의 방법 대신 아래의 키 생성 방법을 따르도록 한다.
</p>
<pre># openssl genpkey -algorithm RSA -pkeyopt rsa_keygen_bits:4096 -out server.key
# chmod 400 server.key
# openssl req -new -sha256 -key server.key -out server.csr
# openssl x509 -req -days 1095 -in server.csr -signkey server.key -out server.crt
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 더 많은 openssl 옵션을 보려면 <a rel="nofollow" class="external text" href="https://www.openssl.org/docs/apps/openssl.html">man page</a> 또는 peruse openssl의 <a rel="nofollow" class="external text" href="https://www.openssl.org/docs/">extensive documentation</a>를 참고한다.</div>
<h3>
<span id=".EA.B0.80.EC.83.81_.ED.98.B8.EC.8A.A4.ED.8A.B8"></span><span class="mw-headline" id="가상_호스트">가상 호스트</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> SSL 가상 호스트를 사용하기 위해서는 독립적인 &lt;VirtualHost dommainame:443&gt; 섹션을 추가해야한다. 관련된 예제는 다음 링크를 참고한다: <a href="#Managing_many_virtual_hosts">#Managing many virtual hosts</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup>
</div>
<p>한 개 이상의 호스트를 원하는 경우에 <code>/etc/httpd/conf/httpd.conf</code> 설정 파일에서 아래 기술된 부분의 주석을 해제한다.
</p>
<pre>Include conf/extra/httpd-vhosts.conf
</pre>
<p>또한, <code>/etc/httpd/conf/extra/httpd-vhosts.conf</code> 파일에서 가상 호스트를 설정할 수 있다. 제공되는 기본 설정파일에는 자세한 예제가 많기 때문에 호스트 설정을 위해 참고하기에 유용하다.
</p>
<p>로컬 머신에서 가상 호스트를 테스트하고 싶다면, <code>/etc/hosts</code> 파일에 가상 도메인명을 다음과 같이 등록한다:
</p>
<pre>127.0.0.1 domainname1.dom 
127.0.0.1 domainname2.dom
</pre>
<p>파일 변경 후, 설정 적용을 위해 <code>httpd.service</code>를 재시작한다.
</p>
<h4>
<span id=".EA.B0.80.EC.83.81_.ED.98.B8.EC.8A.A4.ED.8A.B8_.EA.B4.80.EB.A6.AC"></span><span class="mw-headline" id="가상_호스트_관리">가상 호스트 관리</span>
</h4>
<p>이 절에서는 엄청나게 많은 가상 호스트를 가지고 있는 경우에 가상 호스트들을 관리하는 방법에 대하여 기술한다. 이러한 경우에는 가상 호스트별로 설정 파일을 만들고 이를 하나의 디렉토리(예: <code>/etc/httpd/conf/vhosts</code>)에 저장하는 것을 권장한다. 
</p>
<p>먼저 디렉토리를 하나 생성한다:
</p>
<pre># mkdir /etc/httpd/conf/vhosts
</pre>
<p>각 가상 호스트별 설정 파일을 생성한 디렉토리 안에 생성한다:
</p>
<pre># nano /etc/httpd/conf/vhosts/domainname1.dom
# nano /etc/httpd/conf/vhosts/domainname2.dom
...
</pre>
<p>마지막으로 아파치 메인 설정파일인 <code>/etc/httpd/conf/httpd.conf</code> 안에 <code>Include</code>를 사용하서 가상 호스트별로 생성해둔 설정 파일들을 포함시킨다:
</p>
<pre>#Enabled Vhosts:
Include conf/vhosts/domainname1.dom
Include conf/vhosts/domainname2.dom
</pre>
<p>위처럼 각각의 가상 호스트를 주석처리를 통해 간단하게 활성화/비활성화할 수 있다.
</p>
<p>다음은 각 가상 호스트별 파일의 예제이다:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/httpd/conf/vhosts/domainname1.dom</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;VirtualHost domainname1.dom:80&gt;
    ServerAdmin webmaster@domainname1.dom
    DocumentRoot "/home/user/http/domainname1.dom"
    ServerName domainname1.dom
    ServerAlias domainname1.dom
    ErrorLog "/var/log/httpd/domainname1.dom-error_log"
    CustomLog "/var/log/httpd/domainname1.dom-access_log" common

    &lt;Directory "/home/user/http/domainname1.dom"&gt;
        Require all granted
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;

&lt;VirtualHost domainname1.dom:443&gt;
    ServerAdmin webmaster@domainname1.dom
    DocumentRoot "/home/user/http/domainname1.dom"
    ServerName domainname1.dom:443
    ServerAlias domainname1.dom:443
    ErrorLog "/var/log/httpd/domainname1.dom-error_log"
    CustomLog "/var/log/httpd/domainname1.dom-access_log" common

    &lt;Directory "/home/user/http/domainname1.dom"&gt;
        Require all granted
    &lt;/Directory&gt;
    
    SSLEngine on
    SSLCertificateFile "/etc/httpd/conf/apache.crt"
    SSLCertificateKeyFile "/etc/httpd/conf/apache.key"
&lt;/VirtualHost&gt;</pre>
<h2>
<span id=".ED.99.95.EC.9E.A5_.EB.AA.A8.EB.93.88.28Extensions.29"></span><span class="mw-headline" id="확장_모듈(Extensions)">확장 모듈(Extensions)</span>
</h2>
<h3><span class="mw-headline" id="PHP">PHP</span></h3>
<p><a href="../en/PHP.html" title="PHP">PHP</a> 설치를 위해서는 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php">php</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-apache">php-apache</a></span> 패키지를 설치한다.
</p>
<p><code>/etc/httpd/conf/httpd.conf</code> 파일에서 아래의 줄을 주석처리 한다:
</p>
<pre>#LoadModule mpm_event_module modules/mod_mpm_event.so
</pre>
<p>그리고 아래의 줄의 주석을 해제한다:
</p>
<pre>LoadModule mpm_prefork_module modules/mod_mpm_prefork.so
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-apache">php-apache</a></span>에 포함된 <code>libphp7.so</code>이 <code>mod_mpm_event</code>와는 제대로 동작하지 않고 <code>mod_mpm_prefork</code>에서만 정상적으로 동작하기 때문에 위에서 기술된 것처럼 설정해주어야 한다.(참고: <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/39218">FS#39218</a>)
<p>위의 처리를 해주지 않는 경우 다음과 같은 에러 메세지가 출력된다:
</p>
<pre>Apache is running a threaded MPM, but your PHP Module is not compiled to be threadsafe.  You need to recompile PHP.
AH00013: Pre-configuration failed
httpd.service: control process exited, code=exited status=1</pre>
또 다른 해결 방법으로, <code>mod_proxy_fcgi</code>를 사용하는 방법이 있다. 자세한 방법은 이하 절의 <a href="#Using_php-fpm_and_mod_proxy_fcgi">#Using php-fpm and mod_proxy_fcgi</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup>를 참고한다.</div>
<p>PHP를 활성화하기 위해서 <code>/etc/httpd/conf/httpd.conf</code> 파일에 아래 코드를 추가해준다:
</p>
<ul><li>
<code>LoadModule</code> 리스트에서, <code>LoadModule dir_module modules/mod_dir.so</code> 다음의 원하는 곳에 아래 코드를 추가한다:</li></ul>
<pre>LoadModule php7_module modules/libphp7.so
</pre>
<ul><li>
<code>Include</code> 리스트 마지막 부분에 다음을 추가한다:</li></ul>
<pre>Include conf/extra/php7_module.conf
</pre>
<p>설정을 완료한 후, <a href="../en/Systemd.html#Using_units" title="Systemd">systemd를 사용하여</a> <code>httpd.service</code>를 재시작한다. 
</p>
<p>PHP가 올바르게 설정되었는지 확인하려면 아파치 <code>DocumentRoot</code> 디렉토리(예. <code>/srv/http/</code> 혹은 <code>~/public_html</code>)에 <code>test.php</code> 파일을 생성하여 다음 코드를 해당 파일에 추가한다:
</p>
<pre>&lt;?php phpinfo(); ?&gt;
</pre>
<p>파일을 저장한 뒤, PHP가 제대로 작동하는지 확인하기 위하여 브라우저를 통해 다음 URL을 연다: <a rel="nofollow" class="external free" href="http://localhost/test.php">http://localhost/test.php</a> 또는 <a rel="nofollow" class="external free" href="http://localhost/~myname/test.php">http://localhost/~myname/test.php</a>
</p>
<p>더 많은 설정 옵션과 확장 모듈(extensions)에 대한 정보는 <a href="../en/PHP.html" title="PHP">PHP</a>를 참고한다.
</p>
<h4>
<span id="php-fpm.2C_mod_proxy_fcgi_.EC.82.AC.EC.9A.A9.ED.95.98.EA.B8.B0"></span><span class="mw-headline" id="php-fpm,_mod_proxy_fcgi_사용하기">php-fpm, mod_proxy_fcgi 사용하기</span>
</h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 널리 알려진 ProxyPass를 이용한 설정과 다르게 SetHandler를 이용한 프록시 설정은 DirectoryIndex와 같이 아파치에서 사용되는 디렉티브를 방해하지 않는다. 이러한 특징ᅟ 덕분에 libphp7, mod_fastcgi, mod_fcgid 등으로 디자인된 소프트웨어와 더 나은 호환성을 보장한다. 하지만 그래도 ProxyPass를 계속해서 사용하고 싶다면, 아래 코드와 같이 시도하여 사용할 수 있다:
<pre>ProxyPassMatch ^/(.*\.php(/.*)?)$ unix:/run/php-fpm/php-fpm.sock|fcgi://localhost/srv/http/$1</pre>
</div>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-fpm">php-fpm</a></span> 패키지를 설치한다.
</p>
<p>아래의 내용으로 <code>/etc/httpd/conf/extra/php-fpm.conf</code> 파일을 생성한다:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/httpd/conf/extra/php-fpm.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;FilesMatch \.php$&gt;
    SetHandler "proxy:unix:/run/php-fpm/php-fpm.sock|fcgi://localhost/"
&lt;/FilesMatch&gt;
&lt;Proxy "fcgi://localhost/" enablereuse=on max=10&gt;
&lt;/Proxy&gt;
&lt;IfModule dir_module&gt;
    DirectoryIndex index.php index.html
&lt;/IfModule&gt;
</pre>
<p>그리고 나서 <code>/etc/httpd/conf/httpd.conf</code> 파일의 최하단에 include 코드를 추가한다:
</p>
<pre>Include conf/extra/php-fpm.conf
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 위 코드에서 <code>sock</code>과 <code>fcgi</code> 사이의 파이프 좌우로 빈칸은 허용되지 않는 점에 유의해야 한다. <code>localhost</code>는 다른 문자열로 치환될 수 있으며, 치환된 문자열은 반드시 <code>SetHandler</code>와 <code>Proxy</code> 디렉티브에서도 일치해야 한다. 더 자세한 정보는 <a rel="nofollow" class="external text" href="https://httpd.apache.org/docs/2.4/mod/mod_proxy_fcgi.html">이곳</a>에서 확인할 수 있다. <code>SetHandler</code>와 <code>Proxy</code>는 가상 호스트 설정 파일별로 사용가능하지만 <code>fcgi://</code> 이후의 이름은 반드시 가상 호스트들끼리 서로 달라야 한다.</div>
<p><code>/etc/php/php-fpm.d/www.conf</code>에서 PHP-FPM을 설정할 수 있지만 기본 설정으로도 정상적으로 동작한다.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<p>아래 코드는 더이상 필요하지 않기 때문에 만약 <code>httpd.conf</code> 파일에 추가했다면 삭제하도록 한다.
</p>
<pre>LoadModule php7_module modules/libphp7.so
Include conf/extra/php7_module.conf
</pre>
</div>
<p><code>httpd.service</code>와 <code>php-fpm.service</code>를 재시작한다.
</p>
<h4>
<span id="apache2-mpm-worker.2C_mod_fcgid_.EC.82.AC.EC.9A.A9.ED.95.98.EA.B8.B0"></span><span class="mw-headline" id="apache2-mpm-worker,_mod_fcgid_사용하기">apache2-mpm-worker, mod_fcgid 사용하기</span>
</h4>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mod_fcgid">mod_fcgid</a></span>와 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-cgi">php-cgi</a></span> 패키지를 설치한다.
</p>
<p>PHP wrapper를 위해 필요한 디렉토리와 심볼릭 링크를 만들어준다:
</p>
<pre># mkdir /srv/http/fcgid-bin
# ln -s /usr/bin/php-cgi /srv/http/fcgid-bin/php-fcgid-wrapper
</pre>
<p>다음 내용으로 <code>/etc/httpd/conf/extra/php-fcgid.conf</code> 파일을 생성한다:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/httpd/conf/extra/php-fcgid.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Required modules: fcgid_module

&lt;IfModule fcgid_module&gt;
    AddHandler php-fcgid .php
    AddType application/x-httpd-php .php
    Action php-fcgid /fcgid-bin/php-fcgid-wrapper
    ScriptAlias /fcgid-bin/ /srv/http/fcgid-bin/
    SocketPath /var/run/httpd/fcgidsock
    SharememPath /var/run/httpd/fcgid_shm
        # If you don't allow bigger requests many applications may fail (such as WordPress login)
        FcgidMaxRequestLen 536870912
        # Path to php.ini – defaults to /etc/phpX/cgi
        DefaultInitEnv PHPRC=/etc/php/
        # Number of PHP childs that will be launched. Leave undefined to let PHP decide.
        #DefaultInitEnv PHP_FCGI_CHILDREN 3
        # Maximum requests before a process is stopped and a new one is launched
        #DefaultInitEnv PHP_FCGI_MAX_REQUESTS 5000
        &lt;Location /fcgid-bin/&gt;
        SetHandler fcgid-script
        Options +ExecCGI
    &lt;/Location&gt;
&lt;/IfModule&gt;
</pre>
<p><code>/etc/httpd/conf/httpd.conf</code> 파일을 편집하여 actions 모듈을 활성화한다:
</p>
<pre>LoadModule actions_module modules/mod_actions.so
</pre>
<p>다음을 추가해준다.
</p>
<pre>LoadModule fcgid_module modules/mod_fcgid.so
Include conf/extra/httpd-mpm.conf
Include conf/extra/php-fcgid.conf
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<p>아래 코드는 더이상 필요하지 않기 때문에 만약 <code>httpd.conf</code> 파일에 추가했다면 삭제하도록 한다.
</p>
<pre>LoadModule php7_module modules/libphp7.so
Include conf/extra/php7_module.conf
</pre>
</div>
<p><code>httpd.service</code>을 재시작한다.
</p>
<h4>
<span id="MySQL.2FMariaDB"></span><span class="mw-headline" id="MySQL/MariaDB">MySQL/MariaDB</span>
</h4>
<p><a href="../en/PHP.html#MySQL/MariaDB" title="PHP">PHP#MySQL/MariaDB</a> 위키페이지의 설명서를 따른다.
</p>
<p>설정이 완료되면 <code>httpd.service</code>를 재시작한다.
</p>
<h3><span class="mw-headline" id="HTTP2">HTTP2</span></h3>
<p>HTTP/2 지원을 위해서는 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nghttp2">nghttp2</a></span> 패키지를 설치해야 한다.
</p>
<p>설치 후에 <code>httpd.conf</code> 파일에서 다음 줄의 주석을 해제한다:
</p>
<pre>LoadModule http2_module modules/mod_http2.so
</pre>
<p>다음 줄을 추가한다:
</p>
<pre>Protocols h2 http/1.1
</pre>
<p>더 자세한 내용은 <a rel="nofollow" class="external text" href="https://httpd.apache.org/docs/2.4/mod/mod_http2.html">mod_http2</a> 문서를 참고한다.
</p>
<h2>
<span id=".EB.AC.B8.EC.A0.9C_.ED.95.B4.EA.B2.B0"></span><span class="mw-headline" id="문제_해결">문제 해결</span>
</h2>
<h3>
<span id=".EC.95.84.ED.8C.8C.EC.B9.98_.EC.84.9C.EB.B2.84_.EC.83.81.ED.83.9C.EC.99.80_.EB.A1.9C.EA.B7.B8"></span><span class="mw-headline" id="아파치_서버_상태와_로그">아파치 서버 상태와 로그</span>
</h3>
<p><a href="../en/Systemd.html#Basic_systemctl_usage" class="mw-redirect" title="Systemctl">systemctl</a>를 통해 아파치 데몬의 현재 상태를 확인할 수 있다.
</p>
<p>아파치 로그파일은 <code>/var/log/httpd/</code>에서 찾을 수 있다.
</p>
<h3>
<span id="Error:_PID_file_.2Frun.2Fhttpd.2Fhttpd.pid_not_readable_.28yet.3F.29_after_start"></span><span class="mw-headline" id="Error:_PID_file_/run/httpd/httpd.pid_not_readable_(yet?)_after_start">Error: PID file /run/httpd/httpd.pid not readable (yet?) after start</span>
</h3>
<p><code>httpd.conf</code>파일에서 <code>unique_id_module</code> 부분을 주석처리한다: <code>#LoadModule unique_id_module modules/mod_unique_id.so</code>
</p>
<h3>
<span id="Apache_is_running_a_threaded_MPM.2C_but_your_PHP_Module_is_not_compiled_to_be_threadsafe."></span><span class="mw-headline" id="Apache_is_running_a_threaded_MPM,_but_your_PHP_Module_is_not_compiled_to_be_threadsafe.">Apache is running a threaded MPM, but your PHP Module is not compiled to be threadsafe.</span>
</h3>
<p><code>httpd.service</code>가 <code>php7_module</code>을 로딩할 때 다음과 같은 에러메세지가 출력되는 경우:
</p>
<pre>Apache is running a threaded MPM, but your PHP Module is not compiled to be threadsafe.  You need to recompile PHP.
</pre>
<p>설정파일에서 다음과 같이 <code>mpm_event_module</code>를 <code>mpm_prefork_module</code>로 바꿔준다:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/httpd/conf/httpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"><s>LoadModule mpm_event_module modules/mod_mpm_event.so</s>
LoadModule mpm_prefork_module modules/mod_mpm_prefork.so
</pre>
<p>그리고나서, <code>httpd.service</code>를 재시작한다.
</p>
<h3><span class="mw-headline" id="AH00534:_httpd:_Configuration_error:_No_MPM_loaded.">AH00534: httpd: Configuration error: No MPM loaded.</span></h3>
<p>아파치를 최신 버전으로 업그레이드하면서 나타나는 문제다. 이는 최신 아파치 설정 부분에서 변경된 부분이 이전의 설정파일에 반영되지 않았기 때문에 생기는 문제로서 다음 부분의 주석을 해제해주면 해결이 가능하다.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/httpd/conf/httpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">LoadModule mpm_prefork_module modules/mod_mpm_prefork.so
</pre>
<p>이 후에도 계속해서 에러메세지가 출력된다면 <a href="#Apache_is_running_a_threaded_MPM.2C_but_your_PHP_Module_is_not_compiled_to_be_threadsafe.">위에서 언급된 부분</a>을 참고한다.
</p>
<h3><span class="mw-headline" id="Changing_the_max_execution_time_in_php.ini_has_no_effect">Changing the max_execution_time in php.ini has no effect</span></h3>
<p><code>php.ini</code>파일에서 <code>max_execution_time</code>의 값을 30(초)보다 큰 값으로 변경하면 30초 후에 아파치로부터 <code>503 Service Unavailable</code>라는 응답을 받게 된다. 이를 해결하기 위해서는 http 설정에서 <code>&lt;FilesMatch \.php$&gt;</code> 부분 이전에 <code>ProxyTimeout</code> 디렉티브를 추가해주면 해결 가능하다:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/httpd/conf/httpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ProxyTimeout 300
</pre>
<p>변경 후에는 <code>httpd.service</code>를 재시작한다.
</p>
<h2>
<span id=".EC.B0.B8.EC.A1.B0"></span><span class="mw-headline" id="참조">참조</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="http://www.apache.org/">Apache Official Website</a></li>
<li><a rel="nofollow" class="external text" href="http://www.akadia.com/services/ssh_test_certificate.html">Tutorial for creating self-signed certificates</a></li>
<li><a rel="nofollow" class="external text" href="http://wiki.apache.org/httpd/CommonMisconfigurations">Apache Wiki Troubleshooting</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../ko/Category:Web_server.html" title="Category:Web server (한국어)">Web server (한국어)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
<li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Apache_HTTP_Server_(%ED%95%9C%EA%B5%AD%EC%96%B4)&amp;oldid=646052">https://wiki.archlinux.org/index.php?title=Apache_HTTP_Server_(한국어)&amp;oldid=646052</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 20 December 2020, at 08:46.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
