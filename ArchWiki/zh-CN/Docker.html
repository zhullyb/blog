<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Docker (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Docker_简体中文 rootpage-Docker_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Docker (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../en/Systemd-nspawn.html" title="Systemd-nspawn">systemd-nspawn</a></li>
<li><a href="../en/Linux_Containers.html" title="Linux Containers">Linux Containers</a></li>
<li><a href="../en/Vagrant.html" title="Vagrant">Vagrant</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="../en/Docker.html" title="Docker">Docker</a> 的<a href="../zh-CN/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2018-10-22。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Docker&amp;diff=0&amp;oldid=549067">更改</a>，则您可以帮助同步翻译。</div>
<p><a href="https://en.wikipedia.org/wiki/Docker_(software)" class="extiw" title="wikipedia:Docker (software)">Docker</a> 是一种打包、传输和运行任何程序作为轻量级容器的实用工具.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%E5%AE%89%E8%A3%85"><span class="tocnumber">1</span> <span class="toctext">安装</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#%E9%85%8D%E7%BD%AE"><span class="tocnumber">2</span> <span class="toctext">配置</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#%E5%AD%98%E5%82%A8%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F"><span class="tocnumber">2.1</span> <span class="toctext">存储驱动程序</span></a></li>
<li class="toclevel-2 tocsection-4">
<a href="#%E8%BF%9C%E7%A8%8B_API"><span class="tocnumber">2.2</span> <span class="toctext">远程 API</span></a>
<ul>
<li class="toclevel-3 tocsection-5"><a href="#%E7%94%A8systemd%E6%89%93%E5%BC%80%E8%BF%9C%E7%A8%8BAPI"><span class="tocnumber">2.2.1</span> <span class="toctext">用systemd打开远程API</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-6"><a href="#%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8Bsocket%E9%85%8D%E7%BD%AE"><span class="tocnumber">2.3</span> <span class="toctext">守护进程socket配置</span></a></li>
<li class="toclevel-2 tocsection-7">
<a href="#%E4%BB%A3%E7%90%86"><span class="tocnumber">2.4</span> <span class="toctext">代理</span></a>
<ul>
<li class="toclevel-3 tocsection-8"><a href="#%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE"><span class="tocnumber">2.4.1</span> <span class="toctext">代理配置</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="#%E5%AE%B9%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="tocnumber">2.4.2</span> <span class="toctext">容器配置</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-10"><a href="#%E9%85%8D%E7%BD%AE_DNS"><span class="tocnumber">2.5</span> <span class="toctext">配置 DNS</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#%E5%9C%A8systemd-networkd%E7%94%A8%E6%89%8B%E5%8A%A8%E5%AE%9A%E4%B9%89%E7%9A%84%E7%BD%91%E7%BB%9C%E8%BF%90%E8%A1%8CDocker"><span class="tocnumber">2.6</span> <span class="toctext">在systemd-networkd用手动定义的网络运行Docker</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#%E9%95%9C%E5%83%8F%E4%BD%8D%E7%BD%AE"><span class="tocnumber">2.7</span> <span class="toctext">镜像位置</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E6%B3%A8%E5%86%8C"><span class="tocnumber">2.8</span> <span class="toctext">不安全的注册</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-14">
<a href="#%E9%95%9C%E5%83%8F"><span class="tocnumber">3</span> <span class="toctext">镜像</span></a>
<ul>
<li class="toclevel-2 tocsection-15"><a href="#Arch_Linux"><span class="tocnumber">3.1</span> <span class="toctext">Arch Linux</span></a></li>
<li class="toclevel-2 tocsection-16">
<a href="#Debian"><span class="tocnumber">3.2</span> <span class="toctext">Debian</span></a>
<ul>
<li class="toclevel-3 tocsection-17"><a href="#%E6%89%8B%E5%8A%A8"><span class="tocnumber">3.2.1</span> <span class="toctext">手动</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-18"><a href="#%E7%A7%BB%E9%99%A4docker%E5%92%8C%E9%95%9C%E5%83%8F"><span class="tocnumber">4</span> <span class="toctext">移除docker和镜像</span></a></li>
<li class="toclevel-1 tocsection-19"><a href="#%E6%9C%89%E7%94%A8%E7%9A%84%E5%BB%BA%E8%AE%AE"><span class="tocnumber">5</span> <span class="toctext">有用的建议</span></a></li>
<li class="toclevel-1 tocsection-20">
<a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4"><span class="tocnumber">6</span> <span class="toctext">故障排除</span></a>
<ul>
<li class="toclevel-2 tocsection-21"><a href="#docker0_%E7%BD%91%E6%A1%A5%E6%97%A0%E6%B3%95%E8%8E%B7%E5%8F%96_IP_/_internet_%E5%88%B0%E5%AE%B9%E5%99%A8"><span class="tocnumber">6.1</span> <span class="toctext">docker0 网桥无法获取 IP /  internet 到容器</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#%E9%BB%98%E8%AE%A4%E7%9A%84%E5%85%81%E8%AE%B8%E7%9A%84%E8%BF%9B%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E6%95%B0%E5%A4%AA%E5%B0%91"><span class="tocnumber">6.2</span> <span class="toctext">默认的允许的进程/线程数太少</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%98%BE%E5%8D%A1%E9%A9%B1%E5%8A%A8%E9%94%99%E8%AF%AF:_devmapper"><span class="tocnumber">6.3</span> <span class="toctext">初始化显卡驱动错误: devmapper</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="#%E6%97%A0%E6%B3%95%E5%88%9B%E5%BB%BA%E5%88%B0%E6%9F%90%E6%96%87%E4%BB%B6%E7%9A%84%E8%B7%AF%E5%BE%84:_%E8%AE%BE%E5%A4%87%E6%B2%A1%E6%9C%89%E5%A4%9A%E4%BD%99%E7%9A%84%E7%A9%BA%E9%97%B4%E4%BA%86"><span class="tocnumber">6.4</span> <span class="toctext">无法创建到某文件的路径: 设备没有多余的空间了</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#kernel_4.19.1%E4%B8%8B%E6%97%A0%E6%95%88%E7%9A%84%E8%B7%A8%E8%AE%BE%E5%A4%87%E9%93%BE%E6%8E%A5"><span class="tocnumber">6.5</span> <span class="toctext">kernel 4.19.1下无效的跨设备链接</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#CPUACCT_missing_in_docker_with_Linux-ck"><span class="tocnumber">6.6</span> <span class="toctext">CPUACCT missing in docker with Linux-ck</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-27"><a href="#%E6%9F%A5%E9%98%85%E6%9B%B4%E5%A4%9A"><span class="tocnumber">7</span> <span class="toctext">查阅更多</span></a></li>
</ul>
</div>

<h2>
<span id=".E5.AE.89.E8.A3.85"></span><span class="mw-headline" id="安装">安装</span>
</h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a>  <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=docker">docker</a></span> 包 或者，对于开发版本，选择<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/docker-git/">docker-git</a></span><sup><small>AUR</small></sup> 包. 下一步 <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">start</a> 并启用 <code>docker.service</code> 然后验证操作:
</p>
<pre># docker info
</pre>
<p>注意, 如果你有一个活动的 VPN 连接, 那么 docker 服务的启动可能失败, 因为 VPN 和 Docker 的网桥 IP 冲突以及网络覆盖. 如果发生了这种事, 尝试在启动 docker 服务之前断开 VPN 连接. 你可以在之后立刻重连 VPN. <a rel="nofollow" class="external text" href="https://stackoverflow.com/questions/45692255/how-make-openvpn-work-with-docker">You can also try to deconflict the networks.</a>
</p>
<p>如果你想以普通用户身份运行docker的话，添加你自己到 <code>docker</code> <a href="../en/Users_and_groups.html#Group_management" class="mw-redirect" title="User group">user group</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 任何加入到 <code>docker</code> 组的用户都和root用户等价. 查阅更多信息可访问 <a rel="nofollow" class="external text" href="https://github.com/docker/docker/issues/9976">这里</a> 和 <a rel="nofollow" class="external text" href="https://docs.docker.com/engine/security/security/">这里</a>.</div>
<h2>
<span id=".E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="配置">配置</span>
</h2>
<h3>
<span id=".E5.AD.98.E5.82.A8.E9.A9.B1.E5.8A.A8.E7.A8.8B.E5.BA.8F"></span><span class="mw-headline" id="存储驱动程序">存储驱动程序</span>
</h3>
<p>docker存储驱动 (或者是显卡驱动) 对性能有巨大影响. 它的工作是高效存储容器镜像层，也就是许多镜像共享一个层时只有一个层使用磁盘空间。作为兼容选项, `devicemapper` 提供了次优性能, 这在机械硬盘上是非常糟糕的. 例外, `devicemapper` 不建议在生产中使用.
</p>
<p>随着arch Linux发布新的内核，没有必要使用兼容选项了。一个好的现代选择是 <code>overlay2</code>.
</p>
<p>想看现在的存储驱动, 运行 <code># docker info | head</code>; 现代docker安装应该已经默认使用 <code>overlay2</code> 了.
</p>
<p>想设置你自己的存储驱动选项, 编辑 <code>/etc/docker/daemon.json</code> (如果不存在就自己创建):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  "storage-driver": "overlay2"
}</pre>
<p>然后, <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Restart">restart</a> docker.
</p>
<p>更多的选项信息能在 <a rel="nofollow" class="external text" href="https://docs.docker.com/engine/userguide/storagedriver/selectadriver/">用户指南</a>查阅.
更多的 <code>daemon.json</code> 选项查阅 <a rel="nofollow" class="external text" href="https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file">docker 文档</a>.
</p>
<h3>
<span id=".E8.BF.9C.E7.A8.8B_API"></span><span class="mw-headline" id="远程_API">远程 API</span>
</h3>
<p>手动打开远程 API 端口 <code>4243</code> , 运行:
</p>
<pre># /usr/bin/dockerd -H tcp://0.0.0.0:4243 -H unix:///var/run/docker.sock
</pre>
<p><code>-H tcp://0.0.0.0:4243</code> 部分是用来打开远程 API的.
</p>
<p><code>-H unix:///var/run/docker.sock</code> 部分是通过终端连接主机的.
</p>
<h4>
<span id=".E7.94.A8systemd.E6.89.93.E5.BC.80.E8.BF.9C.E7.A8.8BAPI"></span><span class="mw-headline" id="用systemd打开远程API">用systemd打开远程API</span>
</h4>
<p>如果要用docker守护进程开启远程API, 创建一个 <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Drop-in snippet">Drop-in snippet</a> ，内容如下:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/docker.service.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart=
ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:4243 -H unix:///var/run/docker.sock</pre>
<h3>
<span id=".E5.AE.88.E6.8A.A4.E8.BF.9B.E7.A8.8Bsocket.E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="守护进程socket配置">守护进程socket配置</span>
</h3>
<p><i>docker</i> 守护进场默认监听 <a href="https://en.wikipedia.org/wiki/Unix_domain_socket" class="extiw" title="wikipedia:Unix domain socket">Unix socket</a> .如果要监听特定端口的话, 创建一个 <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Drop-in snippet">Drop-in snippet</a> ，内容如下:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/docker.socket.d/socket.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Socket]
ListenStream=0.0.0.0:2375</pre>
<h3>
<span id=".E4.BB.A3.E7.90.86"></span><span class="mw-headline" id="代理">代理</span>
</h3>
<p>代理配置分为两部分。一部分是主机docker守护进程的配置，另一部分是让容器检测到代理的配置
</p>
<h4>
<span id=".E4.BB.A3.E7.90.86.E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="代理配置">代理配置</span>
</h4>
<p>创建一个 <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Drop-in snippet">Drop-in snippet</a> 内容如下:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/docker.service.d/proxy.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
Environment="HTTP_PROXY=192.168.1.1:8080"
Environment="HTTPS_PROXY=192.168.1.1:8080"</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 这假定 <code>192.168.1.1</code> 是你的代理服务器，不要使用 <code>127.0.0.1</code>.</div>
<p>确定配置被加载了:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># systemctl show docker --property Environment</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Environment=HTTP_PROXY=192.168.1.1:8080 HTTPS_PROXY=192.168.1.1:8080</pre>
<h4>
<span id=".E5.AE.B9.E5.99.A8.E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="容器配置">容器配置</span>
</h4>
<p>在 <code>docker.service</code> 文件里的设置并不会进入到容器里. 要实现这样的话必须设置 <code>ENV</code> 变量在你的 <code>Dockerfile</code> 里:
</p>
<pre>FROM base/archlinux
ENV http_proxy="http://192.168.1.1:3128"
ENV https_proxy="https://192.168.1.1:3128"
</pre>
<p><a rel="nofollow" class="external text" href="https://docs.docker.com/engine/reference/builder/#env">Docker</a> 提供了配置的细节信息，通过Dockerfile的 <code>ENV</code> .
</p>
<h3>
<span id=".E9.85.8D.E7.BD.AE_DNS"></span><span class="mw-headline" id="配置_DNS">配置 DNS</span>
</h3>
<p>默认的，docker会让容器里的 <code>resolv.conf</code> 和主机里的 <code>/etc/resolv.conf</code> 匹配, 并过滤掉本地地址 (e.g. <code>127.0.0.1</code>).  如果这产生了一个空文件, 那么 <a rel="nofollow" class="external text" href="https://developers.google.com/speed/public-dns/">Google DNS servers</a> 就会被使用.  如果你用的是 <a href="../zh-CN/Dnsmasq.html" title="Dnsmasq (简体中文)">dnsmasq (简体中文)</a> 一样的服务来提供域名解析的话, 你可能需要在 <code>/etc/resolv.conf</code> 添加入口给docker网络借口让它不被过滤掉.
</p>
<h3>
<span id=".E5.9C.A8systemd-networkd.E7.94.A8.E6.89.8B.E5.8A.A8.E5.AE.9A.E4.B9.89.E7.9A.84.E7.BD.91.E7.BB.9C.E8.BF.90.E8.A1.8CDocker"></span><span class="mw-headline" id="在systemd-networkd用手动定义的网络运行Docker">在systemd-networkd用手动定义的网络运行Docker</span>
</h3>
<p>如果你是手动配置的网络，用的是 <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a> 版本 <b>220 或者更高</b>, 你运行的容器可能无法连接网络. 从版本 220开始, 对于给定网络 (<code>net.ipv4.conf.&lt;interface&gt;.forwarding</code>) 的转发设置默认是 <code>off</code>. 这个设置阻止了IP转发. 它会与在容器里启用了 <code>net.ipv4.conf.all.forwarding</code> 设置的docker冲突
</p>
<p>一个解决办法是编辑 在<code>/etc/systemd/network/</code>里的<code>&lt;interface&gt;.network</code>文件 , 添加 <code>IPForward=kernel</code> 到docker主机:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/&lt;interface&gt;.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Network]
...
IPForward=kernel
...</pre>
<p>这项设置像预期一样允许来自容器的IP转发.
</p>
<h3>
<span id=".E9.95.9C.E5.83.8F.E4.BD.8D.E7.BD.AE"></span><span class="mw-headline" id="镜像位置">镜像位置</span>
</h3>
<p>默认，docker镜像放置在 <code>/var/lib/docker</code>. 他们可以被移动到其他分区. 
首先, <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Stop">stop</a> the <code>docker.service</code>. 
</p>
<p>如果你正在运行docker镜像，你必须确定镜像被完全解除挂载。一旦这个完成后，你就可以把镜像从 <code>/var/lib/docker</code> 移动到你的目标地点.
</p>
<p>然后为<code>docker.service</code>添加 <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Drop-in snippet">Drop-in snippet</a>，加入 <code>-g</code> 参数到 <code>ExecStart</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/docker.service.d/docker-storage.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart= 
ExecStart=/usr/bin/dockerd --data-root=<i>/path/to/new/location/docker</i> -H fd://</pre>
<h3>
<span id=".E4.B8.8D.E5.AE.89.E5.85.A8.E7.9A.84.E6.B3.A8.E5.86.8C"></span><span class="mw-headline" id="不安全的注册">不安全的注册</span>
</h3>
<p>如果你想用自签名的证书, docker会拒绝它直到你定义你相信它.
为<code>docker.service</code>添加 <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Drop-in snippet">Drop-in snippet</a>, 添加 <code>--insecure-registry</code>参数到 <code>dockerd</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/docker.service.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart=
ExecStart=/usr/bin/dockerd -H fd:// --insecure-registry my.registry.name:5000</pre>
<h2>
<span id=".E9.95.9C.E5.83.8F"></span><span class="mw-headline" id="镜像">镜像</span>
</h2>
<h3><span class="mw-headline" id="Arch_Linux">Arch Linux</span></h3>
<p>下面的命令会拉取 <a rel="nofollow" class="external text" href="https://hub.docker.com/r/archlinux/base/">archlinux/base</a> x86_64 image.这是一个arch内核的剥离版本，没有网络等等.
</p>
<pre># docker pull archlinux/base
</pre>
<p>也可查阅 <a rel="nofollow" class="external text" href="https://github.com/archlinux/archlinux-docker/blob/master/README.md">README.md</a>.
</p>
<p>对于完整的arch基础，可以从下面克隆镜像并且建立你自己的镜像.
</p>
<pre>$ git clone <a rel="nofollow" class="external free" href="https://github.com/archlinux/archlinux-docker.git">https://github.com/archlinux/archlinux-docker.git</a>
</pre>
<p>编辑包文件让它只含有 '基础'. 运行: 
</p>
<pre># make docker-image
</pre>
<h3><span class="mw-headline" id="Debian">Debian</span></h3>
<p>下面的命令会拉取Debian镜像 <a rel="nofollow" class="external text" href="https://hub.docker.com/r/_/debian/">debian</a> x86_64 image.
</p>
<pre># docker pull debian
</pre>
<h4>
<span id=".E6.89.8B.E5.8A.A8"></span><span class="mw-headline" id="手动">手动</span>
</h4>
<p>用 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=debootstrap">debootstrap</a></span>建立Debian镜像:
</p>
<pre># mkdir jessie-chroot
# debootstrap jessie ./jessie-chroot <a rel="nofollow" class="external free" href="http://http.debian.net/debian/">http://http.debian.net/debian/</a>
# cd jessie-chroot
# tar cpf - . | docker import - debian
# docker run -t -i --rm debian /bin/bash
</pre>
<h2>
<span id=".E7.A7.BB.E9.99.A4docker.E5.92.8C.E9.95.9C.E5.83.8F"></span><span class="mw-headline" id="移除docker和镜像">移除docker和镜像</span>
</h2>
<p>如果你想完全移除Docker，你可以通过下面的步骤完成:
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 不要仅仅只是复制粘贴下面的命令而不知道你在干什么.</div>
<p>检查正在运行的容器:
</p>
<pre># docker ps
</pre>
<p>列出在主机运行的所有容器，为删除做准备:
</p>
<pre># docker ps -a
</pre>
<p>停止一个运行的容器:
</p>
<pre># docker stop &lt;CONTAINER ID&gt;
</pre>
<p>杀死还在运行的容器:
</p>
<pre># docker kill &lt;CONTAINER ID&gt;
</pre>
<p>通过ID删除列出的所有容器:
</p>
<pre># docker rm &lt;CONTAINER ID&gt;
</pre>
<p>列出所有的docker镜像:
</p>
<pre># docker images
</pre>
<p>通过ID删除所有镜像:
</p>
<pre># docker rmi &lt;IMAGE ID&gt;
</pre>
<p>删除所有docker数据 (清除目录):
</p>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> 执行 # rm -R /var/lib/docker 将会留下已删除容器的btrfs子卷 (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Docker_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Talk:Docker (简体中文)#</a>)</div>
</div>
<pre># rm -R /var/lib/docker
</pre>
<h2>
<span id=".E6.9C.89.E7.94.A8.E7.9A.84.E5.BB.BA.E8.AE.AE"></span><span class="mw-headline" id="有用的建议">有用的建议</span>
</h2>
<p>抓取运行容器的IP地址:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ docker inspect --format='{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' &lt;container-name OR id&gt; </pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">172.17.0.37</pre>
<p>每个正在运行的容器，它们的名字和相关IP地址都能被列出来在 <code>/etc/hosts</code>里用:
</p>
<pre>#!/usr/bin/env sh
for ID in $(docker ps -q | awk '{print $1}'); do
    IP=$(docker inspect --format="{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}" "$ID")
    NAME=$(docker ps | grep "$ID" | awk '{print $NF}')
    printf "%s %s\n" "$IP" "$NAME"
done</pre>
<h2>
<span id=".E6.95.85.E9.9A.9C.E6.8E.92.E9.99.A4"></span><span class="mw-headline" id="故障排除">故障排除</span>
</h2>
<h3>
<span id="docker0_.E7.BD.91.E6.A1.A5.E6.97.A0.E6.B3.95.E8.8E.B7.E5.8F.96_IP_.2F_internet_.E5.88.B0.E5.AE.B9.E5.99.A8"></span><span class="mw-headline" id="docker0_网桥无法获取_IP_/_internet_到容器">docker0 网桥无法获取 IP /  internet 到容器</span>
</h3>
<p>Docker会自己启用IP转发，但是默认 <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a> 会覆盖对应的sysctl设置. 在网络配置文件里设置 <code>IPForward=yes</code> . 查阅 <a href="../en/Internet_sharing.html#Enable_packet_forwarding" title="Internet sharing">Internet sharing#Enable packet forwarding</a> 获取细节.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  你可能需要在每次 <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Restart">restart</a> <code>systemd-networkd.service</code> 或者 <code>iptables.service</code> 之后手动重启 <code>docker.service</code>
</div>
<h3>
<span id=".E9.BB.98.E8.AE.A4.E7.9A.84.E5.85.81.E8.AE.B8.E7.9A.84.E8.BF.9B.E7.A8.8B.2F.E7.BA.BF.E7.A8.8B.E6.95.B0.E5.A4.AA.E5.B0.91"></span><span class="mw-headline" id="默认的允许的进程/线程数太少">默认的允许的进程/线程数太少</span>
</h3>
<p>如果你允许时得到下面的错误信息
</p>
<pre># e.g. Java
java.lang.OutOfMemoryError: unable to create new native thread
# e.g. C, bash, ...
fork failed: Resource temporarily unavailable
</pre>
<p>那么你可能需要调整被systemd允许的进程数. 默认的是 500 (see <code>system.conf</code>), 这对需要允许几个容器的话太少了. <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">Edit</a> 并添加下面片段 <code>docker.service</code> :
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># systemctl edit docker.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
TasksMax=infinity</pre>
<h3>
<span id=".E5.88.9D.E5.A7.8B.E5.8C.96.E6.98.BE.E5.8D.A1.E9.A9.B1.E5.8A.A8.E9.94.99.E8.AF.AF:_devmapper"></span><span class="mw-headline" id="初始化显卡驱动错误:_devmapper">初始化显卡驱动错误: devmapper</span>
</h3>
<p>如果 <i>systemctl</i> 不能开启docker并提供了以下信息:
</p>
<pre>Error starting daemon: error initializing graphdriver: devmapper: Device docker-8:2-915035-pool is not a thin pool
</pre>
<p>那么尝试以下步骤来解决错误。停止docker服务，备份 <code>/var/lib/docker/</code> (如果需要的话), 移除<code>/var/lib/docker/</code>的内容, 尝试重启docker服务. 查阅 <a rel="nofollow" class="external text" href="https://github.com/docker/docker/issues/21304">GitHub issue</a> 获取更多细节.
</p>
<h3>
<span id=".E6.97.A0.E6.B3.95.E5.88.9B.E5.BB.BA.E5.88.B0.E6.9F.90.E6.96.87.E4.BB.B6.E7.9A.84.E8.B7.AF.E5.BE.84:_.E8.AE.BE.E5.A4.87.E6.B2.A1.E6.9C.89.E5.A4.9A.E4.BD.99.E7.9A.84.E7.A9.BA.E9.97.B4.E4.BA.86"></span><span class="mw-headline" id="无法创建到某文件的路径:_设备没有多余的空间了">无法创建到某文件的路径: 设备没有多余的空间了</span>
</h3>
<p>如果你获取到的错误信息是像这样的话:
</p>
<pre>ERROR: Failed to create some/path/to/file: No space left on device
</pre>
<p>当创建或者运行Docker镜像时，尽管磁盘还有多余的空间。所以请确保:
</p>
<ul>
<li>
<a href="../en/Tmpfs.html" title="Tmpfs">Tmpfs</a> 被禁用了并且有足够的内存分配. Docker可能会尝试写入文件到 <code>/tmp</code> 但是失败了因为内存使用的限制和磁盘空间不足.</li>
<li>如果你在使用 <a href="../zh-CN/XFS.html" title="XFS (简体中文)">XFS (简体中文)</a>, 你可能得从相关入口移除 <code>noquota</code> 挂载选项在 <code>/etc/fstab</code>里 (通常是 <code>/tmp</code> 和/或 <code>/var/lib/docker</code> 在的地方). 查阅 <a href="../en/Disk_quota.html" title="Disk quota">Disk quota</a> 获取更多信息, 特别是你计划使用和调整 <code>overlay2</code> Docker 存储驱动.</li>
<li>XFS 的配额挂载选项在文件系统重新挂载时 (<code>uquota</code>, <code>gquota</code>, <code>prjquota</code>, 等等.) 失败了.  为了为root文件系统启用配额挂载选项必须作为 <a href="../zh-CN/Kernel_parameters.html" title="Kernel parameters (简体中文)">Kernel parameters (简体中文)</a> <code>rootflags=</code>传递到initramfs. 之后, 它就不应该在 <code>/etc/fstab</code>中的挂载选项中列出root (<code>/</code>) 文件系统.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> XFS配额和标准Linux<a href="../en/Disk_quota.html" title="Disk quota">Disk quota</a>, <a rel="nofollow" class="external autonumber" href="http://inai.de/linux/adm_quota">[1]</a> 是有区别的。这里值得一读.</div>
<h3>
<span id="kernel_4.19.1.E4.B8.8B.E6.97.A0.E6.95.88.E7.9A.84.E8.B7.A8.E8.AE.BE.E5.A4.87.E9.93.BE.E6.8E.A5"></span><span class="mw-headline" id="kernel_4.19.1下无效的跨设备链接">kernel 4.19.1下无效的跨设备链接</span>
</h3>
<p>如果像 <i>dpkg</i> 这样的命令在docker运行失败, 比如:
</p>
<pre>dpkg: error: error creating new backup file '/var/lib/dpkg/status-old': Invalid cross-device link
</pre>
<p>可以 添加 <code>overlay.metacopy=N</code> <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a> 或者降级到 4.18.x 直到 <a rel="nofollow" class="external text" href="https://github.com/docker/for-linux/issues/480">这个 issue</a> 被解决. 更多信息查看 <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=241866">Arch forum</a>.
</p>
<h3><span class="mw-headline" id="CPUACCT_missing_in_docker_with_Linux-ck">CPUACCT missing in docker with Linux-ck</span></h3>
<p>In newer versions of <a href="../en/Linux-ck.html" title="Linux-ck">Linux-ck</a> (<a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/linux-ck#comment-677316">some experienced</a> with 4.19, 4.20 seems general), a change to the MuQSS was made that disables the <code>CONFIG_CGROUP_CPUACCT</code> option from the kernel, which makes <i>some</i> usage of docker (<code>run</code> or <code>build</code>) to produce the following error:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ docker run --rm hello-world</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">docker: Error response from daemon: unable to find "cpuacct" in controller set: unknown.</pre>
<p>This error does not seems to affect the docker daemon, just containers. Read more on <a href="../en/Linux-ck.html#CPUACCT_missing_in_docker" title="Linux-ck">Linux-ck#CPUACCT missing in docker</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup>.
</p>
<h2>
<span id=".E6.9F.A5.E9.98.85.E6.9B.B4.E5.A4.9A"></span><span class="mw-headline" id="查阅更多">查阅更多</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.docker.com">Official website</a></li>
<li><a rel="nofollow" class="external text" href="https://docs.docker.com/engine/installation/linux/archlinux/">Arch Linux on docs.docker.com</a></li>
<li>
<a rel="nofollow" class="external text" href="http://opensource.com/business/14/7/docker-security-selinux">Are Docker containers really secure?</a> — opensource.com</li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../zh-CN/Category:Sandboxing.html" title="Category:Sandboxing (简体中文)">Sandboxing (简体中文)</a></li>
<li><a href="../zh-CN/Category:Virtualization.html" title="Category:Virtualization (简体中文)">Virtualization (简体中文)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Docker_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=627723">https://wiki.archlinux.org/index.php?title=Docker_(简体中文)&amp;oldid=627723</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 1 August 2020, at 10:12.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
