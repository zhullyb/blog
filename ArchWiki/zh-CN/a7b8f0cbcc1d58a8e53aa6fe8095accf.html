<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>GRUB (简体中文)/EFI examples (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-GRUB_简体中文_EFI_examples_简体中文 rootpage-GRUB_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">GRUB (简体中文)/EFI examples (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"><span class="subpages">&lt; <a href="../zh-CN/GRUB.html" title="GRUB (简体中文)">GRUB (简体中文)</a></span></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>相关文章</p>
<ul>
<li><a href="../en/GRUB.html" class="mw-redirect" title="Grub">Grub</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="../en/GRUB/EFI_examples.html" title="GRUB/EFI examples">GRUB/EFI_examples</a> 的<a href="../zh-CN/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2015-02-28。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=GRUB/EFI_examples&amp;diff=0&amp;oldid=362948">更改</a>，则您可以帮助同步翻译。</div>
<p>我们都知道不同的主板制造商有不同的 UEFI 实现。本文介绍了一些针对不同硬件来以 EFI 模式安装/恢复 GRUB 的可行方法。
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Apple_Mac_EFI_%E7%B3%BB%E7%BB%9F"><span class="tocnumber">1</span> <span class="toctext">Apple Mac EFI 系统</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#%E9%80%9A%E7%94%A8_Mac_%E7%94%B5%E8%84%91"><span class="tocnumber">1.1</span> <span class="toctext">通用 Mac 电脑</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-3">
<a href="#%E5%8D%8E%E7%A1%95"><span class="tocnumber">2</span> <span class="toctext">华硕</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Z68_%E7%B3%BB%E5%88%97%E5%92%8C_U47_%E7%B3%BB%E5%88%97"><span class="tocnumber">2.1</span> <span class="toctext">Z68 系列和 U47 系列</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#ux32vd"><span class="tocnumber">2.2</span> <span class="toctext">ux32vd</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#P8Z77_%E7%B3%BB%E5%88%97"><span class="tocnumber">2.3</span> <span class="toctext">P8Z77 系列</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#M5A97"><span class="tocnumber">2.4</span> <span class="toctext">M5A97</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8">
<a href="#HP"><span class="tocnumber">3</span> <span class="toctext">HP</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#EliteBook_840_G1"><span class="tocnumber">3.1</span> <span class="toctext">EliteBook 840 G1</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10">
<a href="#Intel"><span class="tocnumber">4</span> <span class="toctext">Intel</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#S5400_%E7%B3%BB%E5%88%97"><span class="tocnumber">4.1</span> <span class="toctext">S5400 系列</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12">
<a href="#%E8%81%94%E6%83%B3"><span class="tocnumber">5</span> <span class="toctext">联想</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="#K450_IdeaCentre"><span class="tocnumber">5.1</span> <span class="toctext">K450 IdeaCentre</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#M92p_ThinkCentre"><span class="tocnumber">5.2</span> <span class="toctext">M92p ThinkCentre</span></a></li>
</ul>
</li>
</ul>
</div>

<h2>
<span id="Apple_Mac_EFI_.E7.B3.BB.E7.BB.9F"></span><span class="mw-headline" id="Apple_Mac_EFI_系统">Apple Mac EFI 系统</span>
</h2>
<h3>
<span id=".E9.80.9A.E7.94.A8_Mac_.E7.94.B5.E8.84.91"></span><span class="mw-headline" id="通用_Mac_电脑">通用 Mac 电脑</span>
</h3>
<p>使用 Mac OS X 自带的 bless 命令把 <code>grubx64.efi</code> 设置为默认启动选项。如果你只安装了 Linux, 也可以启动进入 Mac OS X 安装盘并打开终端。创建一个目录并挂载 EFI 系统分区:
</p>
<pre># cd /Volumes
# mkdir efi
# mount -t msdos /dev/disk0s1 /Volumes/efi
</pre>
<p>然后让 bless 作用于 <code>grub.efi</code> 和 EFI 分区以设置为默认启动选项。
</p>
<pre># bless --folder=/Volumes/efi --file=/Volumes/efi/efi/arch_grub/grubx64.efi --setBoot
# bless --mount=/Volumes/efi --file=/Volumes/efi/efi/arch_grub/grubx64.efi --setBoot
</pre>
<p>更多信息见 <a rel="nofollow" class="external free" href="https://help.ubuntu.com/community/UEFIBooting#Apple_Mac_EFI_systems_.28both_EFI_architecture.29">https://help.ubuntu.com/community/UEFIBooting#Apple_Mac_EFI_systems_.28both_EFI_architecture.29</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> TODO: GRUB 上游源 Bazaar 的 mactel 分支 <a rel="nofollow" class="external free" href="http://bzr.savannah.gnu.org/lh/grub/branches/mactel/changes">http://bzr.savannah.gnu.org/lh/grub/branches/mactel/changes</a><sup title="最后检查状态：404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">失效链接</a> 2020-08-02 ⓘ]</sup>. GRUB 开发者将停止提交变更。</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> TODO: Fedora 开发者开发的实验性的 Linux 版 bless 工具 - <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mactel-boot/">mactel-boot</a></span><sup><small>AUR</small></sup>. 需要更多测试。</div>
<h2>
<span id=".E5.8D.8E.E7.A1.95"></span><span class="mw-headline" id="华硕">华硕</span>
</h2>
<h3>
<span id="Z68_.E7.B3.BB.E5.88.97.E5.92.8C_U47_.E7.B3.BB.E5.88.97"></span><span class="mw-headline" id="Z68_系列和_U47_系列">Z68 系列和 U47 系列</span>
</h3>
<pre># cp /boot/efi/EFI/arch_grub/grubx64.efi /boot/efi/shellx64.efi
</pre>
<p>从 UEFI 设置/菜单启动 UEFI Shell 之后 (在华硕 UEFI BIOS 中切换到高级模式，按下位于右上角的 Exit 并选择"Launch EFI shell from filesystem device"). GRUB2 菜单会出现然后可以进入系统。之后，可以使用 efibootmgr 来设置菜单条目，例如 UEFI 分区是 /dev/sda1: (参见 <a href="../en/Unified_Extensible_Firmware_Interface.html" title="Unified Extensible Firmware Interface">Unified Extensible Firmware Interface</a>)
</p>
<pre>efibootmgr -c -g -d /dev/sda -p 1 -w -L "Arch Linux (GRUB)" -l /EFI/arch_grub/grubx64.efi
</pre>
<p>如果你的主板没有这个选项 (就算它有), 你也可以使用 UEFI shell (<a href="../en/Unified_Extensible_Firmware_Interface.html#UEFI_Shell" title="Unified Extensible Firmware Interface">Unified Extensible Firmware Interface#UEFI Shell</a>) 来临时为 Arch 分区创建 UEFI 启动选项。
</p>
<p>进入 EFI shell 之后，添加 UEFI 启动菜单条目:
</p>
<pre>Shell&gt; bcfg boot add 0 fs1:\EFI\arch_grub\grubx64.efi "Arch Linux (GRUB2)"
</pre>
<p>此处 <code>fs1</code> 映射到 UEFI 系统分区，<code>\EFI\arch_grub\grubx64.efi</code> 来源于上面 <code>grub-install</code> 命令含有的 <code>--bootloader-id</code>.
</p>
<p>这会临时添加 UEFI 启动选项以在下一次重启时进入 Arch. 进入之后，输入命令 <code>modprobe efivars</code> 并确证 <code>efibootmgr</code> 没有错误 (没有错误意味着你成功地进入了 UEFI 模式). 然后 <a href="../en/GRUB.html#UEFI_systems" title="GRUB">GRUB#UEFI systems</a> 会再次运行并能成功地往 UEFI 菜单永久性地添加启动条目。
</p>
<h3><span class="mw-headline" id="ux32vd">ux32vd</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 如果没有正确设置 EFI 启动条目的话，BIOS 会无法从 GPT 硬盘启动。这种情况下 BIOS 甚至认不出硬盘。</div>
<p>存在一个大问题，即如果机器从 MBR 启动，之后运行 grub-install (或 efibootmgr) 会失败，并伴随着以下错误提示:
</p>
<pre>EFI variables are not supported on this system

</pre>
<p>首先应以 EFI 启动并创建启动条目。对于 Z68 系列可由如下方法完成: 复制 <code>/boot/efi/EFI/arch_grub/grubx64.efi</code> 为 <code>/boot/efi/shellx64.efi</code> 并选择"Launch EFI shell from filesystem device".
成功启动之后就能以 grub-install 或 efibootmgr 创建启动条目了。
</p>
<h3>
<span id="P8Z77_.E7.B3.BB.E5.88.97"></span><span class="mw-headline" id="P8Z77_系列">P8Z77 系列</span>
</h3>
<ul>
<li>启动进 live 系统并 chroot 进目标系统。</li>
<li>确证 100 MB fat32 的分区被标记为 "EFI System" (gdisk 使用16进制编码 ef00).</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 如果你得到信息"WARNING: Not enough clusters for a 32 bit FAT!"，就要用 <code>mkfs.vfat -s2 -F32 ...</code> 来减小簇大小否则 UEFI 会无法读取分区。</div>
<p><b>在 CHROOT 内</b>
</p>
<pre># mount -t vfat /dev/sdXY /boot/efi
# grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=arch --recheck
# grub-mkconfig -o /boot/grub/grub.cfg
# wget <a rel="nofollow" class="external free" href="https://edk2.svn.sourceforge.net/svnroot/edk2/trunk/edk2/ShellBinPkg/UefiShell/X64/Shell.efi">https://edk2.svn.sourceforge.net/svnroot/edk2/trunk/edk2/ShellBinPkg/UefiShell/X64/Shell.efi</a><sup title="最后检查状态：404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">失效链接</a> 2020-08-02 ⓘ]</sup>
# umount /boot/efi
</pre>
<p>EFI 分区应该只包含两个文件:
</p>
<pre>/Shell.efi
/EFI/arch/grubx64.efi
</pre>
<ul>
<li>重启进入 BIOS (<code>Delete</code> 键可以做到).</li>
<li>使用方向键移动到 'exit' 菜单进入到 EFI Shell.</li>
<li>往菜单里为 Arch 添加新条目。下面的是一个范例，更多见文章 <a href="../en/Unified_Extensible_Firmware_Interface.html#Launching_UEFI_Shell" class="mw-redirect" title="UEFI">UEFI#Launching UEFI Shell</a>.</li>
</ul>
<p><b>在 EFI SHELL 内</b>
</p>
<pre>Shell&gt; bcfg boot dump -v
Shell&gt; bcfg boot add 1 fs0:\EFI\arch\grubx64.efi "Arch Linux (grub manually added)"
Shell&gt; exit
</pre>
<ul>
<li>重启进入 BIOS.</li>
<li>进入 'Boot' 部分并调整启动选项次序，使得 "Arch Linux (grub 手动添加)" 在 SSD 上。</li>
<li>进入该条目，享受成功的喜悦。</li>
</ul>
<h3><span class="mw-headline" id="M5A97">M5A97</span></h3>
<p>完成标准 Arch 安装流程，确保已安装 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub">grub</a></span> 并且硬盘是 GPT 格式。
</p>
<p>来自 <a href="../en/GRUB.html#UEFI_systems" title="GRUB">GRUB#UEFI systems</a>:
</p>
<p>UEFI 系统分区需要挂载到 <code>/boot/efi/</code> 以便 GRUB 安装脚本探测到:
</p>
<pre># mkdir -p /boot/efi
# mount -t vfat /dev/sdXY /boot/efi
</pre>
<p>此处 X 是你的启动硬盘 Y 是你之前创建的 EFI 分区。
</p>
<p>使用如下命令添加 GRUB UEFI 应用程序到 <code>/boot/efi/EFI/arch_grub</code> 以及添加模块到 <code>/boot/grub/x86_64-efi</code>:
</p>
<pre># modprobe dm-mod
# grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=arch_grub --recheck --debug
# mkdir -p /boot/grub/locale
# cp /usr/share/locale/en\@quot/LC_MESSAGES/grub.mo /boot/grub/locale/en.mo
</pre>
<p>为 GRUB 生成配置文件:
</p>
<pre># grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<p>然后复制 <a rel="nofollow" class="external text" href="http://dl.dropbox.com/u/17629062/Shell2.zip">修改版 UEFI Shell v2 二进制文件</a><sup title="最后检查状态：404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">失效链接</a> 2020-08-02 ⓘ]</sup> UefiShellX64.efi 到你的 EFI 系统分区根目录。
</p>
<pre># cp ~/Shell2/UefiShellX64.efi /mnt/boot/efi/shellx64.efi
</pre>
<p>我们使用这个 Shell 应用程序因为 efibootmgr 命令在 grub-install 期间没有错误提示。
</p>
<p>之后从 UEFI 设置/菜单启动 UEFI Shell 之后 (在华硕 UEFI BIOS 中切换到高级模式，按下位于右上角的 Exit 并选择"Launch EFI shell from filesystem device"). UEFI Shell 会出现。在此添加 GRUB UEFI app 到引导器。
</p>
<pre>Shell&gt; bcfg boot add 3 fs0:\EFI\Arch_Grub\grubx64.efi "Arch_Grub"
</pre>
<p>此处 <code>fs0</code> 映射到 UEFI 系统分区，<code>3</code> 是0启动项目录。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> UEFI Shell 命令通常支持 <code>-b</code> 选项，它用来在每页输出完后暂停。<code>map</code> 列出识别的文件系统 (<code>fs0</code>, ...) 和数据存储设备 (<code>blk0</code>, ...). 运行 <code>help -b</code> 以列出可用命令。 <a href="../en/Unified_Extensible_Firmware_Interface.html#Important_UEFI_Shell_commands" title="Unified Extensible Firmware Interface">Unified Extensible Firmware Interface#Important UEFI Shell commands</a>
</div> 
<p>列出目前启动条目，运行:
</p>
<pre>Shell&gt; bcfg boot dump -v
</pre>
<h2><span class="mw-headline" id="HP">HP</span></h2>
<h3><span class="mw-headline" id="EliteBook_840_G1">EliteBook 840 G1</span></h3>
<p>详见 <a href="../en/HP_EliteBook_840_G1.html#UEFI_Setup" title="HP EliteBook 840 G1">HP EliteBook 840 G1#UEFI Setup</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 上面的流程对一些 HP 其他型号也有用。</div>
<h2><span class="mw-headline" id="Intel">Intel</span></h2>
<h3>
<span id="S5400_.E7.B3.BB.E5.88.97"></span><span class="mw-headline" id="S5400_系列">S5400 系列</span>
</h3>
<p>这个主板可以在 BIOS 和 EFI 模式下运行。BIOS 模式需要 MBR 分区方案的硬盘，EFI 需要 GPT 的。注意这个主板执行 Intel EFI v1.10 标准，并且仅限 i386. 除开以下变更之外，遵循正常 UEFI 安装流程。
</p>
<ul>
<li>不使用 <code>grub-efi-x86_64</code> 包，而是 <code>grub-efi-i386</code>.</li>
<li>在 UEFI (v2.0) 前的固件 <code>bcfg</code> 命令不可用。<code>startup.nsh</code> 可在 EFI 分区的根目录使用，其中要包含引导器的路径。例如:</li>
</ul>
<p><code>fs0:\EFI\arch_grub\boot.efi</code>
必须位于在 EFI 分区根目录上的 <code>startup.nsh</code> 文件里。
</p>
<ul><li>
<code>grub.cfg</code> 必须与 grub EFI 文件放到一起，否则 grub 会找不到并进入交互 shell.</li></ul>
<h2>
<span id=".E8.81.94.E6.83.B3"></span><span class="mw-headline" id="联想">联想</span>
</h2>
<h3><span class="mw-headline" id="K450_IdeaCentre">K450 IdeaCentre</span></h3>
<p>"EFI System"分区要求文件 <code>EFI\Boot\bootx64.efi</code> 存在来进行引导，否则会收到"Error 1962: No operating system found. Boot sequence will automatically repeat." 假设"EFI System"挂载在 <code>/boot/efi</code>:
</p>
<pre> # grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=grub --recheck --debug
 # mkdir /boot/efi/EFI/Boot
 # touch /boot/efi/EFI/Boot/bootx64.efi
</pre>
<p>这是 UEFI 实现的疑似 bug 的解决方案。
</p>
<h3><span class="mw-headline" id="M92p_ThinkCentre">M92p ThinkCentre</span></h3>
<p>系统有 EFI 白名单标签。只能从标有"Red Hat Enterprise Linux"的启动。所以给引导器指定一个合适的 id:
</p>
<pre> # grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id="Red Hat Enterprise Linux" --recheck --debug
</pre>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../zh-CN/Category:Boot_loaders.html" title="Category:Boot loaders (简体中文)">Boot loaders (简体中文)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li></ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=GRUB_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)/EFI_examples_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=628558">https://wiki.archlinux.org/index.php?title=GRUB_(简体中文)/EFI_examples_(简体中文)&amp;oldid=628558</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 2 August 2020, at 20:55.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
