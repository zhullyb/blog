<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>NetworkManager (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-NetworkManager_简体中文 rootpage-NetworkManager_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">NetworkManager (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../en/Network_configuration.html" title="Network configuration">Network configuration</a></li>
<li><a href="../en/Network_configuration/Wireless.html" class="mw-redirect" title="Wireless network configuration">Wireless network configuration</a></li>
<li><a href="../en/Category:Network_configuration.html" title="Category:Network configuration">Category:Network configuration</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="../en/NetworkManager.html" title="NetworkManager">NetworkManager</a> 的<a href="../zh-CN/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2015-02-17。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=NetworkManager&amp;diff=0&amp;oldid=361369">更改</a>，则您可以帮助同步翻译。</div>
<p><a rel="nofollow" class="external text" href="https://projects.gnome.org/NetworkManager/">网络管理器</a>(NetworManager)是检测网络、自动连接网络的程序。无论是无线还是有线连接，它都可以令您轻松管理。对于无线网络,网络管理器优先连接已知的网络并可以自动切换到最可靠的无线网络。利用网络管理器的程序可以自由切换在线和离线模式。网络管理器会相对无线网络优先选择有线网络，支持 VPN。网络管理器最初由 Redhat 公司开发，现在由 <a href="../zh-CN/GNOME.html" title="GNOME (简体中文)">GNOME</a> 管理。
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 请注意, Wi-Fi 的密码默认情况下是明文保存的。参见 <a href="#%E5%8A%A0%E5%AF%86%E7%9A%84Wi-Fi%E5%AF%86%E7%A0%81">#加密的Wi-Fi密码</a>
</div>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#%E5%AE%89%E8%A3%85"><span class="tocnumber">1</span> <span class="toctext">安装</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#%E5%90%AF%E7%94%A8_NetworkManager"><span class="tocnumber">1.1</span> <span class="toctext">启用 NetworkManager</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#%E9%A2%9D%E5%A4%96%E7%9A%84%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2"><span class="tocnumber">1.2</span> <span class="toctext">额外的用户界面</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#%E7%A7%BB%E5%8A%A8%E7%BD%91%E7%BB%9C%E6%94%AF%E6%8C%81"><span class="tocnumber">1.3</span> <span class="toctext">移动网络支持</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#VPN_%E6%94%AF%E6%8C%81"><span class="tocnumber">1.4</span> <span class="toctext">VPN 支持</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#PPPoE_/_DSL_%E6%94%AF%E6%8C%81"><span class="tocnumber">1.5</span> <span class="toctext">PPPoE / DSL 支持</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7">
<a href="#%E4%BD%BF%E7%94%A8"><span class="tocnumber">2</span> <span class="toctext">使用</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#nmcli_%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="tocnumber">2.1</span> <span class="toctext">nmcli 使用示例</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9">
<a href="#%E5%89%8D%E7%AB%AF"><span class="tocnumber">3</span> <span class="toctext">前端</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#GNOME"><span class="tocnumber">3.1</span> <span class="toctext">GNOME</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#KDE_Plasma"><span class="tocnumber">3.2</span> <span class="toctext">KDE Plasma</span></a></li>
<li class="toclevel-2 tocsection-12">
<a href="#nm-applet"><span class="tocnumber">3.3</span> <span class="toctext">nm-applet</span></a>
<ul>
<li class="toclevel-3 tocsection-13"><a href="#Appindicator"><span class="tocnumber">3.3.1</span> <span class="toctext">Appindicator</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-14"><a href="#nmcli-dmenu"><span class="tocnumber">3.4</span> <span class="toctext">nmcli-dmenu</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15">
<a href="#%E9%85%8D%E7%BD%AE"><span class="tocnumber">4</span> <span class="toctext">配置</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="#%E8%AE%BE%E7%BD%AE_PolicyKit_%E6%9D%83%E9%99%90"><span class="tocnumber">4.1</span> <span class="toctext">设置 PolicyKit 权限</span></a></li>
<li class="toclevel-2 tocsection-17">
<a href="#%E4%BD%BF%E7%94%A8_NetworkManager_%E8%B0%83%E5%BA%A6%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1"><span class="tocnumber">4.2</span> <span class="toctext">使用 NetworkManager 调度网络服务</span></a>
<ul>
<li class="toclevel-3 tocsection-18"><a href="#%E9%81%BF%E5%85%8D%E8%B6%85%E6%97%B6"><span class="tocnumber">4.2.1</span> <span class="toctext">避免超时</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="#%E5%90%AF%E5%8A%A8_OpenNTPD"><span class="tocnumber">4.2.2</span> <span class="toctext">启动 OpenNTPD</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="#%E4%BD%BF%E7%94%A8sshfs%E6%8C%82%E8%BD%BD%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="tocnumber">4.2.3</span> <span class="toctext">使用sshfs挂载远程文件夹</span></a></li>
<li class="toclevel-3 tocsection-21"><a href="#%E4%BD%BF%E7%94%A8_dispatcher_%E5%9C%A8%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E5%BB%BA%E7%AB%8B%E5%90%8E%E8%BF%9E%E6%8E%A5_vpn"><span class="tocnumber">4.2.4</span> <span class="toctext">使用 dispatcher 在网络连接建立后连接 vpn</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-22"><a href="#%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE"><span class="tocnumber">4.3</span> <span class="toctext">代理设置</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="#%E7%A6%81%E7%94%A8_NetworkManager"><span class="tocnumber">4.4</span> <span class="toctext">禁用 NetworkManager</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-24"><a href="#%E6%B5%8B%E8%AF%95"><span class="tocnumber">5</span> <span class="toctext">测试</span></a></li>
<li class="toclevel-1 tocsection-25">
<a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="tocnumber">6</span> <span class="toctext">常见问题</span></a>
<ul>
<li class="toclevel-2 tocsection-26"><a href="#%E5%AE%89%E5%85%A8Wi-Fi%E7%BD%91%E7%BB%9C%E4%B8%8D%E6%8F%90%E7%A4%BA%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81"><span class="tocnumber">6.1</span> <span class="toctext">安全Wi-Fi网络不提示输入密码</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#PPTP_%E9%80%9A%E9%81%93%E4%B8%AD%E6%97%A0%E6%B5%81%E9%87%8F"><span class="tocnumber">6.2</span> <span class="toctext">PPTP 通道中无流量</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%A4%B1%E6%95%88"><span class="tocnumber">6.3</span> <span class="toctext">网络管理功能失效</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#%E5%AE%9A%E5%88%B6resolv.conf"><span class="tocnumber">6.4</span> <span class="toctext">定制resolv.conf</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="#%E4%BD%BF%E7%94%A8_resolv.conf.head_%E5%92%8C_resolv.conf.tail"><span class="tocnumber">6.5</span> <span class="toctext">使用 resolv.conf.head 和 resolv.conf.tail</span></a></li>
<li class="toclevel-2 tocsection-31"><a href="#%E5%9C%A8resolv.conf%E4%B8%AD%E4%BF%9D%E7%95%99%E6%94%B9%E5%8A%A8"><span class="tocnumber">6.6</span> <span class="toctext">在resolv.conf中保留改动</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="#%E4%BD%BF%E7%94%A8dhclient%E6%97%B6%E7%9A%84DHCP%E9%97%AE%E9%A2%98"><span class="tocnumber">6.7</span> <span class="toctext">使用dhclient时的DHCP问题</span></a></li>
<li class="toclevel-2 tocsection-33"><a href="#%E4%B8%BB%E6%9C%BA%E5%90%8D%E9%97%AE%E9%A2%98"><span class="tocnumber">6.8</span> <span class="toctext">主机名问题</span></a></li>
<li class="toclevel-2 tocsection-34"><a href="#%E9%85%8D%E7%BD%AEdhclient%E6%8A%8A%E4%B8%BB%E6%9C%BA%E5%90%8D%E6%8E%A8%E9%80%81%E5%88%B0DHCP%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="tocnumber">6.9</span> <span class="toctext">配置dhclient把主机名推送到DHCP服务器</span></a></li>
<li class="toclevel-2 tocsection-35"><a href="#%E9%85%8D%E7%BD%AENetworkManager%E4%BD%BF%E7%94%A8%E4%B8%80%E4%B8%AA%E7%89%B9%E6%80%A7%E7%9A%84DHCP%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="tocnumber">6.10</span> <span class="toctext">配置NetworkManager使用一个特性的DHCP客户端</span></a></li>
<li class="toclevel-2 tocsection-36"><a href="#%E7%BC%BA%E5%B0%91%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1_route"><span class="tocnumber">6.11</span> <span class="toctext">缺少默认路由 route</span></a></li>
<li class="toclevel-2 tocsection-37"><a href="#%E6%B2%A1%E6%9C%89%E6%8E%A2%E6%B5%8B%E5%88%B0_3G_%E6%A8%A1%E5%9D%97"><span class="tocnumber">6.12</span> <span class="toctext">没有探测到 3G 模块</span></a></li>
<li class="toclevel-2 tocsection-38"><a href="#%E5%9C%A8%E7%AC%94%E8%AE%B0%E6%9C%AC%E4%B8%8A%E5%85%B3%E9%97%ADWLAN"><span class="tocnumber">6.13</span> <span class="toctext">在笔记本上关闭WLAN</span></a></li>
<li class="toclevel-2 tocsection-39"><a href="#%E9%9D%99%E6%80%81_IP_%E8%AE%BE%E7%BD%AE_%E5%8F%98%E6%88%90_DHCP"><span class="tocnumber">6.14</span> <span class="toctext">静态 IP 设置 变成 DHCP</span></a></li>
<li class="toclevel-2 tocsection-40"><a href="#%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E6%97%A0%E6%B3%95%E7%BC%96%E8%BE%91%E9%93%BE%E6%8E%A5"><span class="tocnumber">6.15</span> <span class="toctext">普通用户无法编辑链接</span></a></li>
<li class="toclevel-2 tocsection-41"><a href="#%E5%88%A0%E9%99%A4%E9%9A%90%E8%94%BD%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E9%93%BE%E6%8E%A5"><span class="tocnumber">6.16</span> <span class="toctext">删除隐蔽无线网络链接</span></a></li>
<li class="toclevel-2 tocsection-42"><a href="#GNOME_VPN%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98"><span class="tocnumber">6.17</span> <span class="toctext">GNOME VPN失效问题</span></a></li>
<li class="toclevel-2 tocsection-43"><a href="#Unable_to_connect_to_visible_European_wireless_networks"><span class="tocnumber">6.18</span> <span class="toctext">Unable to connect to visible European wireless networks</span></a></li>
<li class="toclevel-2 tocsection-44"><a href="#%E5%BC%95%E5%AF%BC%E6%97%B6%E8%87%AA%E5%8A%A8%E8%BF%9E%E6%8E%A5%E5%88%B0VPN%E4%B8%8D%E5%B7%A5%E4%BD%9C"><span class="tocnumber">6.19</span> <span class="toctext">引导时自动连接到VPN不工作</span></a></li>
<li class="toclevel-2 tocsection-45"><a href="#dhcpd%E4%B8%8D%E6%96%AD%E5%9C%B0%E6%8B%92%E7%BB%9D%E7%A7%9F%E7%BA%A6"><span class="tocnumber">6.20</span> <span class="toctext">dhcpd不断地拒绝租约</span></a></li>
<li class="toclevel-2 tocsection-46"><a href="#Systemd%E7%93%B6%E9%A2%88"><span class="tocnumber">6.21</span> <span class="toctext">Systemd瓶颈</span></a></li>
<li class="toclevel-2 tocsection-47"><a href="#%E7%BD%91%E7%BB%9C(WiFi)%E7%BB%8F%E5%B8%B8%E6%9C%89%E8%A7%84%E5%BE%8B%E5%9C%B0%E6%96%AD%E5%BC%80"><span class="tocnumber">6.22</span> <span class="toctext">网络(WiFi)经常有规律地断开</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-48">
<a href="#%E6%8F%90%E7%A4%BA%E4%B8%8E%E6%8A%80%E5%B7%A7"><span class="tocnumber">7</span> <span class="toctext">提示与技巧</span></a>
<ul>
<li class="toclevel-2 tocsection-49"><a href="#%E5%8A%A0%E5%AF%86%E7%9A%84Wi-Fi%E5%AF%86%E7%A0%81"><span class="tocnumber">7.1</span> <span class="toctext">加密的Wi-Fi密码</span></a></li>
<li class="toclevel-2 tocsection-50">
<a href="#%E9%80%9A%E8%BF%87Wi-Fi%E5%85%B1%E4%BA%AB%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5"><span class="tocnumber">7.2</span> <span class="toctext">通过Wi-Fi共享网络连接</span></a>
<ul>
<li class="toclevel-3 tocsection-51"><a href="#Ad-hoc"><span class="tocnumber">7.2.1</span> <span class="toctext">Ad-hoc</span></a></li>
<li class="toclevel-3 tocsection-52"><a href="#Real_AP"><span class="tocnumber">7.2.2</span> <span class="toctext">Real AP</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-53"><a href="#%E9%80%9A%E8%BF%87Ethernet%E5%85%B1%E4%BA%AB%E8%BF%9E%E6%8E%A5"><span class="tocnumber">7.3</span> <span class="toctext">通过Ethernet共享连接</span></a></li>
<li class="toclevel-2 tocsection-54"><a href="#%E5%9C%A8cron%E4%BB%BB%E5%8A%A1%EF%BC%88jobs%EF%BC%89%E6%88%96%E8%84%9A%E6%9C%AC%E4%B8%AD%E6%A3%80%E6%9F%A5%E7%BD%91%E7%BB%9C%E6%98%AF%E5%90%A6%E8%BF%9E%E6%8E%A5"><span class="tocnumber">7.4</span> <span class="toctext">在cron任务（jobs）或脚本中检查网络是否连接</span></a></li>
<li class="toclevel-2 tocsection-55">
<a href="#%E7%99%BB%E9%99%86%E5%90%8E%E8%87%AA%E5%8A%A8%E8%A7%A3%E9%94%81%E7%A7%98%E9%92%A5%E7%8E%AF"><span class="tocnumber">7.5</span> <span class="toctext">登陆后自动解锁秘钥环</span></a>
<ul>
<li class="toclevel-3 tocsection-56"><a href="#GNOME_2"><span class="tocnumber">7.5.1</span> <span class="toctext">GNOME</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-57"><a href="#%E6%9C%89%E5%AF%86%E7%A0%81%E8%AE%A4%E8%AF%81%E7%9A%84KDE_and_OpenConnect_VPN"><span class="tocnumber">7.6</span> <span class="toctext">有密码认证的KDE and OpenConnect VPN</span></a></li>
<li class="toclevel-2 tocsection-58"><a href="#%E5%BF%BD%E7%95%A5%E7%89%B9%E5%AE%9A%E8%AE%BE%E5%A4%87"><span class="tocnumber">7.7</span> <span class="toctext">忽略特定设备</span></a></li>
<li class="toclevel-2 tocsection-59"><a href="#%E5%90%AF%E7%94%A8DNS%E7%BC%93%E5%AD%98"><span class="tocnumber">7.8</span> <span class="toctext">启用DNS缓存</span></a></li>
<li class="toclevel-2 tocsection-60"><a href="#%E5%90%AF%E7%94%A8IPv6%E9%9A%90%E7%A7%81%E6%89%A9%E5%B1%95"><span class="tocnumber">7.9</span> <span class="toctext">启用IPv6隐私扩展</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-61"><a href="#%E5%85%B6%E5%AE%83%E8%B5%84%E6%BA%90"><span class="tocnumber">8</span> <span class="toctext">其它资源</span></a></li>
</ul>
</div>

<h2>
<span id=".E5.AE.89.E8.A3.85"></span><span class="mw-headline" id="安装">安装</span>
</h2>
<p>NetworkManager可以通过<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=networkmanager">networkmanager</a></span>包<a href="../zh-CN/Help:Reading.html#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85" class="mw-redirect" title="安装">安装</a>。这个包包括了一个daemon、一个命令行界面(<code>nmcli</code>)和一个基于curses的界面(<code>nmtui</code>)。NetworkManager支持基本的DHCP功能。对于全功能的DHCP和IPV6支持，请安装<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhclient">dhclient</a></span> 。
</p>
<h3>
<span id=".E5.90.AF.E7.94.A8_NetworkManager"></span><span class="mw-headline" id="启用_NetworkManager">启用 NetworkManager</span>
</h3>
<p>安装好之后需要<a href="../zh-CN/Systemd.html#%E4%BD%BF%E7%94%A8%E5%8D%95%E5%85%83" title="Systemd (简体中文)">启动/启用</a> <code>NetworkManager.service</code> <a href="../en/Systemd.html" title="Systemd">systemd</a> 服务。NetworkManager 守护进程启动后，会自动连接到任何可用的已经配置的<b>系统连接</b>。<b>用户连接</b>或未配置的连接需要通过<code>nmcli</code>或applet进行配置和连接。 
</p>
<h3>
<span id=".E9.A2.9D.E5.A4.96.E7.9A.84.E7.94.A8.E6.88.B7.E7.95.8C.E9.9D.A2"></span><span class="mw-headline" id="额外的用户界面">额外的用户界面</span>
</h3>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nm-connection-editor">nm-connection-editor</a></span>，提供图形界面，</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=network-manager-applet">network-manager-applet</a></span>，提供系统托盘图标(<code>nm-applet</code>)。</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 你必须确保没有其他会对网络进行配置的服务正在运行;事实上, 多个网络配置服务之间会相互冲突。如果想知道当前有哪些服务正在运行, 可以运行 <code>systemctl --type=service</code> 然后 <a href="../en/Systemd.html#Using_units" title="Systemd">停止</a> 多余的网络配置服务。参见 <a href="#%E9%85%8D%E7%BD%AE">#配置</a> 来激活 NetworkManager 服务。</div>
<h3>
<span id=".E7.A7.BB.E5.8A.A8.E7.BD.91.E7.BB.9C.E6.94.AF.E6.8C.81"></span><span class="mw-headline" id="移动网络支持">移动网络支持</span>
</h3>
<p><a href="../zh-CN/Help:Reading.html#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85" class="mw-redirect" title="安装">安装</a><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=modemmanager">modemmanager</a></span>、<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mobile-broadband-provider-info">mobile-broadband-provider-info</a></span>和<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=usb_modeswitch">usb_modeswitch</a></span>来支持连接移动网络。详情参见<a href="../en/USB_3G_Modem.html#NetworkManager" title="USB 3G Modem">USB 3G Modem#NetworkManager</a>。
</p>
<h3>
<span id="VPN_.E6.94.AF.E6.8C.81"></span><span class="mw-headline" id="VPN_支持">VPN 支持</span>
</h3>
<p>从1.16版本开始NetworkManager对<a href="../en/WireGuard.html" title="WireGuard">WireGuard</a>有原生支持<a rel="nofollow" class="external autonumber" href="https://blogs.gnome.org/thaller/2019/03/15/wireguard-in-networkmanager/">[1]</a>。
</p>
<p>NetworkManager 对其他 VPN 的支持基于一个插件系统。请针对需要的VPN类型选择性安装以下的软件包:
</p>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=networkmanager-openconnect">networkmanager-openconnect</a></span> for <a href="../en/OpenConnect.html" title="OpenConnect">OpenConnect</a>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=networkmanager-openvpn">networkmanager-openvpn</a></span> for <a href="../en/OpenVPN.html" title="OpenVPN">OpenVPN</a>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=networkmanager-pptp">networkmanager-pptp</a></span> for <a href="../en/PPTP_Client.html" title="PPTP Client">PPTP Client</a>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=networkmanager-vpnc">networkmanager-vpnc</a></span> for <a href="../en/Vpnc.html" title="Vpnc">Vpnc</a>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=networkmanager-strongswan">networkmanager-strongswan</a></span> for <a href="../en/StrongSwan.html" title="StrongSwan">strongSwan</a>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-fortisslvpn-git/">networkmanager-fortisslvpn-git</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-iodine-git/">networkmanager-iodine-git</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-libreswan/">networkmanager-libreswan</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-l2tp/">networkmanager-l2tp</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-ssh-git/">networkmanager-ssh-git</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-sstp/">networkmanager-sstp</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：package not found]</sup>
</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> VPN支持是<a rel="nofollow" class="external text" href="https://bugzilla.gnome.org/buglist.cgi?quicksearch=networkmanager%20vpn">unstable</a>，请通过GUI检查daemon进程的选项是否正确设置了，并在每次更新之后再次检查。<a rel="nofollow" class="external autonumber" href="https://bugzilla.gnome.org/show_bug.cgi?id=755350">[2]</a>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 为了在使用VPN的时候使用全功能的DNS，你应该设置<a href="../en/NetworkManager.html#DNS_caching_and_split_DNS" title="NetworkManager">split DNS</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup>。</div>
<h3>
<span id="PPPoE_.2F_DSL_.E6.94.AF.E6.8C.81"></span><span class="mw-headline" id="PPPoE_/_DSL_支持">PPPoE / DSL 支持</span>
</h3>
<p><a href="../zh-CN/Help:Reading.html#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85" class="mw-redirect" title="安装">安装</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=rp-pppoe">rp-pppoe</a></span> 来获得对 PPPoE / DSL 连接的支持。使用<code>nm-connection-editor</code>并添加一个新的DSL/PPPoE连接。
</p>
<h2>
<span id=".E4.BD.BF.E7.94.A8"></span><span class="mw-headline" id="使用">使用</span>
</h2>
<p>NetworkManager 自带了 <span class="plainlinks archwiki-template-man" title="$ man 1 nmcli"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nmcli.1">nmcli(1)</a></span> 和 <span class="plainlinks archwiki-template-man" title="$ man 1 nmtui"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nmtui.1">nmtui(1)</a></span>.
</p>
<h3>
<span id="nmcli_.E4.BD.BF.E7.94.A8.E7.A4.BA.E4.BE.8B"></span><span class="mw-headline" id="nmcli_使用示例">nmcli 使用示例</span>
</h3>
<p>显示附近的 wifi:
</p>
<pre>$ nmcli device wifi list
</pre>
<p>连接 wifi:
</p>
<pre>$ nmcli device wifi connect <i>SSID</i> password <i>password</i>
</pre>
<p>连接到隐藏的 wifi:
</p>
<pre>$ nmcli device wifi connect <i>SSID</i> password <i>password</i> hidden yes
</pre>
<p>通过 <code>wlan1</code> wifi 网卡(interface)连接 wifi:
</p>
<pre>$ nmcli device wifi connect <i>SSID</i> password <i>password</i> ifname wlan1 <i>profile_name</i>
</pre>
<p>断开一个网卡(interface)上的连接:
</p>
<pre>$ nmcli device disconnect ifname eth0
</pre>
<p>重新连接一个被标记为“已断开”的网卡：
</p>
<pre>$ nmcli connection up uuid <i>UUID</i>
</pre>
<p>显示一个所有连接过的网络的UUID的列表:
</p>
<pre>$ nmcli connection show
</pre>
<p>查看所有网络设备及其状态:
</p>
<pre>$ nmcli device
</pre>
<p>关掉 wifi:
</p>
<pre>$ nmcli radio wifi off
</pre>
<h2>
<span id=".E5.89.8D.E7.AB.AF"></span><span class="mw-headline" id="前端">前端</span>
</h2>
<p>为了配置和轻松使用网络管理器，大多数用户会希望安装一个托盘组件。图形前端往往显示在系统托盘（或通知区域），从而允许用户选择网络或者配置 NetworkManager。不同类型的桌面环境下有多种托盘插件。
</p>
<h3><span class="mw-headline" id="GNOME">GNOME</span></h3>
<p><a href="../en/GNOME.html" title="GNOME">GNOME</a>在 <i>网络设置</i> 里有内置的配置工具。
</p>
<h3><span class="mw-headline" id="KDE_Plasma">KDE Plasma</span></h3>
<p><a href="../zh-CN/Help:Reading.html#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85" class="mw-redirect" title="安装">安装</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=plasma-nm">plasma-nm</a></span> 软件包。然后通过 <i>面板的选项 &gt; 添加部件 &gt; 网络</i> 来把它添加到KDE的任务栏上。
</p>
<h3><span class="mw-headline" id="nm-applet">nm-applet</span></h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=network-manager-applet">network-manager-applet</a></span> 是一个GTK3+前端小程序，工作在Xorg环境下，带有一个系统托盘。
</p>
<p>为了存储连接密码，请安装并配置 <a href="../en/GNOME/Keyring.html" title="GNOME/Keyring">GNOME/Keyring</a>。
</p>
<p>请注意，如果对某个连接启用了 <code>对其他用户可用</code> 选项，NetworkManager就会将密码明文存储，虽然相应的文件只能被root或者其他使用 <code>nm-applet</code> 的用户访问。参照 <a href="#%E5%8A%A0%E5%AF%86%E7%9A%84Wi-Fi%E5%AF%86%E7%A0%81">#加密的Wi-Fi密码</a>。
</p>
<p>在没有系统托盘的情况下运行 <code>nm-applet</code>，可以使用 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=trayer">trayer</a></span> 或者
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=stalonetray">stalonetray</a></span>。比如，你可以在自己的可执行文件路径中添加这样的脚本：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">nmgui</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh
nm-applet    2&gt;&amp;1 &gt; /dev/null &amp;
stalonetray  2&gt;&amp;1 &gt; /dev/null
killall nm-applet
</pre>
<p>当关闭 <i>stalonetray</i> 窗口的时候，它会关闭 <code>nm-applet</code>，所以当你完成网络配置后它就不会再占用内存。
</p>
<p><i>nm-applet</i> 可以显示一些事件的消息，比如连接或断开WiFi。为了显示这些消息，确保你已安装了一个消息服务器 - 参照 <a href="../en/Desktop_notifications.html" title="Desktop notifications">Desktop notifications</a>。如果你在没有消息服务器的情况下使用它，消息可能会出现在stdout/stderr中并可能导致程序卡住。参照 <a rel="nofollow" class="external autonumber" href="https://bugzilla.gnome.org/show_bug.cgi?id=788313">[3]</a>。
</p>
<p>为了在禁用消息提示的情况下使用 <code>nm-applet</code>，用以下命令运行程序：
</p>
<pre>$ nm-applet --no-agent
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> <code>nm-applet</code> 可能被 <a href="../en/XDG_Autostart.html" title="XDG Autostart">自启动desktop文件</a> 自动启动，这种情况下要添加--no-agent选项请修改Exec那一行：
 <pre>Exec=nm-applet --no-agent</pre>
</div>
<h4><span class="mw-headline" id="Appindicator">Appindicator</span></h4>
<p><i>nm-applet</i> 是支持Appindicator的，但没有被编译进官方软件包，详见  <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/51740">FS#51740</a>。为了在Appindicator环境中使用nm-applet，将 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=network-manager-applet">network-manager-applet</a></span> 替换成 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/network-manager-applet-indicator/">network-manager-applet-indicator</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：package not found]</sup> 并执行以下命令：
</p>
<pre>$ nm-applet --indicator
</pre>
<h3><span class="mw-headline" id="nmcli-dmenu">nmcli-dmenu</span></h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-dmenu-git/">networkmanager-dmenu-git</a></span><sup><small>AUR</small></sup> 是一个通过 <a href="../en/Dmenu.html" title="Dmenu">dmenu</a> 而不是 <code>nm-applet</code> 来管理 NetworkManager 连接的脚本。它提供了所有必要的功能, 例如连接到已有的 WiFi 或有线网络、连接到新的 WiFi 网络、在需要的时候询问密码、连接到已有的 VPN、启用/停用网络连接、运行图形界面 <i>nm-connection-editor</i> 等等。
</p>
<h2>
<span id=".E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="配置">配置</span>
</h2>
<p>NetworkManager 需要做这么几步保证正常运行。确保你<code>/etc/hosts</code>按照<a href="../en/Network_configuration.html#Set_the_hostname" title="Network configuration">Network configuration#Set the hostname</a>一节的描述配置了<code>/etc/hosts</code>。
</p>
<p>NetworkManager的全局配置文件位于<code>/etc/NetworkManager/NetworkManager.conf</code>。额外的配置文件可以放进<code>/etc/NetworkManager/conf.d/</code>文件夹。通常全局的默认配置不需要改动。
</p>
<h3>
<span id=".E8.AE.BE.E7.BD.AE_PolicyKit_.E6.9D.83.E9.99.90"></span><span class="mw-headline" id="设置_PolicyKit_权限">设置 PolicyKit 权限</span>
</h3>
<p>参照<a href="../en/General_troubleshooting.html#Session_permissions" title="General troubleshooting">General troubleshooting#Session permissions</a>建立一个工作会话. 在工作会话中,你有三种方式授予NetworkManager工作所必须的权限.
</p>
<p><i>方式 1.</i> 登录后运行<a href="../en/Polkit.html" class="mw-redirect" title="PolicyKit">PolicyKit</a>认证代理,比如 <code>/usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1</code> (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=polkit-gnome">polkit-gnome</a></span> 的一部分). 当你添加和删除一个网络链接时会提示输入密码.
</p>
<p><i>方式 2.</i> 将你的账户加入<code>wheel</code>账户组. 管理网络时你将不需要输入密码,但注意你的账户同时被赋予了此账户组的其他权限,比如运行<a href="../en/Sudo.html" title="Sudo">sudo</a>命令是无需密码.
</p>
<p><i>方式 3.</i> 将你的账户加入<code>network</code>账户组,同时创建以下文件:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/polkit-1/rules.d/50-org.freedesktop.NetworkManager.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">polkit.addRule(function(action, subject) {
  if (action.id.indexOf("org.freedesktop.NetworkManager.") == 0 &amp;&amp; subject.isInGroup("network")) {
    return polkit.Result.YES;
  }
});
</pre>
<p>所有在<code>network</code>账户群中的用户都能免密码管理网络. 但是如果你没有在 <a href="../en/Systemd.html#Using_systemd-logind" title="Systemd">systemd-logind</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup> 中拥有一个活跃会话的话, 在systemd下此方式将失效.
</p>
<h3>
<span id=".E4.BD.BF.E7.94.A8_NetworkManager_.E8.B0.83.E5.BA.A6.E7.BD.91.E7.BB.9C.E6.9C.8D.E5.8A.A1"></span><span class="mw-headline" id="使用_NetworkManager_调度网络服务">使用 NetworkManager 调度网络服务</span>
</h3>
<p>有些服务只有联网时才有意义，例如 <a href="../en/OpenNTPD.html" title="OpenNTPD">OpenNTPD</a> 和 网络文件系统挂载(<b>netfs</b>)。dispatcher 可以在连接网络后启动这些服务，并在网络关闭时停止它们。要使用这一功能, 需要启动 <code>NetworkManager-dispatcher.service</code>。
并且将脚本加到 <code>/etc/NetworkManager/dispatcher.d</code> 目录。这些脚本必须属于 root, 否则不会被执行。为了安全起见, 用户组也设置为 root:
</p>
<pre># chown root:root <i>scriptname</i>
</pre>
<p>而且脚本必须只能是拥有者可写, 否则不会被执行:
</p>
<pre># chmod 755 <i>scriptname</i>
</pre>
<p>脚本将在连接网络时按字母表顺序运行，并在网络停止时反向停止。要保证启动顺序，可以在前面加数字，例如 <code>10_portmap</code> 或 <code>30_netfs</code> 这样就能保证 portmapper 在 NFS 挂载之前启动。
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 如果没有连接到外部网络，请注意启动的服务和需要它们的程序。如果连接公共网络时启动了错误的服务，可能导致安全问题。</div>
<h4>
<span id=".E9.81.BF.E5.85.8D.E8.B6.85.E6.97.B6"></span><span class="mw-headline" id="避免超时">避免超时</span>
</h4>
<p>如果一切运行良好, 那么这一节就可以跳过了。
However, there is a general problem related to running dispatcher scripts which take longer to be executed. Initially an internal timeout of three seconds only was used. If the called script did not complete in time, it was killed. Later the timeout was extended to about 20 seconds (see the <a rel="nofollow" class="external text" href="https://bugzilla.redhat.com/show_bug.cgi?id=982734">Bugtracker</a> for more information). If the timeout still creates the problem, a work around may be to modify the dispatcher service file <code>/usr/lib/systemd/system/NetworkManager-dispatcher.service</code> to remain active after exit: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/NetworkManager-dispatcher.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">.include /usr/lib/systemd/system/NetworkManager-dispatcher.service
[Service]
RemainAfterExit=yes</pre>
<p>运行修改后的 <code>NetworkManager-dispatcher</code> 服务并将其设置为开机启动。
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 加入了 <code>RemainAfterExit</code> 那一行后会让 dispatcher 一直运行。不幸的是, dispatcher <b>必须</b>在再次运行脚本前被关闭。这意味着脚本只能被运行一次。因此, 除非超时确实引起了问题, 否则不要修改服务文件。</div>
<h4>
<span id=".E5.90.AF.E5.8A.A8_OpenNTPD"></span><span class="mw-headline" id="启动_OpenNTPD">启动 OpenNTPD</span>
</h4>
<p>安装 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-dispatcher-openntpd/">networkmanager-dispatcher-openntpd</a></span><sup><small>AUR</small></sup> 软件包
</p>
<h4>
<span id=".E4.BD.BF.E7.94.A8sshfs.E6.8C.82.E8.BD.BD.E8.BF.9C.E7.A8.8B.E6.96.87.E4.BB.B6.E5.A4.B9"></span><span class="mw-headline" id="使用sshfs挂载远程文件夹">使用sshfs挂载远程文件夹</span>
</h4>
<p>由于该脚本在一个非常受限制的环境中运行, 为了连接上SSH agent, 你必须 export <code>SSH_AUTH_SOCK</code>。 这里有几种不同方式, 参照
<a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1042030#p1042030">here</a> 获取更多详细信息. 以下示例需要 gnome-keyring , 如果 gnome-keyring 没解锁,将需要你输入密码. 如果 NetworkManager 设置为登录后自动连接, 很有可能因为 <i>gnome-keyring</i> 还没启动导致失败(转入睡眠). 对应的 UUID 可以通过命令 <code>nmcli con status</code> 或 <code>nmcli con list</code> 查得。
</p>
<pre>#!/bin/sh
USER='username'
REMOTE='user@host:/remote/path'
LOCAL='/local/path'

interface=$1 status=$2
if [ "$CONNECTION_UUID" = "<i>uuid</i>" ]; then
  case $status in
    up)
      export SSH_AUTH_SOCK=$(find /tmp -maxdepth 1 -type s -user "$USER" -name 'ssh')
      su "$USER" -c "sshfs $REMOTE $LOCAL"
      ;;
    down)
      fusermount -u "$LOCAL"
      ;;
  esac
fi
</pre>
<h4>
<span id=".E4.BD.BF.E7.94.A8_dispatcher_.E5.9C.A8.E7.BD.91.E7.BB.9C.E8.BF.9E.E6.8E.A5.E5.BB.BA.E7.AB.8B.E5.90.8E.E8.BF.9E.E6.8E.A5_vpn"></span><span class="mw-headline" id="使用_dispatcher_在网络连接建立后连接_vpn">使用 dispatcher 在网络连接建立后连接 vpn</span>
</h4>
<p>此部分示例演示如果自动连接到NetworkManager已定义的vpn-connection.首先创建调度脚本定义vpn连接之后的事务
</p>
<dl><dd>1. 创建调度脚本</dd></dl>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/dispatcher.d/vpn-up</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh
VPN_NAME="name of VPN connection defined in NetworkManager"
ESSID="Wi-Fi network ESSID (not connection name)"

interface=$1 status=$2
case $status in
  up|vpn-down)
    if iwgetid | grep -qs ":\"$ESSID\""; then
      nmcli con up id "$VPN_NAME"
    fi
    ;;
  down)
    if iwgetid | grep -qs ":\"$ESSID\""; then
      if nmcli con status id "$VPN_NAME" | grep -qs activated; then
        nmcli con down id "$VPN_NAME"
      fi
    fi
    ;;
esac
</pre>
<p>如果想在任意 Wi-Fi 网络都可以自动连接 VPN, 你可以用这样给 ESSID 赋值: <code>ESSID=$(iwgetid -r)</code>。记住要给脚本设置相应的权限, 参见 <a href="#%E7%BD%91%E7%BB%9C%E5%88%86%E9%85%8D%E5%99%A8">上文</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup>。
</p>
<p>如果想任意用户都能使用 VPN, 即使已经在 <code>nm-applet</code> 中勾选了 <i>Make the VPN connection available to all users</i> 选项, 由于 <a rel="nofollow" class="external text" href="https://developer.gnome.org/NetworkManager/0.9/secrets-flags.html">VPN secrets 保管方式的原因</a>,  连接依然可能会失败并且 NetworkManager 会报错 'no valid VPN secrets'。这样就需要执行步骤2:
</p>
<dl><dd>2. 可以选择编辑 VPN 连接的配置文件让 NetworkManager 自己储存 secrets 而不是把 secrets 保存在 <a rel="nofollow" class="external text" href="https://bugzilla.redhat.com/show_bug.cgi?id=710552">不能被root访问的</a> keyring 中:  打开 <code>/etc/NetworkManager/system-connections/<i>name of your VPN connection</i></code>, 把 <code>password-flags</code> 以及 <code>secret-flags</code> 从 <code>1</code> 改为 <code>0</code>。</dd></dl>
<p>或者直接在 VPN 配置文件中加入 <code>vpn-secrets</code> 并写入密码:
</p>
<pre> [vpn]
 ....
 password-flags=0
 
 [vpn-secrets]
 password=<i>your_password</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 现在可能有必要重新打开 NetworkManager connection editor 并再次保存 VPN passwords/secrets。</div>
<h3>
<span id=".E4.BB.A3.E7.90.86.E8.AE.BE.E7.BD.AE"></span><span class="mw-headline" id="代理设置">代理设置</span>
</h3>
<p>NetworkManager不直接处理代理设置，但是如果你使用<a href="../en/GNOME.html" title="GNOME">GNOME</a>，你可以使用 <a rel="nofollow" class="external text" href="http://marin.jb.free.fr/proxydriver/">proxydriver</a>配合NetworkManager。 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/proxydriver/">proxydriver</a></span><sup><small>AUR</small></sup>软件包位于 <a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>.
</p>
<p>为使proxydriver设置代理，你需要在设置GNOME自动启动进程(
System-&gt;Preferences-&gt;Startup Applications):
</p>
<pre>xhost +si:localuser:your_username
</pre>
<p>参照: <a href="../en/Proxy_server.html" class="mw-redirect" title="Proxy settings">Proxy settings</a>
</p>
<h3>
<span id=".E7.A6.81.E7.94.A8_NetworkManager"></span><span class="mw-headline" id="禁用_NetworkManager">禁用 NetworkManager</span>
</h3>
<p>由于服务是通过 <i>dbus</i> 自动启动的, 所以要完全禁用可以用 <i>systemctl</i> 来屏蔽:
</p>
<pre>systemctl mask NetworkManager
systemctl mask NetworkManager-dispatcher
</pre>
<h2>
<span id=".E6.B5.8B.E8.AF.95"></span><span class="mw-headline" id="测试">测试</span>
</h2>
<p>NetworkManager 托盘组件被设计成开机自动启动，所以对大部分用户来说，并不需要过多配置。
但是如果你手动停用旧有的网络设置断网，你需要测试一下 NetworkManager 是否正常工作。
首先启动服务：
</p>
<pre>systemctl start NetworkManager
</pre>
<p>有些托盘组件会提供给你一个 .desktop 文件以便通过系统菜单运行。
如果没有，那你就需要通过命令或者注销重登录系统来让托盘组件运行。
一旦托盘组件运行了，它会自动请求网络连接并通过 DHCP 服务器来进行网络配置。
</p>
<p>在一些 non-xdg-compliant 窗口系统，比如 Awesome 中启动 GNOME applet：
</p>
<pre>nm-applet --sm-disable &amp;
</pre>
<p>如果需要静态 IP，你需要配置 NetworkManager。一般来说，在托盘图标上面点击右键，
选择「编辑连接」即可。
</p>
<h2>
<span id=".E5.B8.B8.E8.A7.81.E9.97.AE.E9.A2.98"></span><span class="mw-headline" id="常见问题">常见问题</span>
</h2>
<p>常见问题的一些解决办法。
</p>
<h3>
<span id=".E5.AE.89.E5.85.A8Wi-Fi.E7.BD.91.E7.BB.9C.E4.B8.8D.E6.8F.90.E7.A4.BA.E8.BE.93.E5.85.A5.E5.AF.86.E7.A0.81"></span><span class="mw-headline" id="安全Wi-Fi网络不提示输入密码">安全Wi-Fi网络不提示输入密码</span>
</h3>
<p>当连接到一个安全的WI-Fi网络时，没有输入密码的提示，而且没有连接建立。当没有秘钥环(keyring)包安装时，会发生这种情况。一个简单的解决办法是安装<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gnome-keyring">gnome-keyring</a></span>。如果你希望密码以加密的形式存储，按照<a href="../en/GNOME/Keyring.html" class="mw-redirect" title="GNOME Keyring">GNOME Keyring</a>来设置<i>gnome-keyring-daemon</i>。
</p>
<h3>
<span id="PPTP_.E9.80.9A.E9.81.93.E4.B8.AD.E6.97.A0.E6.B5.81.E9.87.8F"></span><span class="mw-headline" id="PPTP_通道中无流量">PPTP 通道中无流量</span>
</h3>
<p>PPTP连接成功登录，可以看到一个有正确VPN IP的ppp0接口，但是甚至不能ping通远端IP。这是由于Arch提供的pppd缺少MPPE
(Microsoft Point-to-Point Encryption) 支持。 推荐首先尝试Arch提供的<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ppp">ppp</a></span>，因为它可能会按照希望的样子工作。
</p>
<p>要解决这个问题，安装<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ppp-mppe/">ppp-mppe</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：package not found]</sup>包应该足够了。
</p>
<p>参见<a href="../en/Network_configuration/Wireless.html#MS-CHAPv2" class="mw-redirect" title="WPA2 Enterprise">WPA2 Enterprise#MS-CHAPv2</a>。
</p>
<h3>
<span id=".E7.BD.91.E7.BB.9C.E7.AE.A1.E7.90.86.E5.8A.9F.E8.83.BD.E5.A4.B1.E6.95.88"></span><span class="mw-headline" id="网络管理功能失效">网络管理功能失效</span>
</h3>
<p>有时NetworkManager关闭了，但对应的pid文件却没有移除，同时你得到提示
'Network management disabled'.  你可以手工处理:
</p>
<pre># rm /var/lib/NetworkManager/NetworkManager.state
</pre>
<h3>
<span id=".E5.AE.9A.E5.88.B6resolv.conf"></span><span class="mw-headline" id="定制resolv.conf">定制resolv.conf</span>
</h3>
<p>参见主页面<a href="../en/Domain_name_resolution.html" class="mw-redirect" title="Resolv.conf">resolv.conf</a>。如果你使用<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhclient">dhclient</a></span>，你可以尝试<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-dispatch-resolv/">networkmanager-dispatch-resolv</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：package not found]</sup>包。
</p>
<h3>
<span id=".E4.BD.BF.E7.94.A8_resolv.conf.head_.E5.92.8C_resolv.conf.tail"></span><span class="mw-headline" id="使用_resolv.conf.head_和_resolv.conf.tail">使用 resolv.conf.head 和 resolv.conf.tail</span>
</h3>
<p>请阅读 <a href="../en/Domain_name_resolution.html" class="mw-redirect" title="Resolv.conf">resolv.conf</a> 并确保 NetworkManager 使用的是 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhcpcd">dhcpcd</a></span> 而不是 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhclient">dhclient</a></span>。如果要使用 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhclient">dhclient</a></span>，可以试试<a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>里面的 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-dispatch-resolv/">networkmanager-dispatch-resolv</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：package not found]</sup>。
</p>
<h3>
<span id=".E5.9C.A8resolv.conf.E4.B8.AD.E4.BF.9D.E7.95.99.E6.94.B9.E5.8A.A8"></span><span class="mw-headline" id="在resolv.conf中保留改动">在resolv.conf中保留改动</span>
</h3>
<p>NetworkManager试图将DHCP中获取的DNS信息写入<code>/etc/resolv.conf</code>,导致原文件被覆盖,你可以在文件属性中设置i参数避免文件被修改
</p>
<pre># chattr +i /etc/resolv.conf
</pre>
<p>如果你要修改此文件,移除i参数:
</p>
<pre># chattr -i /etc/resolv.conf
</pre>
<h3>
<span id=".E4.BD.BF.E7.94.A8dhclient.E6.97.B6.E7.9A.84DHCP.E9.97.AE.E9.A2.98"></span><span class="mw-headline" id="使用dhclient时的DHCP问题">使用dhclient时的DHCP问题</span>
</h3>
<p>如果你无法通过DHCP获取IP,尝试在<code>/etc/dhclient.conf</code>添加如下配置:
</p>
<pre> interface "eth0" {
   send dhcp-client-identifier 01:aa:bb:cc:dd:ee:ff;
 }
</pre>
<p>其中<code>aa:bb:cc:dd:ee:ff</code> 是你网卡的MAC地址. MAC地址可以使用<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iproute2">iproute2</a></span> 包中的 <code>ip link show eth0</code> 命令获得。
</p>
<h3>
<span id=".E4.B8.BB.E6.9C.BA.E5.90.8D.E9.97.AE.E9.A2.98"></span><span class="mw-headline" id="主机名问题">主机名问题</span>
</h3>
<p>主机名是否被转发到所链接的路由器取决与你所使用的NetworkManager插件。通用的“密钥文件”插件默认不转发主机名。为了使之转发主机名，添加下面的内容到<code>/etc/NetworkManager/NetworkManager.conf</code>：
</p>
<pre>[keyfile]
hostname=<i>your_hostname</i>
</pre>
<p><code>[keyfile]</code>下的选项会应用到默认<code>/etc/NetworkManager/system-connections</code>路径的网络连接。
</p>
<p>另一种选择是配置NetworkManager自动启动的DHCP客户端来转发主机名。NetworkManager默认使用<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhclient">dhclient</a></span>，并且当前者没有安装时使用<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhcpcd">dhcpcd</a></span>。使<i>dhclient</i> 转发主机名需要设置一个非默认选项, <i>dhcpcd</i>默认转发主机名. 
</p>
<p>首先，检查使用的是哪一个DHCP客户端(以<i>dhclient</i>为例):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># journalctl -b | egrep "dhc"</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Nov 17 21:03:20 zenbook dhclient[2949]: Nov 17 21:03:20 zenbook dhclient[2949]: Bound to *:546
Nov 17 21:03:20 zenbook dhclient[2949]: Listening on Socket/wlan0
Nov 17 21:03:20 zenbook dhclient[2949]: Sending on   Socket/wlan0
Nov 17 21:03:20 zenbook dhclient[2949]: XMT: Info-Request on wlan0, interval 1020ms.
Nov 17 21:03:20 zenbook dhclient[2949]: RCV: Reply message on wlan0 from fe80::126f:3fff:fe0c:2dc.
</pre>
<p><br>
</p>
<h3>
<span id=".E9.85.8D.E7.BD.AEdhclient.E6.8A.8A.E4.B8.BB.E6.9C.BA.E5.90.8D.E6.8E.A8.E9.80.81.E5.88.B0DHCP.E6.9C.8D.E5.8A.A1.E5.99.A8"></span><span class="mw-headline" id="配置dhclient把主机名推送到DHCP服务器">配置dhclient把主机名推送到DHCP服务器</span>
</h3>
<p>复制示例配置文件：
</p>
<pre># cp /usr/share/dhclient/dhclient.conf.example /etc/dhclient.conf
</pre>
<p><br>
看一下这个文件 - 其实我们想保存的只有一行而且<i>dhclient</i>会使用其他选项的默认值 (就像你没有这个文件时它使用的那样)。下面是那重要的一行：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dhclient.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">send host-name = pick-first-value(gethostname(), "ISC-dhclient");</pre>
<p>用你最喜欢的方法强制进行IP地址刷新，然后你应该可以在你的DHCP服务器上看到你的主机名了。
</p>
<p>IPv6推送主机名：
</p>
<pre># cp /usr/share/dhclient/dhclient.conf.example /etc/dhclient6.conf
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dhclient6.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">send fqdn.fqdn = pick-first-value(gethostname(), "ISC-dhclient");</pre>
<h3>
<span id=".E9.85.8D.E7.BD.AENetworkManager.E4.BD.BF.E7.94.A8.E4.B8.80.E4.B8.AA.E7.89.B9.E6.80.A7.E7.9A.84DHCP.E5.AE.A2.E6.88.B7.E7.AB.AF"></span><span class="mw-headline" id="配置NetworkManager使用一个特性的DHCP客户端">配置NetworkManager使用一个特性的DHCP客户端</span>
</h3>
<p>如果你想显示地设置Networkmanager使用的DHCP客户端，可以在全局配置文件中设置：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/NetworkManager.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">dhcp=internal</pre>
<p>如果这个选项更没有设置，按照默认使用的是替代的<code>dhcp=dhclient</code>。
</p>
<p>然后<a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Restart">restart</a> <code>NetworkManager.service</code>。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhcpcd">dhcpcd</a></span>的支持已经在<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=networkmanager">networkmanager</a></span>-1.0.0-2 (2015-02-14)中 <a rel="nofollow" class="external text" href="https://github.com/archlinux/svntogit-packages/commit/a1df79cbcebaec0c043789eb31965e57d17b6cdb">禁用</a> 。</div>
<p><br>
</p>
<h3>
<span id=".E7.BC.BA.E5.B0.91.E9.BB.98.E8.AE.A4.E8.B7.AF.E7.94.B1_route"></span><span class="mw-headline" id="缺少默认路由_route">缺少默认路由 route</span>
</h3>
<p>在至少一个KDE4系统中,当使用NetworkManager <a href="../zh-CN/aa29dd559001de6a26e3fe87e084eb6e.html" class="mw-redirect" title="Wireless Setup (简体中文)">Wireless Setup (简体中文)</a>链接时不会建立缺省路由。 改变无线链接的路由配置来移除<i>Use only for resources on this connection"的默认选择能解决这个问题。</i>
</p>
<h3>
<span id=".E6.B2.A1.E6.9C.89.E6.8E.A2.E6.B5.8B.E5.88.B0_3G_.E6.A8.A1.E5.9D.97"></span><span class="mw-headline" id="没有探测到_3G_模块">没有探测到 3G 模块</span>
</h3>
<p>如果NetworkManager(从v0.7.999)没有探测到你的3G模块,但是你仍然可以使用<a href="../en/Wvdial.html" title="Wvdial">wvdial</a>连接, 可以尝试安装<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=modemmanager">modemmanager</a></span>,并使用<code>rc.d restart networkmanager</code>重启服务,你可能需要重插或重启你的3G模块, 这可以让NetworkManager支持默认数据库中缺失的硬件模块
</p>
<p>参考<a href="../en/USB_3G_Modem.html#NetworkManager" title="USB 3G Modem">USB 3G Modem#NetworkManager</a>.
</p>
<h3>
<span id=".E5.9C.A8.E7.AC.94.E8.AE.B0.E6.9C.AC.E4.B8.8A.E5.85.B3.E9.97.ADWLAN"></span><span class="mw-headline" id="在笔记本上关闭WLAN">在笔记本上关闭WLAN</span>
</h3>
<p>有时候在你使用笔记本上的开关禁用WI-Fi然后重新启用后，NetworkManager无法工作。这常常是<code>rfkill</code>的问题。
$ watch -n1 rfkill list all
检查驱动<code>rfkill</code>是否通知到无线适配器的状态. 如果你开启适配器后,其标识符仍然显示blocked,你可以尝试如下命令手动unblock(X是前一条命令的identifier编号)
</p>
<pre># rfkill event unblock X
</pre>
<h3>
<span id=".E9.9D.99.E6.80.81_IP_.E8.AE.BE.E7.BD.AE_.E5.8F.98.E6.88.90_DHCP"></span><span class="mw-headline" id="静态_IP_设置_变成_DHCP">静态 IP 设置 变成 DHCP</span>
</h3>
<p>因为一个尚未结局的bug，当改变默认连接为静态IP时，<code>nm-applet</code> 可能不能恰当地保存你的IP配置改变，而自动转变为DHCP模式。
</p>
<p>要解决这个问题，你不得不在<code>nm-applet</code>中改变默认连接名（比如将"Auto eth0"变成“my eth0”）,去掉“Available to all users”的勾号，输入你的配置IP地址，然后点击“Apply”。这样就能按照所给的名字保存新的配置
</p>
<p>接下来，你可能不希望默认链接自动连接网络。运行
<code>nm-connection-editor</code> (<i>不要</i>以root身份)。在链接编辑窗口，编辑默认配置(eg "Auto eth0") 去掉"Connect automatically".， 点击 <b>Apply</b>，关掉窗口。
</p>
<h3>
<span id=".E6.99.AE.E9.80.9A.E7.94.A8.E6.88.B7.E6.97.A0.E6.B3.95.E7.BC.96.E8.BE.91.E9.93.BE.E6.8E.A5"></span><span class="mw-headline" id="普通用户无法编辑链接">普通用户无法编辑链接</span>
</h3>
<p>参见 <a href="#Set_up_PolicyKit_permissions">#Set_up_PolicyKit_permissions</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup>.
</p>
<h3>
<span id=".E5.88.A0.E9.99.A4.E9.9A.90.E8.94.BD.E6.97.A0.E7.BA.BF.E7.BD.91.E7.BB.9C.E9.93.BE.E6.8E.A5"></span><span class="mw-headline" id="删除隐蔽无线网络链接">删除隐蔽无线网络链接</span>
</h3>
<p>因为隐蔽无线网络不出现在无线列表中，所以不能在GUI中删除，你可以试用以下命令：
</p>
<pre># rm /etc/NetworkManager/system-connections/[SSID]
</pre>
<p>此命令对任何其他连接有效。
</p>
<h3>
<span id="GNOME_VPN.E5.A4.B1.E6.95.88.E9.97.AE.E9.A2.98"></span><span class="mw-headline" id="GNOME_VPN失效问题">GNOME VPN失效问题</span>
</h3>
<p>在<a href="../en/GNOME.html" title="GNOME">GNOME</a>系统中用NetworkManager 设立<a href="../en/OpenConnect.html" title="OpenConnect">OpenConnect</a>或VPN链接，有时会无法跳出对话框，在/var/log/errors.log中会出现如下错误提示：
</p>
<pre>localhost NetworkManager[399]: &lt;error&gt; [1361719690.10506] [nm-vpn-connection.c:1405] get_secrets_cb(): Failed to request VPN secrets #3: (6) No agents were available for this request.
</pre>
<p>这是由于Gnome NM Applet在/usr/lib/gnome-shell中读取脚本， 而NetworkManager安装包将脚本安装/usr/lib/networkmanager中（这个bug已经存在一段时间了）.
临时解决方法可以文件夹中创建软连接
</p>
<ul>
<li>对于OpenConnect: <code>ln -s /usr/lib/networkmanager/nm-openconnect-auth-dialog /usr/lib/gnome-shell/</code>
</li>
<li>对于VPNC (也即 Cisco VPN): <code>ln -s /usr/lib/networkmanager/nm-vpnc-auth-dialog /usr/lib/gnome-shell/</code>
</li>
</ul>
<p>对其他类型的NM VPN插件可能也需要做类似的事情，不过上述两种VPN是最常见的。
</p>
<h3><span class="mw-headline" id="Unable_to_connect_to_visible_European_wireless_networks">Unable to connect to visible European wireless networks</span></h3>
<p>WLAN chips are shipped with a default <a href="../en/Network_configuration/Wireless.html#Respecting_the_regulatory_domain" class="mw-redirect" title="Wireless network configuration">regulatory domain</a>. If your access point does not operate within these limitations, you will not be able to connect to the network. Fixing this is easy:
</p>
<ol>
<li>
<a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=crda">crda</a></span>
</li>
<li>Uncomment the correct Country Code in <code>/etc/conf.d/wireless-regdom</code>
</li>
<li>Reboot the system, because the setting is only read on boot</li>
</ol>
<h3>
<span id=".E5.BC.95.E5.AF.BC.E6.97.B6.E8.87.AA.E5.8A.A8.E8.BF.9E.E6.8E.A5.E5.88.B0VPN.E4.B8.8D.E5.B7.A5.E4.BD.9C"></span><span class="mw-headline" id="引导时自动连接到VPN不工作">引导时自动连接到VPN不工作</span>
</h3>
<p>问题原因在于，当系统(也即以root用户运行的NetworkManager)尝试建立一个VPN连接时无法获取密码，因为密码存储在一个特性用户的Gnome kerying中。
</p>
<p>解决的一个办法是用明文存储VPN密码，如<a href="#Use_dispatcher_to_connect_to_a_VPN_after_a_network_connection_is_established">#Use dispatcher to connect to a VPN after a network connection is established</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup>步骤(2.)中所描述。 
</p>
<p>如果你使用<code>nm-applet</code>GUI中的新的"auto-connect VPN"选项，你不再需要使用步骤(1.)所描述的分配器来自动连接。
</p>
<h3>
<span id="dhcpd.E4.B8.8D.E6.96.AD.E5.9C.B0.E6.8B.92.E7.BB.9D.E7.A7.9F.E7.BA.A6"></span><span class="mw-headline" id="dhcpd不断地拒绝租约">dhcpd不断地拒绝租约</span>
</h3>
<p>有人报告dhcpd不断地拒绝租约，同时大量产生如下日志消息：
</p>
<pre> dhcpcd[25188]: wlan0: NAK: from 10.1.0.1
 dhcpcd[25188]: wlan0: soliciting a DHCP lease
 dhcpcd[25188]: wlan0: offered 10.2.0.159 from 10.2.0.1
 dhcpcd[25188]: wlan0: ignoring offer of 10.1.0.197 from 10.1.0.1
 dhcpcd[25188]: wlan0: NAK: from 10.1.0.1
 dhcpcd[25188]: wlan0: soliciting a DHCP lease
 dhcpcd[25188]: wlan0: offered 10.2.0.159 from 10.2.0.1
 dhcpcd[25188]: wlan0: ignoring offer of 10.1.0.197 from 10.1.0.1
</pre>
<p>解决这个问题似乎可以通过切换到 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhclient">dhclient</a></span>而不是<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhcpcd">dhcpcd</a></span>(对于 NetworkManager,  在<code>/etc/NetworkManager/NetworkManager.conf</code>中设置<code>dhcp</code>选项为 <code>dhclient</code>).
</p>
<h3>
<span id="Systemd.E7.93.B6.E9.A2.88"></span><span class="mw-headline" id="Systemd瓶颈">Systemd瓶颈</span>
</h3>
<p>经过一段时间，日志文件(<code>/var/log/journal</code>)可能会变得非常庞大。当使用NetworkManager时，这可能对引导性能产生大的影响，参考：<a href="../en/Systemd.html#Boot_time_increasing_over_time" title="Systemd">Systemd#Boot time increasing over time</a>。
</p>
<h3>
<span id=".E7.BD.91.E7.BB.9C.28WiFi.29.E7.BB.8F.E5.B8.B8.E6.9C.89.E8.A7.84.E5.BE.8B.E5.9C.B0.E6.96.AD.E5.BC.80"></span><span class="mw-headline" id="网络(WiFi)经常有规律地断开">网络(WiFi)经常有规律地断开</span>
</h3>
<p>有些WIFI驱动如果在连接/关联的同时扫描基站会有问题。症状包括VPN断开/重连和丢包，页面无法加载但之后刷新没有问题。
</p>
<p>运行<code>journalctl -f</code>可以表明这种情况是否正在发生，和下面相似的信息会在日志文件中以有规律的间隔出现：
</p>
<pre>NetworkManager[410]: &lt;info&gt;  (wlp3s0): roamed from BSSID 00:14:48:11:20:CF (my-wifi-name) to (none) ((none))
</pre>
<p>有一个补丁版的NetworkManager应该可以阻止这种扫描：<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-noscan/">networkmanager-noscan</a></span><sup><small>AUR</small></sup>。
</p>
<h2>
<span id=".E6.8F.90.E7.A4.BA.E4.B8.8E.E6.8A.80.E5.B7.A7"></span><span class="mw-headline" id="提示与技巧">提示与技巧</span>
</h2>
<h3>
<span id=".E5.8A.A0.E5.AF.86.E7.9A.84Wi-Fi.E5.AF.86.E7.A0.81"></span><span class="mw-headline" id="加密的Wi-Fi密码">加密的Wi-Fi密码</span>
</h3>
<p>NetworkManager默认在连接文件<code>/etc/NetworkManager/system-connections/</code>中以明文存储密码。要打印存储的密码，使用下列命令：
</p>
<pre># grep -H '^psk=' /etc/NetworkManager/system-connections/*
</pre>
<p>密码可以被文件系统上的root用户以及可以通过GUI（例如<code>nm-applet</code>）访问设置的普通用户访问。
</p>
<p>以加密形式而不是明文存储密码更好，可以通过在秘钥环中存储它们来实现，NetworkManager之后会向秘钥环询问密码。建议使用的秘钥环守护进程是<a href="../en/GNOME/Keyring.html" class="mw-redirect" title="GNOME Keyring">GNOME Keyring</a>或者(仅适用于KDE)<a href="../en/KDE_Wallet.html" title="KDE Wallet">KDE Wallet</a>。 要想让之后的东西工作，秘钥环守护进程需要启动，并且秘钥环需要解锁。
</p>
<p>更进一步，NetworkManager需要配置为不为所有的用户存储密码。使用GNOME<code>nm-applet</code>，运行<code>nm-connection-editor</code>来获取一个终端，选择网络连接，点击<code>Edit</code>，选择 <code>Wifi-Security</code>选项卡单后点击密码右侧的图标，勾选<code>Store the password for this user</code>。使用KDE的<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=kdeplasma-applets-plasma-nm">kdeplasma-applets-plasma-nm</a></span><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：package not found]</sup>，点击小程序，点击右上方<code>Settings</code>图标，双击一个网络连接，在 <code>General settings</code>选项卡中，去掉<code>all users may connect to this network</code>。如果这个选项被勾选了，及时秘钥环守护进程在运行，密码也将会以明文存储。
</p>
<p>如果这个选项之前被选择了，然后你去掉了它，你可能需要先使用<code>reset</code>选项来使密码从文件中消失。或者，先删掉连接，然后重新建立。
</p>
<p>秘钥环的缺点是连接要为每一个用户设置。
</p>
<h3>
<span id=".E9.80.9A.E8.BF.87Wi-Fi.E5.85.B1.E4.BA.AB.E7.BD.91.E7.BB.9C.E8.BF.9E.E6.8E.A5"></span><span class="mw-headline" id="通过Wi-Fi共享网络连接">通过Wi-Fi共享网络连接</span>
</h3>
<p>使用nm，你只要点击几下就可以共享你的internet连接（例如，3G或者有线）。你需要一个支持的Wi-Fi卡（基于Atheros AR9xx或者至少AR5xx的网卡可能是最好的选择）。
</p>
<h4><span class="mw-headline" id="Ad-hoc">Ad-hoc</span></h4>
<ul>
<li>
<a href="../zh-CN/Help:Reading.html#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85" class="mw-redirect" title="安装">安装</a><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dnsmasq">dnsmasq</a></span>包来能够实际共享连接。</li>
<li>配置<code>dnsmasq.conf</code>可能会干扰NetworkManager (对此不确定，不过我觉得是这样)。</li>
<li>点击小程序，选择"Create new wireless network"。</li>
<li>按照指南 (如果使用WEP, 确保使用5到13字符长度的密码,其他的长度可能会失败)。</li>
<li>下次你需要的时候，设置依然在存储着。</li>
</ul>
<h4><span class="mw-headline" id="Real_AP">Real AP</span></h4>
<p>2012年底，NetworkManager添加了对infrastructure mode（安卓手机需要这个模式，因为他们故意不支持ad-hoc模式）的支持。
</p>
<p>参见 <a rel="nofollow" class="external text" href="https://fedoraproject.org/wiki/Features/RealHotspot">Fedora's wiki</a>.
</p>
<h3>
<span id=".E9.80.9A.E8.BF.87Ethernet.E5.85.B1.E4.BA.AB.E8.BF.9E.E6.8E.A5"></span><span class="mw-headline" id="通过Ethernet共享连接">通过Ethernet共享连接</span>
</h3>
<p>场景: 你的设备有通过wi-fi的internet连接，你想通过ethernet和其他设备共享internet连接。
</p>
<p>要求:
</p>
<ul>
<li>
<a href="../zh-CN/Help:Reading.html#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85" class="mw-redirect" title="安装">安装</a><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dnsmasq">dnsmasq</a></span>以能够真正地共享连接。</li>
<li>你的连有internet的设备和其他的设备通过合适的ethernet线缆连接（通常这意味着一个交叉线(cross over cable)或者之间有一个交换机（switch））</li>
</ul>
<p>步骤:
</p>
<ul>
<li>从终端运行<code>nm-connection-editor</code>
</li>
<li>添加一个新的ethernet连接</li>
<li>给它起一个合适的名字。比如"共享连接"</li>
<li>转到"IPv4 设置"（IPv4 settings）</li>
<li>对于"方法:"（method） 选择 "与其他电脑共享"（Shared to other computers）</li>
<li>保存</li>
</ul>
<p>现在，你在NetworkManager的有线连接下应该有了一个新"共享连接"的选项。
</p>
<h3>
<span id=".E5.9C.A8cron.E4.BB.BB.E5.8A.A1.EF.BC.88jobs.EF.BC.89.E6.88.96.E8.84.9A.E6.9C.AC.E4.B8.AD.E6.A3.80.E6.9F.A5.E7.BD.91.E7.BB.9C.E6.98.AF.E5.90.A6.E8.BF.9E.E6.8E.A5"></span><span class="mw-headline" id="在cron任务（jobs）或脚本中检查网络是否连接">在cron任务（jobs）或脚本中检查网络是否连接</span>
</h3>
<p>有些<i>cron</i>任务需要可用的网络连接才能成功。你可能希望在网络不可用时避免运行这些任务。为此，添加一个网络的<b>if</b> 测试，该测试询问NetworkManager的<i>nm-tool</i> 并检查网状态。下面展示的测试当任何接口可用时成功，当所有借口都不可用时失败。对于可能连接有线，无线或者关闭网络的笔记本来说这很方便。
</p>
<p><br>
</p>
<pre>if [ $(nm-tool|grep State|cut -f2 -d' ') == "connected" ]; then
    #Whatever you want to do if the network is online
else
    #Whatever you want to do if the network is offline - note, this and the else above are optional
fi
</pre>
<p>例如，这对于一个运行<i>fpupdate</i>来更新F-Prot病毒扫描签名的<code>cron.hourly</code>脚本很有帮助。另外，经过小的修改，使用<i>nm-tool</i>输出的不同部分可以区分不同的网络；例如，因为活跃的无线网络连接有一个星号（asterisk'*'）表示，你可以grep网络名，然后grep星号。
</p>
<h3>
<span id=".E7.99.BB.E9.99.86.E5.90.8E.E8.87.AA.E5.8A.A8.E8.A7.A3.E9.94.81.E7.A7.98.E9.92.A5.E7.8E.AF"></span><span class="mw-headline" id="登陆后自动解锁秘钥环">登陆后自动解锁秘钥环</span>
</h3>
<h4><span class="mw-headline" id="GNOME_2">GNOME</span></h4>
<ol>
<li>右击面板中的<code>nm-applet</code>图标，并选择编辑连接（Edit Connections），打开无线(wireless)选项卡</li>
<li>选择你想要使用的连接并单击编辑</li>
<li>勾选"自动连接"（“Connect Automatically”）框和"对所有用户可用"（“Available to all users”）框</li>
</ol>
<p>登出并重新登录，完成。
</p>
<p><br>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 下述方法已经年代久远，并且已知在至少一个机器上不能工作</div>
<ul><li>在<code>/etc/pam.d/gdm</code> (或者 <code>/etc/pam.d</code>里你相应的守护进程中),如果"auth"和"session"块不存在，在后面添加如下内容：</li></ul>
<pre> auth            optional        pam_gnome_keyring.so
 session         optional        pam_gnome_keyring.so  auto_start
</pre>
<ul><li>在<code>/etc/pam.d/passwd</code>中, 使用这一行替代'password'块:</li></ul>
<pre> password    optional    pam_gnome_keyring.so
</pre>
<dl><dd>下次登录时，你会被询问你是否希望密码在登录时自动解锁。</dd></dl>
<h3>
<span id=".E6.9C.89.E5.AF.86.E7.A0.81.E8.AE.A4.E8.AF.81.E7.9A.84KDE_and_OpenConnect_VPN"></span><span class="mw-headline" id="有密码认证的KDE_and_OpenConnect_VPN">有密码认证的KDE and OpenConnect VPN</span>
</h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=kdeplasma-applets-plasma-nm">kdeplasma-applets-plasma-nm</a></span><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：package not found]</sup>现在支持配置OpenConnect VPN连接的用户名和密码。打开你的VPN连接，接受证书，连接域会出现。如果没有，看下面的指令，现在输入正确的用户名和密码。
</p>
<p>==== 问题解决 ====‘
</p>
<p>虽然你可能在连接时输入两个值，<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=kdeplasma-applets-plasma-nm">kdeplasma-applets-plasma-nm</a></span><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：package not found]</sup> 0.9.3.2-1及以上版本能够直接从KWallet中获取OpenConnect用户名和密码。
</p>
<p>打开"KDE Wallet Manager"在"Network Management|Maps"下面查找你的OpenConnect VPN连接。点击"Show values"并在这个表的键值"VpnSecrets"下输入你的凭据（相应替代'username'和'password'）:
</p>
<pre>form:main:username%SEP%<i>username</i>%SEP%form:main:password%SEP%<i>password</i>
</pre>
<p>下次你连接时，用户名和密码会出现在"VPN secrets"对话框中。
</p>
<h3>
<span id=".E5.BF.BD.E7.95.A5.E7.89.B9.E5.AE.9A.E8.AE.BE.E5.A4.87"></span><span class="mw-headline" id="忽略特定设备">忽略特定设备</span>
</h3>
<p>有时，可能希望Networkmanager忽略特定的设备，并且不为他们配置地址和路由。通过在<code>/etc/NetworkManager/NetworkManager.conf</code>中使用下述配置，你可以快速轻松地按照MAC或者接口名忽略设备。
</p>
<pre>[keyfile]
unmanaged-devices=mac:00:22:68:1c:59:b1;mac:00:1E:65:30:D1:C4;interface-name:eth0
</pre>
<p>填入上述内容后，<a href="../zh-CN/Daemons.html" title="Daemons (简体中文)">重启</a>NetworkManager，然后你应该能够在NetworkManager不改变你已经完成的设置的情况下配置接口。
</p>
<h3>
<span id=".E5.90.AF.E7.94.A8DNS.E7.BC.93.E5.AD.98"></span><span class="mw-headline" id="启用DNS缓存">启用DNS缓存</span>
</h3>
<p>使用<a href="../en/Dnsmasq.html" title="Dnsmasq">dnsmasq</a>来启用允许DNS缓存的插件参见 <a href="../en/Dnsmasq.html#NetworkManager" title="Dnsmasq">dnsmasq#NetworkManager</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup>
</p>
<h3>
<span id=".E5.90.AF.E7.94.A8IPv6.E9.9A.90.E7.A7.81.E6.89.A9.E5.B1.95"></span><span class="mw-headline" id="启用IPv6隐私扩展">启用IPv6隐私扩展</span>
</h3>
<p>参见 <a href="../en/IPv6.html#NetworkManager" title="IPv6">IPv6#NetworkManager</a>
</p>
<h2>
<span id=".E5.85.B6.E5.AE.83.E8.B5.84.E6.BA.90"></span><span class="mw-headline" id="其它资源">其它资源</span>
</h2>
<ul>
<li>
<a href="../en/Network_configuration/Wireless.html" class="mw-redirect" title="Wireless network configuration">Wireless network configuration</a> -- 无线配置(wiki)</li>
<li>
<a rel="nofollow" class="external text" href="https://www.gnome.org/projects/NetworkManager/">NetworkManager</a> - 网络管理器的官方主页</li>
<li><a rel="nofollow" class="external text" href="https://blogs.gnome.org/dcbw/2015/02/16/networkmanager-for-administrators-part-1/">NetworkManager for Administrators Part 1</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../zh-CN/Category:Network_managers.html" title="Category:Network managers (简体中文)">Network managers (简体中文)</a></li>
<li><a href="../zh-CN/Category:Red_Hat.html" title="Category:Red Hat (简体中文)">Red Hat (简体中文)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
<li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=NetworkManager_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=639935">https://wiki.archlinux.org/index.php?title=NetworkManager_(简体中文)&amp;oldid=639935</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 28 October 2020, at 04:07.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
