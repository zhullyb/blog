<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Microcode (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Microcode_Русский rootpage-Microcode_Русский skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Microcode (Русский)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="../en/Microcode.html" title="Microcode">Microcode</a>. Дата последней синхронизации: 29 ноября 2018. Вы можете <a href="../ru/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Microcode&amp;diff=0&amp;oldid=557775">изменения</a>.</div>
<p>Производители процессоров выпускают обновления стабильности и безопасности для <a href="https://en.wikipedia.org/wiki/ru:%D0%9C%D0%B8%D0%BA%D1%80%D0%BE%D0%BA%D0%BE%D0%B4" class="extiw" title="wikipedia:ru:Микрокод">микрокода</a> процессора. Несмотря на то, что микрокод можно обновить с помощью BIOS, ядро Linux также может применять эти обновления во время загрузки. Эти обновления предоставляют исправления ошибок, которые могут быть критичны для стабильности вашей системы. Без этих обновлений вы можете наблюдать ложные падения или неожиданные зависания системы, которые может быть сложно отследить.
</p>
<p>Особенно пользователи процессоров семейства Intel Haswell и Broadwell должны установить эти обновления, чтобы обеспечить стабильность системы. Но, понятное дело, все пользователи должны устанавливать эти обновления.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0"><span class="tocnumber">1</span> <span class="toctext">Установка</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D1%80%D0%B0%D0%BD%D0%BD%D0%B5%D0%B3%D0%BE_%D0%BE%D0%B1%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F_%D0%BC%D0%B8%D0%BA%D1%80%D0%BE%D0%BA%D0%BE%D0%B4%D0%B0"><span class="tocnumber">2</span> <span class="toctext">Включение раннего обновления микрокода</span></a>
<ul>
<li class="toclevel-2 tocsection-3">
<a href="#GRUB"><span class="tocnumber">2.1</span> <span class="toctext">GRUB</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D1%81%D0%BF%D0%BE%D1%81%D0%BE%D0%B1"><span class="tocnumber">2.1.1</span> <span class="toctext">Автоматический способ</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#%D0%A0%D1%83%D1%87%D0%BD%D0%BE%D0%B9_%D1%81%D0%BF%D0%BE%D1%81%D0%BE%D0%B1"><span class="tocnumber">2.1.2</span> <span class="toctext">Ручной способ</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-6"><a href="#systemd-boot"><span class="tocnumber">2.2</span> <span class="toctext">systemd-boot</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#EFI_boot_stub_/_EFI_handover"><span class="tocnumber">2.3</span> <span class="toctext">EFI boot stub / EFI handover</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#rEFInd"><span class="tocnumber">2.4</span> <span class="toctext">rEFInd</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Syslinux"><span class="tocnumber">2.5</span> <span class="toctext">Syslinux</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#LILO"><span class="tocnumber">2.6</span> <span class="toctext">LILO</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11">
<a href="#%D0%9F%D0%BE%D0%B7%D0%B4%D0%BD%D0%B5%D0%B5_%D0%BE%D0%B1%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BC%D0%B8%D0%BA%D1%80%D0%BE%D0%BA%D0%BE%D0%B4%D0%B0"><span class="tocnumber">3</span> <span class="toctext">Позднее обновление микрокода</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%B7%D0%B4%D0%BD%D0%B5%D0%B3%D0%BE_%D0%BE%D0%B1%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F_%D0%BC%D0%B8%D0%BA%D1%80%D0%BE%D0%BA%D0%BE%D0%B4%D0%B0"><span class="tocnumber">3.1</span> <span class="toctext">Включение позднего обновления микрокода</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#%D0%9E%D1%82%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%B7%D0%B4%D0%BD%D0%B5%D0%B3%D0%BE_%D0%BE%D0%B1%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F_%D0%BC%D0%B8%D0%BA%D1%80%D0%BE%D0%BA%D0%BE%D0%B4%D0%B0"><span class="tocnumber">3.2</span> <span class="toctext">Отключение позднего обновления микрокода</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-14"><a href="#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%B8%D0%BC,_%D0%BE%D0%B1%D0%BD%D0%BE%D0%B2%D0%B8%D0%BB%D1%81%D1%8F_%D0%BB%D0%B8_microcode_%D0%BF%D1%80%D0%B8_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B5"><span class="tocnumber">4</span> <span class="toctext">Проверим, обновился ли microcode при загрузке</span></a></li>
<li class="toclevel-1 tocsection-15">
<a href="#%D0%9A%D0%B0%D0%BA%D0%B8%D0%BC_%D0%A6%D0%9F_%D0%BD%D1%83%D0%B6%D0%BD%D1%8B_%D0%BE%D0%B1%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F_%D0%BC%D0%B8%D0%BA%D1%80%D0%BE%D0%BA%D0%BE%D0%B4%D0%B0"><span class="tocnumber">5</span> <span class="toctext">Каким ЦП нужны обновления микрокода</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="#%D0%9E%D0%B1%D0%BD%D0%B0%D1%80%D1%83%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BD%D0%BE%D0%B3%D0%BE_%D0%BE%D0%B1%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F_%D0%BC%D0%B8%D0%BA%D1%80%D0%BE%D0%BA%D0%BE%D0%B4%D0%B0"><span class="tocnumber">5.1</span> <span class="toctext">Обнаружение доступного обновления микрокода</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-17"><a href="#%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D1%80%D0%B0%D0%BD%D0%BD%D0%B5%D0%B9_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B8_%D0%BC%D0%B8%D0%BA%D1%80%D0%BE%D0%BA%D0%BE%D0%B4%D0%B0_%D0%B2_%D0%BA%D0%B0%D1%81%D1%82%D0%BE%D0%BC%D0%BD%D1%8B%D1%85_%D1%8F%D0%B4%D1%80%D0%B0%D1%85"><span class="tocnumber">6</span> <span class="toctext">Применение ранней загрузки микрокода в кастомных ядрах</span></a></li>
<li class="toclevel-1 tocsection-18"><a href="#%D0%A1%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82%D0%B5_%D1%82%D0%B0%D0%BA%D0%B6%D0%B5"><span class="tocnumber">7</span> <span class="toctext">Смотрите также</span></a></li>
</ul>
</div>

<h2>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0"></span><span class="mw-headline" id="Установка">Установка</span>
</h2>
<p>Для процессоров AMD <a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">установите</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=amd-ucode">amd-ucode</a></span>.
</p>
<p>Для процессоров Intel <a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">установите</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=intel-ucode">intel-ucode</a></span>.
</p>
<p>Если Arch находится на <a href="../en/Install_Arch_Linux_on_a_removable_medium.html" class="mw-redirect" title="Installing Arch Linux on a USB key">съемном носителе</a>, вы должны установить микрокод для обоих производителей процессоров.
</p>
<h2>
<span id=".D0.92.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D1.80.D0.B0.D0.BD.D0.BD.D0.B5.D0.B3.D0.BE_.D0.BE.D0.B1.D0.BD.D0.BE.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D1.8F_.D0.BC.D0.B8.D0.BA.D1.80.D0.BE.D0.BA.D0.BE.D0.B4.D0.B0"></span><span class="mw-headline" id="Включение_раннего_обновления_микрокода">Включение раннего обновления микрокода</span>
</h2>
<p>Микрокод должен быть загружен <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Загрузчик">загрузчик</a>ом. Из-за большого разнообразия конфигураций ранней загрузки у пользователей обновления микрокода могут быть не применены автоматически конфигурацией Arch по умолчанию. Многие <a href="../ru/Kernel.html" class="mw-redirect" title="Ядра">ядра</a> в AUR пошли по пути официальных ядер Arch в этом вопросе.
</p>
<p>Чтобы применить эти обновления, добавьте <code>/boot/amd-ucode.img</code> или <code>/boot/intel-ucode.img</code> в качестве <b>первого initrd в конфигурационном файле загрузчика</b>. Это в дополнение к обычному initrd файлу. Смотрите ниже инструкции для популярных загрузчиков.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> В следующих разделах замените строку <code><i>производитель_цп</i></code> вашим производителем, например, <code>amd</code> или <code>intel</code>.</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Для <a href="../en/Install_Arch_Linux_on_a_removable_medium.html" class="mw-redirect" title="Installing Arch Linux on a USB key">Arch Linux на съемном носителе</a> добавьте оба файла <code>initrd</code> в настройки загрузчика. Их порядок не имеет значения, если они оба указаны до реального образа initramfs.</div>
<h3><span class="mw-headline" id="GRUB">GRUB</span></h3>
<h4>
<span id=".D0.90.D0.B2.D1.82.D0.BE.D0.BC.D0.B0.D1.82.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B9_.D1.81.D0.BF.D0.BE.D1.81.D0.BE.D0.B1"></span><span class="mw-headline" id="Автоматический_способ">Автоматический способ</span>
</h4>
<p>Утилита <i>grub-mkconfig</i> автоматически определит обновления микрокода и настроит соответственным образом <a href="../ru/GRUB.html" title="GRUB (Русский)">GRUB</a>. После установки пакета микрокода, перегенерируйте настройки GRUB, чтобы включить обновление микрокода при запуске:
</p>
<pre># grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<h4>
<span id=".D0.A0.D1.83.D1.87.D0.BD.D0.BE.D0.B9_.D1.81.D0.BF.D0.BE.D1.81.D0.BE.D0.B1"></span><span class="mw-headline" id="Ручной_способ">Ручной способ</span>
</h4>
<p>Альтернативно пользователи, управляющие настройками GRUB вручную, могут добавить <code>/boot/<i>производитель_цп</i>-ucode.img</code> (или <code>/<i>производитель_цп</i>-ucode.img</code>, если есть отдельный раздел <code>/boot</code>) следующим образом:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/boot/grub/grub.cfg</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
echo 'Loading initial ramdisk'
initrd <b>/boot/<i>производитель_цп</i>-ucode.img</b> /boot/initramfs-linux.img
...
</pre>
<p>Повторите это для каждой записи в меню.
</p>
<h3><span class="mw-headline" id="systemd-boot">systemd-boot</span></h3>
<p>Используйте параметры <code>initrd</code> для загрузки микрокода перед исходным ramdisk следующим образом:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/boot/loader/entries/<i>запись</i>.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">title   Arch Linux
linux   /vmlinuz-linux
<b>initrd  /<i>производитель_цп</i>-ucode.img</b>
initrd  /initramfs-linux.img
...
</pre>
<p>Самый последний микрокод <code><i>производитель_цп</i>-ucode.img</code> должен быть доступен во время загрузки вашего <a href="../ru/EFI_system_partition.html" class="mw-redirect" title="Системный раздел EFI">системного раздела EFI</a> (ESP). ESP должен быть смонтирован как <code>/boot</code>, чтобы обновлять микрокод каждый раз, когда обновляется <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=amd-ucode">amd-ucode</a></span> или <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=intel-ucode">intel-ucode</a></span>. В противном случае копируйте <code>/boot/<i>производитель_цп</i>-ucode.img</code> в ваш ESP при каждом обновлении пакета микрокода.
</p>
<h3>
<span id="EFI_boot_stub_.2F_EFI_handover"></span><span class="mw-headline" id="EFI_boot_stub_/_EFI_handover">EFI boot stub / EFI handover</span>
</h3>
<p>Добавьте два параметра <code>initrd=</code>:
</p>
<pre><b>initrd=/<i>производитель_цп</i>-ucode.img</b> initrd=/initramfs-linux.img
</pre>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Что это делает, почему этого недостаточно, и почему/как это специфично для данного раздела? (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Microcode_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#Addition_in_EFI_Boot_stub">Talk:Microcode (Русский)#Addition in EFI Boot stub</a>)</div>
</div>
<p>Для ядер, которые были сгенерированы как один файл, содержащий все initrd, cmdline и ядро, сначала сгенерируйте initrd для интеграции, создав новый, следующим образом:
</p>
<pre>cat /boot/<i>производитель_цп</i>-ucode.img /boot/initramfs-linux.img &gt; my_new_initrd
objcopy ... --add-section .initrd=my_new_initrd</pre>
<h3><span class="mw-headline" id="rEFInd">rEFInd</span></h3>
<p>Отредактируйте опции загрузки в <code>/boot/refind_linux.conf</code> также как в примере EFI boot stub выше, например:
</p>
<pre>"Boot with standard options" "rw root=UUID=(...) <b>initrd=/boot/<i>производитель_цп</i>-ucode.img</b> initrd=/boot/initramfs-linux.img"
</pre>
<p>Пользователи, использующие <a href="../en/REFInd.html#Manual_boot_stanzas" title="REFInd">ручные строфы</a> в <code><i>esp</i>/EFI/refind/refind.conf</code> для определения ядер, должны просто добавить <code>initrd=/boot/<i>производитель_цп</i>-ucode.img</code> (или <code>/<i>производитель_цп</i>-ucode.img</code>, если есть отдельный раздел <code>/boot</code>), как требуется для строки опций, а не в основной части строфы. Например:
</p>
<pre>options  "root=root=UUID=(...) rw add_efi_memmap <b>initrd=/boot/<i>производитель_цп</i>-ucode.img</b>"
</pre>
<h3><span class="mw-headline" id="Syslinux">Syslinux</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Между указаниями файлов initrd <code><i>производитель_цп</i>-ucode.img</code> и <code>initramfs-linux.img</code> не должно быть пробелов. Строка <code>INITRD</code> должна быть точно такой, как показано ниже.</div>
<p>Несколько файлов initrd могут быть разделены запятыми в <code>/boot/syslinux/syslinux.cfg</code>:
</p>
<pre>LABEL arch
    MENU LABEL Arch Linux
    LINUX ../vmlinuz-linux
    INITRD <b>../<i>производитель_цп</i>-ucode.img</b>,../initramfs-linux.img
...
</pre>
<h3><span class="mw-headline" id="LILO">LILO</span></h3>
<p>LILO и потенциально другие старые загрузчики не поддерживают несколько образов initrd. В этом случае необходимо объединить <code><i>производитель_цп</i>-ucode.img</code> и <code>initramfs-linux.img</code> в один образ.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Объединенный образ нужно пересоздавать после каждого обновления ядра!</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Порядок важен. Исходный образ <code>initramfs-linux.img</code> должен находиться <b>сверху</b> над образом <code><i>производитель_цп</i>-ucode.img</code>.</div>
<p>Чтобы объединить образы в один <code>initramfs-merged.img</code>, можно использовать следующую команду:
</p>
<pre># cat /boot/<i>производитель_цп</i>-ucode.img /boot/initramfs-linux.img &gt; /boot/initramfs-merged.img
</pre>
<p>Теперь отредактируйте <code>/etc/lilo.conf</code> для загрузки нового образа.
</p>
<pre>...
initrd=/boot/initramfs-merged.img
...
</pre>
<p>И запустите <code>lilo</code> от суперпользователя:
</p>
<pre># lilo
</pre>
<h2>
<span id=".D0.9F.D0.BE.D0.B7.D0.B4.D0.BD.D0.B5.D0.B5_.D0.BE.D0.B1.D0.BD.D0.BE.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BC.D0.B8.D0.BA.D1.80.D0.BE.D0.BA.D0.BE.D0.B4.D0.B0"></span><span class="mw-headline" id="Позднее_обновление_микрокода">Позднее обновление микрокода</span>
</h2>
<p>Поздняя загрузка обновления микрокода происходит после запуска системы. Для этого используются файлы в <code>/usr/lib/firmware/amd-ucode/</code> и <code>/usr/lib/firmware/intel-ucode/</code>.
</p>
<p>Для процессоров AMD файлы обновления микрокода предоставляются пакетом <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-firmware">linux-firmware</a></span>.
</p>
<p>Для процессоров Intel ни один пакет не предоставляет файлы обновления микрокода (<a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/59841">FS#59841</a>). Чтобы использовать позднюю загрузку, вам необходимо вручную извлечь <code>intel-ucode/</code> из предоставленного Intel архива.
</p>
<h3>
<span id=".D0.92.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D0.BE.D0.B7.D0.B4.D0.BD.D0.B5.D0.B3.D0.BE_.D0.BE.D0.B1.D0.BD.D0.BE.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D1.8F_.D0.BC.D0.B8.D0.BA.D1.80.D0.BE.D0.BA.D0.BE.D0.B4.D0.B0"></span><span class="mw-headline" id="Включение_позднего_обновления_микрокода">Включение позднего обновления микрокода</span>
</h3>
<p>В отличие от ранней загрузки, поздняя загрузка обновлений микрокода в Arch Linux включена по умолчанию, используя <code>/usr/lib/tmpfiles.d/linux-firmware.conf</code>. После загрузки файл анализируется с помощью <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-tmpfiles-setup.service"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-tmpfiles-setup.service.8">systemd-tmpfiles-setup.service(8)</a></span>, а микрокод ЦП обновляется.
</p>
<p>Для ручного обновления микрокода на запущенной системе запустите:
</p>
<pre># echo 1 &gt; /sys/devices/system/cpu/microcode/reload
</pre>
<p>Это позволяет применять обновления микрокода после обновления <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-firmware">linux-firmware</a></span> без перезагрузки системы. Вы можете даже автоматизировать это с помощью <a href="../ru/Pacman.html#%D0%A5%D1%83%D0%BA%D0%B8" title="Pacman (Русский)">хука pacman</a>, например:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/hooks/microcode_reload.hook</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Trigger]
Operation = Install
Operation = Upgrade
Operation = Remove
Type = File
Target = usr/lib/firmware/amd-ucode/*	

[Action]
Description = Applying CPU microcode updates...
When = PostTransaction
Depends = sh
Exec = /bin/sh -c 'echo 1 &gt; /sys/devices/system/cpu/microcode/reload'</pre>
<h3>
<span id=".D0.9E.D1.82.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D0.BE.D0.B7.D0.B4.D0.BD.D0.B5.D0.B3.D0.BE_.D0.BE.D0.B1.D0.BD.D0.BE.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D1.8F_.D0.BC.D0.B8.D0.BA.D1.80.D0.BE.D0.BA.D0.BE.D0.B4.D0.B0"></span><span class="mw-headline" id="Отключение_позднего_обновления_микрокода">Отключение позднего обновления микрокода</span>
</h3>
<p>Для систем AMD микрокод процессора будет обновляться, даже если пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=amd-ucode">amd-ucode</a></span> не установлен, так как файлы предоставлены <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-firmware">linux-firmware</a></span> (<a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/59840">FS#59840</a>). Чтобы отключить позднюю загрузку, вы должны переопределить <a href="../ru/Systemd.html#systemd-tmpfiles_%E2%80%94_%D0%B2%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D1%8B" title="Systemd (Русский)">временные файлы</a> <code>/usr/lib/tmpfiles.d/linux-firmware.conf</code>. Это можно сделать, создав файл с тем же именем в <code>/etc/tmpfiles.d/</code>:
</p>
<pre># ln -s /dev/null /etc/tmpfiles.d/linux-firmware.conf
</pre>
<h2>
<span id=".D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.B8.D0.BC.2C_.D0.BE.D0.B1.D0.BD.D0.BE.D0.B2.D0.B8.D0.BB.D1.81.D1.8F_.D0.BB.D0.B8_microcode_.D0.BF.D1.80.D0.B8_.D0.B7.D0.B0.D0.B3.D1.80.D1.83.D0.B7.D0.BA.D0.B5"></span><span class="mw-headline" id="Проверим,_обновился_ли_microcode_при_загрузке">Проверим, обновился ли microcode при загрузке</span>
</h2>
<p>Чтобы убедиться, что микрокод обновился, воспользуемся <i>dmesg</i>:
</p>
<pre>$ dmesg | grep microcode
</pre>
<p>На системах Intel вы должны увидеть что-то похожее на это при каждой загрузке, что говорит о том, что микрокод обновился рано:
</p>
<pre>[    0.000000] CPU0 microcode updated early to revision 0x1b, date = 2014-05-29
[    0.221951] CPU1 microcode updated early to revision 0x1b, date = 2014-05-29
[    0.242064] CPU2 microcode updated early to revision 0x1b, date = 2014-05-29
[    0.262349] CPU3 microcode updated early to revision 0x1b, date = 2014-05-29
[    0.507267] microcode: CPU0 sig=0x306a9, pf=0x2, revision=0x1b
[    0.507272] microcode: CPU1 sig=0x306a9, pf=0x2, revision=0x1b
[    0.507276] microcode: CPU2 sig=0x306a9, pf=0x2, revision=0x1b
[    0.507281] microcode: CPU3 sig=0x306a9, pf=0x2, revision=0x1b
[    0.507286] microcode: CPU4 sig=0x306a9, pf=0x2, revision=0x1b
[    0.507292] microcode: CPU5 sig=0x306a9, pf=0x2, revision=0x1b
[    0.507296] microcode: CPU6 sig=0x306a9, pf=0x2, revision=0x1b
[    0.507300] microcode: CPU7 sig=0x306a9, pf=0x2, revision=0x1b
[    0.507335] microcode: Microcode Update Driver: v2.2.
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Отображаемая дата отвечает не за версию установленного пакета <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=intel-ucode">intel-ucode</a></span>. Это дата последнего обновления микрокода от Intel для вашего конкретного процессора.</div>
<p>Вполне возможно, особенно с новым аппаратным обеспечением, что для вашего CPU нет обновления микрокода. В этом случае вы можете увидеть примерно следующее:
</p>
<pre>[    0.292893] microcode: CPU0 sig=0x306c3, pf=0x2, revision=0x1c
[    0.292899] microcode: CPU1 sig=0x306c3, pf=0x2, revision=0x1c
[    0.292906] microcode: CPU2 sig=0x306c3, pf=0x2, revision=0x1c
[    0.292912] microcode: CPU3 sig=0x306c3, pf=0x2, revision=0x1c
[    0.292956] microcode: Microcode Update Driver: v2.2.
</pre>
<p>На системах AMD, использующих раннюю загрузку, вывод будет выглядеть примерно так:
</p>
<pre>[    2.119089] microcode: microcode updated early to new patch_level=0x0700010f
[    2.119157] microcode: CPU0: patch_level=0x0700010f
[    2.119171] microcode: CPU1: patch_level=0x0700010f
[    2.119183] microcode: CPU2: patch_level=0x0700010f
[    2.119189] microcode: CPU3: patch_lev
[    2.119269] microcode: Microcode Update Driver: v2.2.
</pre>
<p>На системах AMD, использующих позднюю загрузку, в выводе будет отображаться версия старого микрокода перед перезагрузкой микрокода, а новая - после перезагрузки. Это будет выглядеть примерно так:
</p>
<pre>[    2.112919] microcode: CPU0: patch_level=0x0700010b
[    2.112931] microcode: CPU1: patch_level=0x0700010b
[    2.112940] microcode: CPU2: patch_level=0x0700010b
[    2.112951] microcode: CPU3: patch_level=0x0700010b
[    2.113043] microcode: Microcode Update Driver: v2.2.
[    6.429109] microcode: CPU2: new patch_level=0x0700010f
[    6.430416] microcode: CPU0: new patch_level=0x0700010f
[    6.431722] microcode: CPU1: new patch_level=0x0700010f
[    6.433029] microcode: CPU3: new patch_level=0x0700010f
[    6.433073] x86/CPU: CPU features have changed after loading microcode, but might not take effect.
</pre>
<h2>
<span id=".D0.9A.D0.B0.D0.BA.D0.B8.D0.BC_.D0.A6.D0.9F_.D0.BD.D1.83.D0.B6.D0.BD.D1.8B_.D0.BE.D0.B1.D0.BD.D0.BE.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D1.8F_.D0.BC.D0.B8.D0.BA.D1.80.D0.BE.D0.BA.D0.BE.D0.B4.D0.B0"></span><span class="mw-headline" id="Каким_ЦП_нужны_обновления_микрокода">Каким ЦП нужны обновления микрокода</span>
</h2>
<p>Пользователи могут проконсультироваться как у Intel, так и у AMD насчёт поддержки конкретной модели процессора, перейдя по следующим ссылкам:
</p>
<ul>
<li>
<a rel="nofollow" class="external text" href="http://www.amd64.org/microcode.html">Исследовательский центр операционной системы AMD (англ)</a>.</li>
<li>
<a rel="nofollow" class="external text" href="https://downloadcenter.intel.com/SearchResult.aspx?lang=ru&amp;keyword=processor%20microcode%20data%20file">Центр загрузки Intel</a>.</li>
</ul>
<h3>
<span id=".D0.9E.D0.B1.D0.BD.D0.B0.D1.80.D1.83.D0.B6.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF.D0.BD.D0.BE.D0.B3.D0.BE_.D0.BE.D0.B1.D0.BD.D0.BE.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D1.8F_.D0.BC.D0.B8.D0.BA.D1.80.D0.BE.D0.BA.D0.BE.D0.B4.D0.B0"></span><span class="mw-headline" id="Обнаружение_доступного_обновления_микрокода">Обнаружение доступного обновления микрокода</span>
</h3>
<p>Вы можете узнать, содержит ли <code>intel-ucode.img</code> образ микрокода для вашего процессора с помощью <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iucode-tool">iucode-tool</a></span>.
</p>
<ol>
<li>Установите <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=intel-ucode">intel-ucode</a></span> (для обнаружения обновления не требуется менять initrd)</li>
<li>Установите <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iucode-tool">iucode-tool</a></span>
</li>
<li><pre># modprobe cpuid</pre></li>
<li>Извлекает образ микрокода и ищет в нём ваш cpuid:<br><pre># bsdtar -Oxf /boot/intel-ucode.img | iucode_tool -tb -lS -</pre>
</li>
<li>Если обновление доступно, оно должно отобразиться под <i>selected microcodes</i>
</li>
<li>Микрокод может уже быть в вашем биосе и его загрузка может не отображаться в dmesg. Сравните с текущим запуском микрокода {ic|grep microcode /proc/cpuinfo}}</li>
</ol>
<h2>
<span id=".D0.9F.D1.80.D0.B8.D0.BC.D0.B5.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5_.D1.80.D0.B0.D0.BD.D0.BD.D0.B5.D0.B9_.D0.B7.D0.B0.D0.B3.D1.80.D1.83.D0.B7.D0.BA.D0.B8_.D0.BC.D0.B8.D0.BA.D1.80.D0.BE.D0.BA.D0.BE.D0.B4.D0.B0_.D0.B2_.D0.BA.D0.B0.D1.81.D1.82.D0.BE.D0.BC.D0.BD.D1.8B.D1.85_.D1.8F.D0.B4.D1.80.D0.B0.D1.85"></span><span class="mw-headline" id="Применение_ранней_загрузки_микрокода_в_кастомных_ядрах">Применение ранней загрузки микрокода в кастомных ядрах</span>
</h2>
<p>Для того, чтобы ранняя загрузка работала в кастомных ядрах, "CPU microcode loading support" должен быть вкомпилирован в ядро, а <b>не</b> скомпилирован как модуль. Это включает приглашение "Early load microcode", которое должно быть установлено в <code>Y</code>. 
</p>
<pre>CONFIG_BLK_DEV_INITRD=Y
CONFIG_MICROCODE=y
CONFIG_MICROCODE_INTEL=Y
CONFIG_MICROCODE_AMD=y
</pre>
<h2>
<span id=".D0.A1.D0.BC.D0.BE.D1.82.D1.80.D0.B8.D1.82.D0.B5_.D1.82.D0.B0.D0.BA.D0.B6.D0.B5"></span><span class="mw-headline" id="Смотрите_также">Смотрите также</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://flossexperiences.wordpress.com/2013/11/17/updating-microcodes/">Обновление микрокодов - Опыт сообщества (англ)</a></li>
<li><a rel="nofollow" class="external text" href="http://inertiawar.com/microcode/">Замечания по обновлению микрокода Intel - Ben Hawkes (англ)</a></li>
<li><a rel="nofollow" class="external text" href="https://www.kernel.org/doc/html/latest/x86/microcode.html">Загрузчик микрокода ядра - документация ядра (англ)</a></li>
<li><a rel="nofollow" class="external text" href="http://www.anandtech.com/show/8376/intel-disables-tsx-instructions-erratum-found-in-haswell-haswelleep-broadwelly">Erratum найден в Haswell/Broadwell – AnandTech (англ)</a></li>
<li><a rel="nofollow" class="external text" href="https://gitlab.com/iucode-tool/iucode-tool">проект iucode-tool на GitLab (англ)</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../ru/Category:CPU.html" title="Category:CPU (Русский)">CPU (Русский)</a></li>
<li><a href="../ru/Category:Security.html" title="Category:Security (Русский)">Security (Русский)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li></ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Microcode_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=631372">https://wiki.archlinux.org/index.php?title=Microcode_(Русский)&amp;oldid=631372</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 12 August 2020, at 08:16.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
