<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Internet key Momo Design (Italiano) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Internet_key_Momo_Design_Italiano rootpage-Internet_key_Momo_Design_Italiano skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Internet key Momo Design (Italiano)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Many style violations. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Internet_key_Momo_Design_(Italiano)">Talk:Internet key Momo Design (Italiano)#</a>)</div>
</div>
<p>Il Momo design è un 3.5G HSDPA USB modem usato per la navigazione in internet. La sua installazione può risultare un po' ostica su linux visto che i produttori non rilasciano driver specifici per linux.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Hardware"><span class="tocnumber">1</span> <span class="toctext">Hardware</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Prima_di_tutto"><span class="tocnumber">2</span> <span class="toctext">Prima di tutto</span></a></li>
<li class="toclevel-1 tocsection-3">
<a href="#Connessione_con_wvdial"><span class="tocnumber">3</span> <span class="toctext">Connessione con wvdial</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Packages"><span class="tocnumber">3.1</span> <span class="toctext">Packages</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Scripting"><span class="tocnumber">3.2</span> <span class="toctext">Scripting</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Connessione"><span class="tocnumber">3.3</span> <span class="toctext">Connessione</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7">
<a href="#Connessione_con_ppp"><span class="tocnumber">4</span> <span class="toctext">Connessione con ppp</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#Configurazione"><span class="tocnumber">4.1</span> <span class="toctext">Configurazione</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Connessione_2"><span class="tocnumber">4.2</span> <span class="toctext">Connessione</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10">
<a href="#Regolazione_dei_dettagli"><span class="tocnumber">5</span> <span class="toctext">Regolazione dei dettagli</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#Verifica_dello_stato_della_connessione"><span class="tocnumber">5.1</span> <span class="toctext">Verifica dello stato della connessione</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="#Links"><span class="tocnumber">6</span> <span class="toctext">Links</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Hardware">Hardware</span></h1>
<p>Nel momento della connessione al pc dovremmo vedere con <i>dmesg</i> quanto segue:
</p>
<pre>cdc_acm 2-1:1.0: ttyACM0: USB ACM device
usbcore: registered new interface driver cdc_acm
cdc_acm: v0.26:USB Abstract Control Model driver for USB modems and ISDN adapters
</pre>
<p>Questo significa che il nostro modem sta lavorando su <b>ttyACM0</b>, una porta virtuale, ed è qui che dovremo configuarlo.
</p>
<h1><span class="mw-headline" id="Prima_di_tutto">Prima di tutto</span></h1>
<p>Accertarsi di avere installato <b>pppd</b>
</p>
<pre># pacman -Qs ppp
local/ppp 2.4.4-9 (base)
A daemon which implements the PPP protocol for dial-up networking
</pre>
<p>avviare il modulo ppp-generic inserendolo nell'apposita riga di /etc/rc.conf 
</p>
<pre>MODULES=(nvidia ppp-generic !usblp option) 
</pre>
<p>modificare il file <i>/etc/resolv.conf</i> con i vostri server DNS oppure quelli open come nell'esempio
</p>
<pre>nameserver 208.67.222.222
nameserver 208.67.220.220
</pre>
<p>Per rendere persistente la modifica anche dopo il riavvio
</p>
<pre>chattr +i /etc/resolv.conf
</pre>
<h1><span class="mw-headline" id="Connessione_con_wvdial">Connessione con wvdial</span></h1>
<h2><span class="mw-headline" id="Packages">Packages</span></h2>
<p>Installiamo il pacchetto wvdial se non è già presente
</p>
<pre># pacman -S wvdial
</pre>
<h2><span class="mw-headline" id="Scripting">Scripting</span></h2>
<p>Andiamo a creare o modificare se esiste già il file /etc/wvdial.conf con il nostro editor preferito
</p>
<pre>[Dialer Defaults]
Modem = /dev/ttyACM0
ISDN = off
Modem Type = Analog
Modem Baud = 460800
Init2 = ATX3
Init3 = AT+COPS?
Init4 = AT+CGDCONT=1,"ip","datacard.tre.it"
Phone = *99#
Dial Attempts = 1
Dial Command = ATM1L3DT
Ask Password = off
Password = tre
Username = tre
Auto Reconnect = off
Abort on Busy = off
Carrier Check = on
Check Def Route = on
Abort on No Dialtone = on
Stupid Mode = on
Idle Seconds = 0
Auto DNS = off
</pre>
<p>L'esempio è per una connessione mediante provider 3 (modificare se necessario le seguenti righe)
</p>
<pre>Init4 = AT+CGDCONT=1,"ip","datacard.tre.it"
Phone = *99#
Password = tre
Username = tre
</pre>
<h2><span class="mw-headline" id="Connessione">Connessione</span></h2>
<p>Ora lanciando da root il comando wvdial dovremo effettuare la connessione.
</p>
<pre># wvdial
</pre>
<p>Se non funzione provare da un altro terminale a dare il seguente comando per instradare le richieste verso internet su <i>ppp0</i>.
</p>
<pre># ip route add default dev ppp0
</pre>
<h1><span class="mw-headline" id="Connessione_con_ppp">Connessione con ppp</span></h1>
<h2><span class="mw-headline" id="Configurazione">Configurazione</span></h2>
<p>Creiamo uno script che chiameremo /etc/ppp/peers/conn3 con questi dati all'interno
</p>
<pre>#!/bin/bash                                                                                                              
/dev/ttyACM0   #If using cdc-acm module                                                                                  
#demand         #Connessione a richiesta                                                                                 
debug        # Comment this off, if you don't need more info                                                             
# scripts to initialize the 3G / EDGE / GPRS modem                                                                       
connect '/usr/sbin/chat -v -f /etc/ppp/peers/connect-chat'                                                               
# AT commands used to 'hangup' the connection                                                                            
disconnect '/usr/sbin/chat -v -f /etc/ppp/peers/disconnect-chat'                                                         
460800      # Serial port line speed                                                                                     
crtscts    # hardware flow control for cable                                                                             
local        # Ignore carrier detect signal from the modem:                                                              
lcp-echo-failure 0
lcp-echo-interval 0
# IP addresses:
:0.0.0.0
# - accept peers idea of our local address and set address peer as 10.6.6.6
# (any address would do, since IPCP gives 0.0.0.0 to it)
# - if you use the 10. network at home or something and pppd rejects it,
# change the address
noipdefault        # pppd must not propose any IP address to the peer!
ipcp-accept-local    # Accept peers idea of our local address
defaultroute        # Add the ppp interface as default route to the IP routing table
#replacedefaultroute    # New route should be our default route to Internet
#usepeerdns        # User DNS returned by server
noauth            # The phone is not required to authenticate
# Most phone do not support compression, so turn it off.
noipv6
novj
nobsdcomp
novjccomp
nopcomp
noaccomp
# Username and password:
# If username and password are required by the APN, put here the username
# and put the username-password combination to the secrets file:
# /etc/ppp/pap-secrets for PAP and /etc/ppp/chap-secrets for CHAP
# authentication. See pppd man pages for details.
user "tre"        # Change this
persist            # Persistent connection
maxfail 99999        # Retry and retry and retry if failed...
</pre>
<p>Creiamo o modifichiamo <i>/etc/ppp/pap-secrets</i>
</p>
<pre># Secrets for authentication using PAP
# client        server  secret                  IP addresses
tre     *       tre
</pre>
<p>Sempre presupponendo che la connessione sia fatta al provider 3
</p>
<p>Creiamo o modifichiamo il file <i>/etc/ppp/peers/connect-chat</i>
</p>
<pre>ABORT BUSY
ABORT ERROR
ABORT 'NO CARRIER'
ABORT 'NO DIALTONE'
ABORT 'Invalid Login'
ABORT 'Login incorrect'
ABORT VOICE
ABORT 'NO ANSWER'
ABORT DELAYED
ABORT 'SIM PIN'
<i> ATZ</i>
OK-AT-OK 'ATX3'
OK-AT-OK 'AT+COPS?'
OK-AT-OK 'AT+CGDCONT=1,"IP","datacard.tre.it"'
OK 'ATM1L3DT*99#'
TIMEOUT 120
CONNECT <i></i>
TIMEOUT 5
'~--' <i></i>
</pre>
<p>Creiamo o modifichiamo il file <i>/etc/ppp/peers/disconnect-chat</i> 
</p>
<pre>#!/bin/sh
# send break exec /usr/sbin/chat -V -s -S    \
ABORT           "BUSY"          \
ABORT           "ERROR"         \
ABORT           "NO DIALTONE"   \
SAY             "\nSending break to the modem\n"        \
""              "\K"            \
""              "\K"            \
""              "\K"            \
""              "\d\d+++\d\dATH"        \
SAY             "\nPDP context detached\n"
</pre>
<h2><span class="mw-headline" id="Connessione_2">Connessione</span></h2>
<p>Ora con il comando 
</p>
<pre># pon conn3
</pre>
<p>la connessione dovrebbe avvenire (controllare con <i>ifconfig</i> se si attiva la rete <b>ppp0</b>)
</p>
<p>Per praticità è possibile creare il seguente link simbolico
</p>
<pre># ln -s /etc/ppp/peers/conn3 /etc/ppp/peers/provider
</pre>
<p>così sarà possibile connettersi con il semplice comando 
</p>
<pre># pon
</pre>
<p>Se non funzione provare da un altro terminale a dare il seguente comando per instradare le richieste verso internet su <i>ppp0</i>.
</p>
<pre># ip route add default dev ppp0
</pre>
<h1><span class="mw-headline" id="Regolazione_dei_dettagli">Regolazione dei dettagli</span></h1>
<h2><span class="mw-headline" id="Verifica_dello_stato_della_connessione">Verifica dello stato della connessione</span></h2>
<p>Per verificare lo stato della connessione suggerisco questo escamotage:
Creare un file dove salvare la risposta che da <i>pppd</i> al comando in /etc/ppp/peers/connect-chat
OK-AT-OK 'AT+COPS?'
</p>
<pre>touch /var/log/monitorconn.log
</pre>
<p>Editare i seguenti due script:
/etc/ppp/ip-up.d/monitorconnessione.sh
</p>
<pre>#!/bin/bash
echo "`grep 'COPS:' /var/log/ppp.log | tail --lines=1 | cut -c48-`" &gt; /var/log/monitorconn.log
</pre>
<p>e /etc/ppp/ip-down.d/clearmonitorconnessione.sh
</p>
<pre>#!/bin/bash
echo "." &gt; /var/log/monitorconn.log
</pre>
<p>Ora ogni volta che ci connetteremo il file /var/log/monitorconn.log verrà aggiornato con il provider di connessione e ogni volta che ci sconnetteremo verrà pulito.
L'unica cosa è assicurarsi che all'accensione del pc il file sia pulito:
aggiungere al file /etc/rc.sysinit la seguente riga 
</p>
<pre>/bin/echo " " &gt; /var/log/monitorconn.log ## per verificare connessione 3
</pre>
<p>Per far apparire il contenuto di /var/log/monitorconn.log in conky aggiungere al file di configurazione nella sezione <i>TEXT</i>
</p>
<pre>${color lightgrey}Network ppp0: ${exec cat "/var/log/monitorconn.log" | head --lines=1}
</pre>
<h1><span class="mw-headline" id="Links">Links</span></h1>
<ul>
<li><a href="../en/Huawei_E220.html" title="Huawei E220">Huawei E220</a></li>
<li><a href="../en/Ppp.html" class="mw-redirect" title="PPPoE Setup with pppd">PPPoE Setup with pppd</a></li>
<li>
<a href="../en/Dnsmasq.html#Conserve_DNS_settings" class="mw-redirect" title="Speeding up DNS with dnsmasq">Speeding up DNS with dnsmasq#Conserve_DNS_settings</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup>
</li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../it/Category:Hardware.html" title="Category:Hardware (Italiano)">Hardware (Italiano)</a></li>
<li><a href="../it/Category:Modems.html" title="Category:Modems (Italiano)">Modems (Italiano)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Internet_key_Momo_Design_(Italiano)&amp;oldid=618384">https://wiki.archlinux.org/index.php?title=Internet_key_Momo_Design_(Italiano)&amp;oldid=618384</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 5 June 2020, at 10:08.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
